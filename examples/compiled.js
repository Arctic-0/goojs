'use strict';(function(){var D,n;(function(e){function d(a,c){var f,b,g,d,e,j,i,s,r,h=c&&c.split("/"),m=o.map,k=m&&m["*"]||{};if(a&&a.charAt(0)===".")if(c){h=h.slice(0,h.length-1);a=h.concat(a.split("/"));for(s=0;s<a.length;s+=1)if(f=a[s],f===".")a.splice(s,1),s-=1;else if(f==="..")if(s===1&&(a[2]===".."||a[0]===".."))break;else s>0&&(a.splice(s-1,2),s-=2);a=a.join("/")}else a.indexOf("./")===0&&(a=a.substring(2));if((h||k)&&m){f=a.split("/");for(s=f.length;s>0;s-=1){b=f.slice(0,s).join("/");if(h)for(r=
h.length;r>0;r-=1)if(g=m[h.slice(0,r).join("/")])if(g=g[b]){d=g;e=s;break}if(d)break;!j&&k&&k[b]&&(j=k[b],i=s)}!d&&j&&(d=j,e=i);d&&(f.splice(0,e,d),a=f.join("/"))}return a}function b(a,c){return function(){return l.apply(e,r.call(arguments,0).concat([a,c]))}}function a(a){return function(c){return d(c,a)}}function c(a){return function(c){p[a]=c}}function f(a){if(s.call(t,a)){var c=t[a];delete t[a];h[a]=!0;i.apply(e,c)}if(!s.call(p,a)&&!s.call(h,a))throw Error("No "+a);return p[a]}function g(a){var c,
f=a?a.indexOf("!"):-1;f>-1&&(c=a.substring(0,f),a=a.substring(f+1,a.length));return[c,a]}function j(a){return function(){return o&&o.config&&o.config[a]||{}}}var i,l,m,k,p={},t={},o={},h={},s=Object.prototype.hasOwnProperty,r=[].slice;m=function(c,b){var e,j=g(c),i=j[0],c=j[1];i&&(i=d(i,b),e=f(i));i?c=e&&e.normalize?e.normalize(c,a(b)):d(c,b):(c=d(c,b),j=g(c),i=j[0],c=j[1],i&&(e=f(i)));return{f:i?i+"!"+c:c,n:c,pr:i,p:e}};k={require:function(a){return b(a)},exports:function(a){var c=p[a];return typeof c!==
"undefined"?c:p[a]={}},module:function(a){return{id:a,uri:"",exports:p[a],config:j(a)}}};i=function(a,g,d,j){var i,r,l,A,y=[],o,j=j||a;if(typeof d==="function"){g=!g.length&&d.length?["require","exports","module"]:g;for(A=0;A<g.length;A+=1)if(l=m(g[A],j),r=l.f,r==="require")y[A]=k.require(a);else if(r==="exports")y[A]=k.exports(a),o=!0;else if(r==="module")i=y[A]=k.module(a);else if(s.call(p,r)||s.call(t,r)||s.call(h,r))y[A]=f(r);else if(l.p)l.p.load(l.n,b(j,!0),c(r),{}),y[A]=p[r];else throw Error(a+
" missing "+r);g=d.apply(p[a],y);if(a)if(i&&i.exports!==e&&i.exports!==p[a])p[a]=i.exports;else if(g!==e||!o)p[a]=g}else a&&(p[a]=d)};D=l=function(a,c,b,g,d){if(typeof a==="string")return k[a]?k[a](c):f(m(a,c).f);else a.splice||(o=a,c.splice?(a=c,c=b,b=null):a=e);c=c||function(){};typeof b==="function"&&(b=g,g=d);g?i(e,a,c,b):setTimeout(function(){i(e,a,c,b)},15);return l};l.config=function(a){o=a;return l};n=function(a,c,f){c.splice||(f=c,c=[]);!s.call(p,a)&&!s.call(t,a)&&(t[a]=[a,c,f])};n.amd={jQuery:!0}})();
n("almond",function(){});n("goo/entities/Entity",[],function(){function e(b,a){this._world=b;this._components=[];Object.defineProperty(this,"id",{value:e.entityCount++,writable:!1});this.name=a!==void 0?a:"Entity_"+this.id}function d(b){return b.charAt(0).toLowerCase()+b.substr(1)}e.prototype.addToWorld=function(){this._world.addEntity(this)};e.prototype.removeFromWorld=function(){this._world.removeEntity(this)};e.prototype.setComponent=function(b){var a=this._components.indexOf(b);a===-1?this._components.push(b):
this._components[a]=b;this[d(b.type)]=b;if(b.type==="TransformComponent")b.entity=this;this._world.entityManager.containsEntity(this)&&this._world.changedEntity(this,b,"addedComponent")};e.prototype.getComponent=function(b){return this[d(b)]};e.prototype.clearComponent=function(b){var a=this[b],c=this._components.indexOf(a);if(c!==-1){a=this._components[c];if(a.type==="TransformComponent")a.entity=void 0;this._components.splice(c,1)}delete this[d(b)];this._world.entityManager.containsEntity(this)&&
this._world.changedEntity(this,a,"removedComponent")};e.prototype.toString=function(){return this.name};e.entityCount=0;return e});n("goo/entities/managers/EntityManager",[],function(){function e(){this.type="EntityManager";this._entities={}}e.prototype.added=function(d){this._entities[d.id]=d};e.prototype.removed=function(d){delete this._entities[d.id]};e.prototype.containsEntity=function(d){return this._entities[d.id]!==void 0};e.prototype.getEntityById=function(d){return this._entities[d]};e.prototype.getEntityByName=
function(d){for(var b in this._entities){var a=this._entities[b];if(a.name===d)return a}};e.prototype.getEntities=function(){var d=[],b;for(b in this._entities)d.push(this._entities[b]);return d};e.prototype.getTopEntities=function(){var d=[],b;for(b in this._entities){var a=this._entities[b];a.transformComponent?a.transformComponent.parent||d.push(a):d.push(a)}return d};return e});n("goo/math/MathUtils",[],function(){function e(){}e.DEG_TO_RAD=Math.PI/180;e.RAD_TO_DEG=180/Math.PI;e.HALF_PI=0.5*Math.PI;
e.TWO_PI=2*Math.PI;e.EPSILON=1.0E-7;e.radFromDeg=function(d){return d*e.DEG_TO_RAD};e.degFromRad=function(d){return d*e.RAD_TO_DEG};e.lerp=function(d,b,a){return b===a?b:b+(a-b)*d};e.clamp=function(d,b,a){return b<a?d<b?b:d>a?a:d:d<a?a:d>b?b:d};e.scurve3=function(d){return(-2*d+3)*d*d};e.scurve5=function(d){return((6*d-15)*d+10)*d*d*d};e.sphericalToCartesian=function(d,b,a,c){var f=d*Math.cos(a);c.x=f*Math.cos(b);c.y=d*Math.sin(a);c.z=f*Math.sin(b)};return e});n("goo/math/Matrix",["goo/math/MathUtils"],
function(e){function d(b,a){this.rows=b||0;this.cols=a||0;this.data=new Float32Array(this.rows*this.cols)}d.prototype.setupAliases=function(b){for(var a=this,c=0;c<b.length;c++)(function(f){for(var g=0;g<b[f].length;g++)Object.defineProperty(a,b[f][g],{get:function(){return this.data[f]},set:function(a){this.data[f]=a}});Object.defineProperty(a,c,{get:function(){return this.data[f]},set:function(a){this.data[f]=a}})})(c)};d.add=function(b,a,c){var f=b.rows,g=b.cols;c||(c=new d(f,g));if(a instanceof
d){if(a.rows!==f||a.cols!==g||c.rows!==f||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(f=0;f<b.data.length;f++)c.data[f]=b.data[f]+a.data[f]}else{if(c.rows!==f||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(f=0;f<b.data.length;f++)c.data[f]=b.data[f]+a}return c};d.prototype.add=function(b){return d.add(this,b,this)};d.sub=function(b,a,c){var f=b.rows,g=b.cols;c||(c=new d(f,g));if(a instanceof d){if(a.rows!==
f||a.cols!==g||c.rows!==f||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(f=0;f<b.data.length;f++)c.data[f]=b.data[f]-a.data[f]}else{if(c.rows!==f||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(f=0;f<b.data.length;f++)c.data[f]=b.data[f]-a}return c};d.prototype.sub=function(b){return d.sub(this,b,this)};d.mul=function(b,a,c){var f=b.rows,g=b.cols;c||(c=new d(f,g));if(a instanceof d){if(a.rows!==
f||a.cols!==g||c.rows!==f||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(f=0;f<b.data.length;f++)c.data[f]=b.data[f]*a.data[f]}else{if(c.rows!==f||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(f=0;f<b.data.length;f++)c.data[f]=b.data[f]*a}return c};d.prototype.mul=function(b){return d.mul(this,b,this)};d.div=function(b,a,c){var f=b.rows,g=b.cols;c||(c=new d(f,g));if(a instanceof d){if(a.rows!==
f||a.cols!==g||c.rows!==f||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(f=0;f<b.data.length;f++)c.data[f]=b.data[f]/a.data[f]}else{if(c.rows!==f||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a=1/a;for(f=0;f<b.data.length;f++)c.data[f]=b.data[f]*a}return c};d.prototype.div=function(b){return d.div(this,b,this)};d.combine=function(b,a,c){var f=b.rows,g=a.cols,e=b.cols=a.rows;c||(c=new d(f,g));if(b.cols!==
e||a.rows!==e||c.rows!==f||c.cols!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(c===b||c===a)return d.copy(d.combine(b,a),c);for(var i=0;i<g;i++)for(var l=i*f,m=0;m<f;m++){for(var k=0,p=0;p<e;p++)k+=b.data[p*b.rows+m]*a.data[i*a.rows+p];c.data[l+m]=k}return c};d.prototype.combine=function(b){return d.combine(this,b,this)};d.transpose=function(b,a){var c=b.cols,f=b.rows;a||(a=new d(c,f));if(a.rows!==c||a.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
if(a===b)return d.copy(d.transpose(b),a);for(var g=0;g<f;g++)for(var e=g*c,i=0;i<c;i++)a.data[e+i]=b.data[i*f+g];return a};d.prototype.transpose=function(){return d.transpose(this,this)};d.copy=function(b,a){var c=b.rows,f=b.cols;a||(a=new d(c,f));if(a.rows!==c||a.cols!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a.data.set(b.data);return a};d.prototype.copy=function(b){return d.copy(b,this)};d.equals=function(b,a){if(b.rows!==a.rows||b.cols!==a.cols)return!1;
for(var c=0;c<b.data.length;c++)if(Math.abs(b.data[c]-a.data[c])>e.EPSILON)return!1;return!0};d.prototype.equals=function(b){return d.equals(this,b)};d.prototype.isOrthogonal=function(){for(var b=0;b<this.cols;b++)for(var a=b+1;a<this.cols;a++){for(var c=b*this.rows,f=a*this.rows,g=0,d=0;d<this.rows;d++)g+=this.data[c+d]*this.data[f+d];if(Math.abs(g)>e.EPSILON)return!1}return!0};d.prototype.isNormal=function(){for(var b=0;b<this.cols;b++){for(var a=b*this.rows,c=0,f=0;f<this.rows;f++)c+=this.data[a+
f]*this.data[a+f];if(Math.abs(c-1)>e.EPSILON)return!1}return!0};d.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};d.prototype.clone=function(){return d.copy(this)};d.prototype.set=function(){if(arguments.length===1&&typeof arguments[0]==="object")if(arguments[0]instanceof d)this.copy(arguments[0]);else for(var b=0;b<arguments[0].length;b++)this.data[b]=arguments[0][b];else for(b=0;b<arguments.length;b++)this.data[b]=arguments[b];return this};d.prototype.toString=function(){for(var b=
"",a=0;a<this.cols;a++){var c=a*this.rows;b+="[";for(var f=0;f<this.rows;f++)b+=this.data[c+f],b+=f!==this.rows-1?", ":"";b+=a!==this.cols-1?"], ":"]"}return b};return d});n("goo/math/Vector",["goo/math/MathUtils","goo/math/Matrix"],function(e){function d(b){this.data=new Float32Array(b||0)}d.prototype.setupAliases=function(b){for(var a=this,c=0;c<b.length;c++)(function(f){for(var g=0;g<b[f].length;g++)Object.defineProperty(a,b[f][g],{get:function(){return this.data[f]},set:function(a){this.data[f]=
a}});Object.defineProperty(a,c,{get:function(){return this.data[f]},set:function(a){this.data[f]=a}})})(c)};d.add=function(b,a,c){var b=b.data||b,a=a.data||a,f=b.length;c||(c=new d(f));if(a.length!==f||c.data.length!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<f;g++)c.data[g]=b[g]+a[g];return c};d.prototype.add=function(b){return d.add(this,b,this)};d.sub=function(b,a,c){var b=b.data||b,a=a.data||a,f=b.length;c||(c=new d(f));if(a.length!==f||
c.data.length!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<f;g++)c.data[g]=b[g]-a[g];return c};d.prototype.sub=function(b){return d.sub(this,b,this)};d.mul=function(b,a,c){var b=b.data||b,a=a.data||a,f=b.length;c||(c=new d(f));if(a.length!==f||c.data.length!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<f;g++)c.data[g]=b[g]*a[g];return c};d.prototype.mul=function(b){return d.mul(this,b,this)};
d.div=function(b,a,c){var b=b.data||b,a=a.data||a,f=b.length;c||(c=new d(f));if(a.length!==f||c.data.length!==f)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var g=0;g<f;g++)c.data[g]=b[g]/a[g];return c};d.prototype.div=function(b){return d.div(this,b,this)};d.copy=function(b,a){var c=b.data.length;a||(a=new d(c));if(a.data.length!==c)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};a.data.set(b.data);return a};d.prototype.copy=
function(b){return d.copy(b,this)};d.dot=function(b,a){var c=b.data||b,f=a.data||a,g=c.length;if(f.length!==g)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};for(var d=0,e=0;e<g;e++)d+=c[e]*f[e];return d};d.prototype.dot=function(b){return d.dot(this,b)};d.apply=function(b,a,c){var f=b.rows,g=b.cols,e=a.data.length;c||(c=new d(f));if(c.data.length!==f||g!==e)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};if(c===a)return d.copy(d.apply(b,
a),c);for(var i=0;i<g;i++)for(var l=i*f,m=0;m<f;m++){for(var k=0,p=0;p<e;p++)k+=b.data[p*b.rows+m]*a.data[p];c.data[l+m]=k}return c};d.prototype.apply=function(b){return d.apply(b,this,this)};d.equals=function(b,a){if(b.data.length!==a.data.length)return!1;for(var c=0;c<b.data.length;c++)if(Math.abs(b.data[c]-a.data[c])>e.EPSILON)return!1;return!0};d.prototype.equals=function(b){return d.equals(this,b)};d.distanceSquared=function(b,a){return d.sub(b,a).lengthSquared()};d.prototype.distanceSquared=
function(b){return d.sub(this,b).lengthSquared()};d.distance=function(b,a){return d.sub(b,a).length()};d.prototype.distance=function(b){return d.sub(this,b).length()};d.prototype.lengthSquared=function(){return d.dot(this,this)};d.prototype.length=function(){return Math.sqrt(d.dot(this,this))};d.prototype.invert=function(){for(var b=0;b<this.data.length;b++)this.data[b]=0-this.data[b];return this};d.prototype.normalize=function(){var b=this.length();if(b<e.EPSILON)throw{name:"Normalization Error",
message:"The magnitude of the vector is incredibly small."};for(var b=1/b,a=0;a<this.data.length;a++)this.data[a]*=b;return this};d.prototype.clone=function(){return d.copy(this)};d.prototype.set=function(){if(arguments.length===1&&typeof arguments[0]==="object")if(arguments[0]instanceof d)this.copy(arguments[0]);else if(arguments[0].length>1)for(var b=0;b<arguments[0].length;b++)this.data[b]=arguments[0][b];else this.set(arguments[0][0]);else for(b in arguments)this.data[b]=arguments[b];return this};
d.prototype.toString=function(){var b="";b+="[";for(var a=0;a<this.data.length;a++)b+=this.data[a],b+=a!==this.data.length-1?", ":"";b+="]";return b};return d});n("goo/math/Vector3",["goo/math/Vector"],function(e){function d(){e.call(this,3);this.set(arguments.length!==0?arguments:[0,0,0])}d.prototype=Object.create(e.prototype);d.prototype.setupAliases([["x","u","r"],["y","v","g"],["z","w","b"]]);d.ZERO=new d(0,0,0);d.ONE=new d(1,1,1);d.UNIT_X=new d(1,0,0);d.UNIT_Y=new d(0,1,0);d.UNIT_Z=new d(0,0,
1);d.add=function(b,a,c){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]+a[0];c.data[1]=b[1]+a[1];c.data[2]=b[2]+a[2];return c};d.prototype.add=function(b){return d.add(this,b,this)};d.sub=function(b,a,c){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==
3||a.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]-a[0];c.data[1]=b[1]-a[1];c.data[2]=b[2]-a[2];return c};d.prototype.sub=function(b){return d.sub(this,b,this)};d.mul=function(b,a,c){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]*a[0];c.data[1]=b[1]*a[1];
c.data[2]=b[2]*a[2];return c};d.prototype.mul=function(b){return d.mul(this,b,this)};d.div=function(b,a,c){typeof b==="number"&&(b=[b,b,b]);typeof a==="number"&&(a=[a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==3||a.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]/a[0];c.data[1]=b[1]/a[1];c.data[2]=b[2]/a[2];return c};d.prototype.div=function(b){return d.div(this,b,this)};d.dot=function(b,a){typeof b==="number"&&(b=[b,b,b]);
typeof a==="number"&&(a=[a,a,a]);var c=b.data||b,f=a.data||a;if(c.length!==3||f.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};var g=0;g+=c[0]*f[0];g+=c[1]*f[1];g+=c[2]*f[2];return g};d.prototype.dot=function(b){return d.dot(this,b)};d.cross=function(b,a,c){c||(c=new d);if(c===b||c===a)return e.copy(d.cross(b,a),c);var f=a.data||a;if((b.data||b).length!==3||f.length!==3)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
c.data[0]=a.data[2]*b.data[1]-a.data[1]*b.data[2];c.data[1]=a.data[0]*b.data[2]-a.data[2]*b.data[0];c.data[2]=a.data[1]*b.data[0]-a.data[0]*b.data[1];return c};d.prototype.cross=function(b){return d.cross(this,b,this)};d.prototype.lerp=function(b,a){this.x=(1-a)*this.x+a*b.x;this.y=(1-a)*this.y+a*b.y;this.z=(1-a)*this.z+a*b.z;return this};return d});n("goo/math/Matrix3x3",["goo/math/MathUtils","goo/math/Matrix","goo/math/Vector3"],function(e,d,b){function a(){d.call(this,3,3);arguments.length===0?
this.setIdentity():this.set(arguments)}a.prototype=Object.create(d.prototype);a.prototype.setupAliases([["e00"],["e10"],["e20"],["e01"],["e11"],["e21"],["e02"],["e12"],["e22"]]);a.IDENTITY=new a(1,0,0,0,1,0,0,0,1);a.add=function(c,f,b){b||(b=new a);f instanceof a?(b.e00=c.e00+f.e00,b.e10=c.e10+f.e10,b.e20=c.e20+f.e20,b.e01=c.e01+f.e01,b.e11=c.e11+f.e11,b.e21=c.e21+f.e21,b.e02=c.e02+f.e02,b.e12=c.e12+f.e12,b.e22=c.e22+f.e22):(b.e00=c.e00+f,b.e10=c.e10+f,b.e20=c.e20+f,b.e01=c.e01+f,b.e11=c.e11+f,b.e21=
c.e21+f,b.e02=c.e02+f,b.e12=c.e12+f,b.e22=c.e22+f);return b};a.prototype.add=function(c){return a.add(this,c,this)};a.sub=function(c,f,b){b||(b=new a);f instanceof a?(b.e00=c.e00-f.e00,b.e10=c.e10-f.e10,b.e20=c.e20-f.e20,b.e01=c.e01-f.e01,b.e11=c.e11-f.e11,b.e21=c.e21-f.e21,b.e02=c.e02-f.e02,b.e12=c.e12-f.e12,b.e22=c.e22-f.e22):(b.e00=c.e00-f,b.e10=c.e10-f,b.e20=c.e20-f,b.e01=c.e01-f,b.e11=c.e11-f,b.e21=c.e21-f,b.e02=c.e02-f,b.e12=c.e12-f,b.e22=c.e22-f);return b};a.prototype.sub=function(c){return a.sub(this,
c,this)};a.mul=function(c,f,b){b||(b=new a);f instanceof a?(b.e00=c.e00*f.e00,b.e10=c.e10*f.e10,b.e20=c.e20*f.e20,b.e01=c.e01*f.e01,b.e11=c.e11*f.e11,b.e21=c.e21*f.e21,b.e02=c.e02*f.e02,b.e12=c.e12*f.e12,b.e22=c.e22*f.e22):(b.e00=c.e00*f,b.e10=c.e10*f,b.e20=c.e20*f,b.e01=c.e01*f,b.e11=c.e11*f,b.e21=c.e21*f,b.e02=c.e02*f,b.e12=c.e12*f,b.e22=c.e22*f);return b};a.prototype.mul=function(c){return a.mul(this,c,this)};a.div=function(c,b,g){g||(g=new a);b instanceof a?(g.e00=c.e00/b.e00,g.e10=c.e10/b.e10,
g.e20=c.e20/b.e20,g.e01=c.e01/b.e01,g.e11=c.e11/b.e11,g.e21=c.e21/b.e21,g.e02=c.e02/b.e02,g.e12=c.e12/b.e12,g.e22=c.e22/b.e22):(b=1/b,g.e00=c.e00*b,g.e10=c.e10*b,g.e20=c.e20*b,g.e01=c.e01*b,g.e11=c.e11*b,g.e21=c.e21*b,g.e02=c.e02*b,g.e12=c.e12*b,g.e22=c.e22*b);return g};a.prototype.div=function(c){return a.div(this,c,this)};a.combine=function(c,b,g){g||(g=new a);if(g===c||g===b)return d.copy(a.combine(c,b),g);g.e00=c.e00*b.e00+c.e01*b.e10+c.e02*b.e20;g.e10=c.e10*b.e00+c.e11*b.e10+c.e12*b.e20;g.e20=
c.e20*b.e00+c.e21*b.e10+c.e22*b.e20;g.e01=c.e00*b.e01+c.e01*b.e11+c.e02*b.e21;g.e11=c.e10*b.e01+c.e11*b.e11+c.e12*b.e21;g.e21=c.e20*b.e01+c.e21*b.e11+c.e22*b.e21;g.e02=c.e00*b.e02+c.e01*b.e12+c.e02*b.e22;g.e12=c.e10*b.e02+c.e11*b.e12+c.e12*b.e22;g.e22=c.e20*b.e02+c.e21*b.e12+c.e22*b.e22;return g};a.prototype.combine=function(c){return a.combine(this,c,this)};a.transpose=function(c,b){b||(b=new a);if(b===c)return d.copy(a.transpose(c),b);b.e00=c.e00;b.e10=c.e01;b.e20=c.e02;b.e01=c.e10;b.e11=c.e11;
b.e21=c.e12;b.e02=c.e20;b.e12=c.e21;b.e22=c.e22;return b};a.prototype.transpose=function(){return a.transpose(this,this)};a.invert=function(c,b){b||(b=new a);if(b===c)return d.copy(a.invert(c),b);var g=c.determinant();if(Math.abs(g)<e.EPSILON)throw{name:"Singular Matrix",message:"The matrix is singular and cannot be inverted."};g=1/g;b.e00=(c.e11*c.e22-c.e12*c.e21)*g;b.e10=(c.e12*c.e20-c.e10*c.e22)*g;b.e20=(c.e10*c.e21-c.e11*c.e20)*g;b.e01=(c.e02*c.e21-c.e01*c.e22)*g;b.e11=(c.e00*c.e22-c.e02*c.e20)*
g;b.e21=(c.e01*c.e20-c.e00*c.e21)*g;b.e02=(c.e01*c.e12-c.e02*c.e11)*g;b.e12=(c.e02*c.e10-c.e00*c.e12)*g;b.e22=(c.e00*c.e11-c.e01*c.e10)*g;return b};a.prototype.invert=function(){return a.invert(this,this)};a.prototype.isOrthogonal=function(){var a;a=this.e00*this.e01+this.e10*this.e11+this.e20*this.e21;if(Math.abs(a)>e.EPSILON)return!1;a=this.e00*this.e02+this.e10*this.e12+this.e20*this.e22;if(Math.abs(a)>e.EPSILON)return!1;a=this.e01*this.e02+this.e11*this.e12+this.e21*this.e22;return Math.abs(a)>
e.EPSILON?!1:!0};a.prototype.isNormal=function(){var a;a=this.e00*this.e00+this.e10*this.e10+this.e20*this.e20;if(Math.abs(a-1)>e.EPSILON)return!1;a=this.e01*this.e01+this.e11*this.e11+this.e21*this.e21;if(Math.abs(a-1)>e.EPSILON)return!1;a=this.e02*this.e02+this.e12*this.e12+this.e22*this.e22;return Math.abs(a-1)>e.EPSILON?!1:!0};a.prototype.isOrthonormal=function(){return this.isOrthogonal()&&this.isNormal()};a.prototype.determinant=function(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-
this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)};a.prototype.setIdentity=function(){this.set(a.IDENTITY)};a.prototype.applyPost=function(a){var b=a.x,g=a.y,d=a.z;a.x=this.e00*b+this.e01*g+this.e02*d;a.y=this.e10*b+this.e11*g+this.e12*d;a.z=this.e20*b+this.e21*g+this.e22*d;return a};a.prototype.applyPre=function(a){var b=a.x,d=a.y,e=a.z;a.x=this.e00*b+this.e10*d+this.e20*e;a.y=this.e01*b+this.e11*d+this.e21*e;a.z=this.e02*b+this.e12*d+this.e22*e;return a};
a.prototype.multiplyDiagonalPost=function(a,b){var d=a.x,e=a.y,i=a.z;b.e00=d*this.e00;b.e01=e*this.e01;b.e02=i*this.e02;b.e10=d*this.e10;b.e11=e*this.e11;b.e12=i*this.e12;b.e20=d*this.e20;b.e21=e*this.e21;b.e22=i*this.e22;return b};a.prototype.fromAngles=function(a,b,d){var e=Math.cos(a),a=Math.sin(a),i=Math.cos(b),b=Math.sin(b),l=Math.cos(d),d=Math.sin(d);this.e00=i*l;this.e01=b*a-i*d*e;this.e02=i*d*a+b*e;this.e10=d;this.e11=l*e;this.e12=-l*a;this.e20=-b*l;this.e21=b*d*e+i*a;this.e22=-b*d*a+i*e;
return this};a.prototype.fromAngleNormalAxis=function(a,b,d,e){var i=Math.cos(a),l=Math.sin(a),a=1-i,m=b*d*a,k=b*e*a,p=d*e*a,t=b*l,o=d*l;l*=e;this.e00=b*b*a+i;this.e01=m-l;this.e02=k+o;this.e10=m+l;this.e11=d*d*a+i;this.e12=p-t;this.e20=k-o;this.e21=p+t;this.e22=e*e*a+i;return this};a.prototype.lookAt=function(a,f){var d=new b,e=new b,i=new b;i.copy(a).normalize();d.copy(f).normalize().cross(i);e.copy(i).cross(d);this.e00=d.x;this.e10=d.y;this.e20=d.z;this.e01=e.x;this.e11=e.y;this.e21=e.z;this.e02=
i.x;this.e12=i.y;this.e22=i.z;return this};a.prototype.copyQuaternion=function(a){return a.toRotationMatrix(this)};return a});n("goo/math/Matrix4x4",["goo/math/MathUtils","goo/math/Matrix"],function(e,d){function b(){d.call(this,4,4);arguments.length===0?this.setIdentity():this.set(arguments)}b.prototype=Object.create(d.prototype);b.prototype.setupAliases([["e00"],["e10"],["e20"],["e30"],["e01"],["e11"],["e21"],["e31"],["e02"],["e12"],["e22"],["e32"],["e03"],["e13"],["e23"],["e33"]]);b.IDENTITY=new b(1,
0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);b.add=function(a,c,f){f||(f=new b);c instanceof b?(f.e00=a.e00+c.e00,f.e10=a.e10+c.e10,f.e20=a.e20+c.e20,f.e30=a.e30+c.e30,f.e01=a.e01+c.e01,f.e11=a.e11+c.e11,f.e21=a.e21+c.e21,f.e31=a.e31+c.e31,f.e02=a.e02+c.e02,f.e12=a.e12+c.e12,f.e22=a.e22+c.e22,f.e32=a.e32+c.e32,f.e03=a.e03+c.e03,f.e13=a.e13+c.e13,f.e23=a.e23+c.e23,f.e33=a.e33+c.e33):(f.e00=a.e00+c,f.e10=a.e10+c,f.e20=a.e20+c,f.e30=a.e30+c,f.e01=a.e01+c,f.e11=a.e11+c,f.e21=a.e21+c,f.e31=a.e31+c,f.e02=a.e02+c,f.e12=
a.e12+c,f.e22=a.e22+c,f.e32=a.e32+c,f.e03=a.e03+c,f.e13=a.e13+c,f.e23=a.e23+c,f.e33=a.e33+c);return f};b.prototype.add=function(a){return b.add(this,a,this)};b.sub=function(a,c,f){f||(f=new b);c instanceof b?(f.e00=a.e00-c.e00,f.e10=a.e10-c.e10,f.e20=a.e20-c.e20,f.e30=a.e30-c.e30,f.e01=a.e01-c.e01,f.e11=a.e11-c.e11,f.e21=a.e21-c.e21,f.e31=a.e31-c.e31,f.e02=a.e02-c.e02,f.e12=a.e12-c.e12,f.e22=a.e22-c.e22,f.e32=a.e32-c.e32,f.e03=a.e03-c.e03,f.e13=a.e13-c.e13,f.e23=a.e23-c.e23,f.e33=a.e33-c.e33):(f.e00=
a.e00-c,f.e10=a.e10-c,f.e20=a.e20-c,f.e30=a.e30-c,f.e01=a.e01-c,f.e11=a.e11-c,f.e21=a.e21-c,f.e31=a.e31-c,f.e02=a.e02-c,f.e12=a.e12-c,f.e22=a.e22-c,f.e32=a.e32-c,f.e03=a.e03-c,f.e13=a.e13-c,f.e23=a.e23-c,f.e33=a.e33-c);return f};b.prototype.sub=function(a){return b.sub(this,a,this)};b.mul=function(a,c,f){f||(f=new b);c instanceof b?(f.e00=a.e00*c.e00,f.e10=a.e10*c.e10,f.e20=a.e20*c.e20,f.e30=a.e30*c.e30,f.e01=a.e01*c.e01,f.e11=a.e11*c.e11,f.e21=a.e21*c.e21,f.e31=a.e31*c.e31,f.e02=a.e02*c.e02,f.e12=
a.e12*c.e12,f.e22=a.e22*c.e22,f.e32=a.e32*c.e32,f.e03=a.e03*c.e03,f.e13=a.e13*c.e13,f.e23=a.e23*c.e23,f.e33=a.e33*c.e33):(f.e00=a.e00*c,f.e10=a.e10*c,f.e20=a.e20*c,f.e30=a.e30*c,f.e01=a.e01*c,f.e11=a.e11*c,f.e21=a.e21*c,f.e31=a.e31*c,f.e02=a.e02*c,f.e12=a.e12*c,f.e22=a.e22*c,f.e32=a.e32*c,f.e03=a.e03*c,f.e13=a.e13*c,f.e23=a.e23*c,f.e33=a.e33*c);return f};b.prototype.mul=function(a){return b.mul(this,a,this)};b.div=function(a,c,f){f||(f=new b);c instanceof b?(f.e00=a.e00/c.e00,f.e10=a.e10/c.e10,f.e20=
a.e20/c.e20,f.e30=a.e30/c.e30,f.e01=a.e01/c.e01,f.e11=a.e11/c.e11,f.e21=a.e21/c.e21,f.e31=a.e31/c.e31,f.e02=a.e02/c.e02,f.e12=a.e12/c.e12,f.e22=a.e22/c.e22,f.e32=a.e32/c.e32,f.e03=a.e03/c.e03,f.e13=a.e13/c.e13,f.e23=a.e23/c.e23,f.e33=a.e33/c.e33):(c=1/c,f.e00=a.e00*c,f.e10=a.e10*c,f.e20=a.e20*c,f.e30=a.e30*c,f.e01=a.e01*c,f.e11=a.e11*c,f.e21=a.e21*c,f.e31=a.e31*c,f.e02=a.e02*c,f.e12=a.e12*c,f.e22=a.e22*c,f.e32=a.e32*c,f.e03=a.e03*c,f.e13=a.e13*c,f.e23=a.e23*c,f.e33=a.e33*c);return f};b.prototype.div=
function(a){return b.div(this,a,this)};b.combine=function(a,c,f){f||(f=new b);if(f===a||f===c)return d.copy(b.combine(a,c),f);f.e00=a.e00*c.e00+a.e01*c.e10+a.e02*c.e20+a.e03*c.e30;f.e10=a.e10*c.e00+a.e11*c.e10+a.e12*c.e20+a.e13*c.e30;f.e20=a.e20*c.e00+a.e21*c.e10+a.e22*c.e20+a.e23*c.e30;f.e30=a.e30*c.e00+a.e31*c.e10+a.e32*c.e20+a.e33*c.e30;f.e01=a.e00*c.e01+a.e01*c.e11+a.e02*c.e21+a.e03*c.e31;f.e11=a.e10*c.e01+a.e11*c.e11+a.e12*c.e21+a.e13*c.e31;f.e21=a.e20*c.e01+a.e21*c.e11+a.e22*c.e21+a.e23*c.e31;
f.e31=a.e30*c.e01+a.e31*c.e11+a.e32*c.e21+a.e33*c.e31;f.e02=a.e00*c.e02+a.e01*c.e12+a.e02*c.e22+a.e03*c.e32;f.e12=a.e10*c.e02+a.e11*c.e12+a.e12*c.e22+a.e13*c.e32;f.e22=a.e20*c.e02+a.e21*c.e12+a.e22*c.e22+a.e23*c.e32;f.e32=a.e30*c.e02+a.e31*c.e12+a.e32*c.e22+a.e33*c.e32;f.e03=a.e00*c.e03+a.e01*c.e13+a.e02*c.e23+a.e03*c.e33;f.e13=a.e10*c.e03+a.e11*c.e13+a.e12*c.e23+a.e13*c.e33;f.e23=a.e20*c.e03+a.e21*c.e13+a.e22*c.e23+a.e23*c.e33;f.e33=a.e30*c.e03+a.e31*c.e13+a.e32*c.e23+a.e33*c.e33;return f};b.prototype.combine=
function(a){return b.combine(this,a,this)};b.transpose=function(a,c){c||(c=new b);if(c===a)return d.copy(b.transpose(a),c);c.e00=a.e00;c.e10=a.e01;c.e20=a.e02;c.e30=a.e03;c.e01=a.e10;c.e11=a.e11;c.e21=a.e12;c.e31=a.e13;c.e02=a.e20;c.e12=a.e21;c.e22=a.e22;c.e32=a.e23;c.e03=a.e30;c.e13=a.e31;c.e23=a.e32;c.e33=a.e33;return c};b.prototype.transpose=function(){return b.transpose(this,this)};b.invert=function(a,c){c||(c=new b);if(c===a)return d.copy(b.invert(a),c);var f=a.determinant();if(Math.abs(f)<e.EPSILON)throw{name:"Singular Matrix",
message:"The matrix is singular and cannot be inverted."};f=1/f;c.e00=(a.e11*(a.e22*a.e33-a.e23*a.e32)-a.e12*(a.e21*a.e33-a.e23*a.e31)+a.e13*(a.e21*a.e32-a.e22*a.e31))*f;c.e10=(a.e10*(a.e23*a.e32-a.e22*a.e33)-a.e12*(a.e23*a.e30-a.e20*a.e33)+a.e13*(a.e22*a.e30-a.e20*a.e32))*f;c.e20=(a.e10*(a.e21*a.e33-a.e23*a.e31)-a.e11*(a.e20*a.e33-a.e23*a.e30)+a.e13*(a.e20*a.e31-a.e21*a.e30))*f;c.e30=(a.e10*(a.e22*a.e31-a.e21*a.e32)-a.e11*(a.e22*a.e30-a.e20*a.e32)+a.e12*(a.e21*a.e30-a.e20*a.e31))*f;c.e01=(a.e01*
(a.e23*a.e32-a.e22*a.e33)-a.e02*(a.e23*a.e31-a.e21*a.e33)+a.e03*(a.e22*a.e31-a.e21*a.e32))*f;c.e11=(a.e00*(a.e22*a.e33-a.e23*a.e32)-a.e02*(a.e20*a.e33-a.e23*a.e30)+a.e03*(a.e20*a.e32-a.e22*a.e30))*f;c.e21=(a.e00*(a.e23*a.e31-a.e21*a.e33)-a.e01*(a.e23*a.e30-a.e20*a.e33)+a.e03*(a.e21*a.e30-a.e20*a.e31))*f;c.e31=(a.e00*(a.e21*a.e32-a.e22*a.e31)-a.e01*(a.e20*a.e32-a.e22*a.e30)+a.e02*(a.e20*a.e31-a.e21*a.e30))*f;c.e02=(a.e01*(a.e12*a.e33-a.e13*a.e32)-a.e02*(a.e11*a.e33-a.e13*a.e31)+a.e03*(a.e11*a.e32-
a.e12*a.e31))*f;c.e12=(a.e00*(a.e13*a.e32-a.e12*a.e33)-a.e02*(a.e13*a.e30-a.e10*a.e33)+a.e03*(a.e12*a.e30-a.e10*a.e32))*f;c.e22=(a.e00*(a.e11*a.e33-a.e13*a.e31)-a.e01*(a.e10*a.e33-a.e13*a.e30)+a.e03*(a.e10*a.e31-a.e11*a.e30))*f;c.e32=(a.e00*(a.e12*a.e31-a.e11*a.e32)-a.e01*(a.e12*a.e30-a.e10*a.e32)+a.e02*(a.e11*a.e30-a.e10*a.e31))*f;c.e03=(a.e01*(a.e13*a.e22-a.e12*a.e23)-a.e02*(a.e13*a.e21-a.e11*a.e23)+a.e03*(a.e12*a.e21-a.e11*a.e22))*f;c.e13=(a.e00*(a.e12*a.e23-a.e13*a.e22)-a.e02*(a.e10*a.e23-a.e13*
a.e20)+a.e03*(a.e10*a.e22-a.e12*a.e20))*f;c.e23=(a.e00*(a.e13*a.e21-a.e11*a.e23)-a.e01*(a.e13*a.e20-a.e10*a.e23)+a.e03*(a.e11*a.e20-a.e10*a.e21))*f;c.e33=(a.e00*(a.e11*a.e22-a.e12*a.e21)-a.e01*(a.e10*a.e22-a.e12*a.e20)+a.e02*(a.e10*a.e21-a.e11*a.e20))*f;return c};b.prototype.invert=function(){return b.invert(this,this)};b.prototype.isOrthogonal=function(){var a;a=this.e00*this.e01+this.e10*this.e11+this.e20*this.e21+this.e30*this.e31;if(Math.abs(a)>e.EPSILON)return!1;a=this.e00*this.e02+this.e10*
this.e12+this.e20*this.e22+this.e30*this.e32;if(Math.abs(a)>e.EPSILON)return!1;a=this.e00*this.e03+this.e10*this.e13+this.e20*this.e23+this.e30*this.e33;if(Math.abs(a)>e.EPSILON)return!1;a=this.e01*this.e02+this.e11*this.e12+this.e21*this.e22+this.e31*this.e32;if(Math.abs(a)>e.EPSILON)return!1;a=this.e01*this.e03+this.e11*this.e13+this.e21*this.e23+this.e31*this.e33;if(Math.abs(a)>e.EPSILON)return!1;a=this.e02*this.e03+this.e12*this.e13+this.e22*this.e23+this.e32*this.e33;return Math.abs(a)>e.EPSILON?
!1:!0};b.prototype.isNormal=function(){var a;a=this.e00*this.e00+this.e10*this.e10+this.e20*this.e20+this.e30*this.e30;if(Math.abs(a-1)>e.EPSILON)return!1;a=this.e01*this.e01+this.e11*this.e11+this.e21*this.e21+this.e31*this.e31;if(Math.abs(a-1)>e.EPSILON)return!1;a=this.e02*this.e02+this.e12*this.e12+this.e22*this.e22+this.e32*this.e32;if(Math.abs(a-1)>e.EPSILON)return!1;a=this.e03*this.e03+this.e13*this.e13+this.e23*this.e23+this.e33*this.e33;return Math.abs(a-1)>e.EPSILON?!1:!0};b.prototype.isOrthonormal=
function(){return this.isOrthogonal()&&this.isNormal()};b.prototype.determinant=function(){return this.e00*(this.e11*this.e22*this.e33+this.e12*this.e23*this.e31+this.e13*this.e21*this.e32-this.e13*this.e22*this.e31-this.e12*this.e21*this.e33-this.e11*this.e23*this.e32)-this.e01*(this.e10*this.e22*this.e33+this.e12*this.e23*this.e30+this.e13*this.e20*this.e32-this.e13*this.e22*this.e30-this.e12*this.e20*this.e33-this.e10*this.e23*this.e32)+this.e02*(this.e10*this.e21*this.e33+this.e11*this.e23*this.e30+
this.e13*this.e20*this.e31-this.e13*this.e21*this.e30-this.e11*this.e20*this.e33-this.e10*this.e23*this.e31)-this.e03*(this.e10*this.e21*this.e32+this.e11*this.e22*this.e30+this.e12*this.e20*this.e31-this.e12*this.e21*this.e30-this.e11*this.e20*this.e32-this.e10*this.e22*this.e31)};b.prototype.setIdentity=function(){return this.set(b.IDENTITY)};b.prototype.setRotationFromVector=function(a){var c=Math.sin(a.x),b=Math.cos(a.x),d=Math.sin(a.y),e=Math.cos(a.y),i=Math.sin(a.z),a=Math.cos(a.z);this.e00=
a*e;this.e10=i*e;this.e20=0-d;this.e01=a*d*c-i*b;this.e11=i*d*c+a*b;this.e21=e*c;this.e02=a*d*b+i*c;this.e12=i*d*b-a*c;this.e22=e*b;return this};b.prototype.setRotationFromQuaternion=function(a){var c=a.lengthSquared(),c=c>0?2/c:0,b=a.x*c,d=a.y*c,e=a.z*c,c=a.w*b,i=a.w*d,l=a.w*e;b*=a.x;var m=a.x*d,k=a.x*e;d*=a.y;var p=a.y*e,a=a.z*e;this.e00=1-d-a;this.e10=m+l;this.e20=k-i;this.e01=m-l;this.e11=1-b-a;this.e21=p+c;this.e02=k+i;this.e12=p-c;this.e22=1-b-d;return this};b.prototype.setTranslation=function(a){this.e03=
a.x;this.e13=a.y;this.e23=a.z;return this};b.prototype.getTranslation=function(a){a.x=this.e03;a.y=this.e13;a.z=this.e23;return this};b.prototype.setScale=function(a){this.e00*=a.x;this.e10*=a.y;this.e20*=a.z;this.e01*=a.x;this.e11*=a.y;this.e21*=a.z;this.e02*=a.x;this.e12*=a.y;this.e22*=a.z;return this};b.prototype.applyPre=function(a){var b=a.x,f=a.y,d=a.z,e=a.w;a.x=this.e00*b+this.e10*f+this.e20*d+this.e30*e;a.y=this.e01*b+this.e11*f+this.e21*d+this.e31*e;a.z=this.e02*b+this.e12*f+this.e22*d+this.e32*
e;a.w=this.e03*b+this.e13*f+this.e23*d+this.e33*e;return a};b.prototype.applyPost=function(a){var b=a.x,f=a.y,d=a.z,e=a.w;a.x=this.e00*b+this.e01*f+this.e02*d+this.e03*e;a.y=this.e10*b+this.e11*f+this.e12*d+this.e13*e;a.z=this.e20*b+this.e21*f+this.e22*d+this.e23*e;a.w=this.e30*b+this.e31*f+this.e32*d+this.e33*e;return a};b.prototype.applyPostPoint=function(a){var b=a.x,f=a.y,d=a.z;a.x=this.e00*b+this.e01*f+this.e02*d+this.e03;a.y=this.e10*b+this.e11*f+this.e12*d+this.e13;a.z=this.e20*b+this.e21*
f+this.e22*d+this.e23;return a};b.prototype.applyPostVector=function(a){var b=a.x,f=a.y,d=a.z;a.x=this.e00*b+this.e01*f+this.e02*d;a.y=this.e10*b+this.e11*f+this.e12*d;a.z=this.e20*b+this.e21*f+this.e22*d;return a};return b});n("goo/util/Handy",[],function(){function e(){}e.deepFreeze=function(d){var b,a;Object.freeze(d);for(a in d)b=d[a],d.hasOwnProperty(a)&&!(typeof b!=="object"||Object.isFrozen(b))&&deepFreeze(b)};e.defineProperty=function(d,b,a,c){var f=a;Object.defineProperty(d,b,{get:function(){return f},
set:function(a){f=a;c(f)},configurable:!0,enumerable:!0})};e.addListener=function(d,b,a,c){var f=d[b];Object.defineProperty(d,b,{get:function(){a&&a();return f},set:function(a){f=a;c&&c(f)},configurable:!0,enumerable:!0})};return e});n("goo/math/Transform",["goo/math/Vector3","goo/math/Matrix3x3","goo/math/Matrix4x4","goo/util/Handy"],function(e,d,b,a){function c(){this.matrix=new b;this.translation=new e;this.rotation=new d;this.scale=new e(1,1,1);this.eulerUpdated=!1;var c=this;a.addListener(this,
"rotation",void 0,function(){c.rotation.x=0;c.rotation.y=0;c.rotation.z=0;a.addListener(c.rotation,"x",void 0,function(){c.eulerUpdated=!0});a.addListener(c.rotation,"y",void 0,function(){c.eulerUpdated=!0});a.addListener(c.rotation,"z",void 0,function(){c.eulerUpdated=!0})});this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;a.addListener(this.rotation,"x",void 0,function(){c.eulerUpdated=!0});a.addListener(this.rotation,"y",void 0,function(){c.eulerUpdated=!0});a.addListener(this.rotation,"z",
void 0,function(){c.eulerUpdated=!0});this.tmpVec=new e;this.tmpMat1=new d;this.tmpMat2=new d}c.prototype.multiply=function(a,c){b.combine(a.matrix,c.matrix,this.matrix);this.tmpMat1.copy(a.rotation).multiplyDiagonalPost(a.scale,this.tmpMat1);this.tmpMat2.copy(c.rotation).multiplyDiagonalPost(c.scale,this.tmpMat2);d.combine(this.tmpMat1,this.tmpMat2,this.rotation);this.translation.copy(c.translation);this.tmpMat1.applyPost(this.translation).add(a.translation);this.scale.copy(a.scale).mul(c.scale)};
c.prototype.setIdentity=function(){this.matrix.setIdentity();this.translation.copy(e.ZERO);this.rotation.setIdentity();this.scale.copy(e.ONE)};c.prototype.applyForward=function(a,b){b.copy(a);this.matrix.applyPostPoint(b);return b};c.prototype.applyForwardVector=function(a,b){b.copy(a);b.set(b.x*this.scale.x,b.y*this.scale.y,b.z*this.scale.z);this.rotation.applyPost(b);return b};c.prototype.update=function(){if(this.eulerUpdated)this.rotation.fromAngles(this.rotation.x,this.rotation.y,this.rotation.z),
this.eulerUpdated=!1;var a=this.matrix,b=this.rotation;a.e00=this.scale.x*b.e00;a.e01=this.scale.y*b.e01;a.e02=this.scale.z*b.e02;a.e10=this.scale.x*b.e10;a.e11=this.scale.y*b.e11;a.e12=this.scale.z*b.e12;a.e20=this.scale.x*b.e20;a.e21=this.scale.y*b.e21;a.e22=this.scale.z*b.e22;a.e30=0;a.e31=0;a.e32=0;a.e03=this.translation.x;a.e13=this.translation.y;a.e23=this.translation.z;a.e33=1};c.prototype.copy=function(a){this.matrix.copy(a.matrix);this.translation.copy(a.translation);this.rotation.copy(a.rotation);
this.scale.copy(a.scale)};c.prototype.lookAt=function(a,b){this.tmpVec.copy(this.translation).sub(a).normalize();this.rotation.lookAt(this.tmpVec,b)};c.prototype.invert=function(a){a||(a=new c);a.matrix.copy(this.matrix);a.matrix.invert();var b=a.rotation.copy(this.rotation);b.multiplyDiagonalPost(this.scale,b).invert();a.translation.copy(this.translation);a.rotation.applyPost(a.translation).invert();return a};c.prototype.toString=function(){return""+this.matrix};return c});n("goo/entities/components/Component",
[],function(){return function(){this.enabled=!0}});n("goo/entities/components/TransformComponent",["goo/math/Transform","goo/entities/components/Component"],function(e,d){function b(){this.type="TransformComponent";this.parent=null;this.children=[];this.transform=new e;this.worldTransform=new e;this._dirty=!0;this._updated=!1}b.prototype=Object.create(d.prototype);b.prototype.setUpdated=function(){this._dirty=!0};b.prototype.attachChild=function(a){a===this?console.warn("attachChild: An object can't be added as a child of itself."):
(a.parent&&a.parent.detachChild(a),a.parent=this,this.children.push(a))};b.prototype.detachChild=function(a){if(a===this)console.warn("attachChild: An object can't be removed from itself.");else{var b=this.children.indexOf(a);if(b!==-1)a.parent=null,this.children.splice(b,1)}};b.prototype.updateTransform=function(){this.transform.update()};b.prototype.updateWorldTransform=function(){this.parent?this.worldTransform.multiply(this.parent.worldTransform,this.transform):this.worldTransform.copy(this.transform);
this._dirty=!1;this._updated=!0};return b});n("goo/entities/World",["goo/entities/Entity","goo/entities/managers/EntityManager","goo/entities/components/TransformComponent"],function(e,d,b){function a(){this._managers=[];this._systems=[];this._addedEntities=[];this._changedEntities=[];this._removedEntities=[];this.entityManager=new d;this.setManager(this.entityManager);this.time=0;this.tpf=1}a.time=0;a.prototype.setManager=function(a){this._managers.push(a)};a.prototype.getManager=function(a){for(var b in this._managers){var d=
this._managers[b];if(d.type===a)return d}};a.prototype.setSystem=function(a){this._systems.push(a)};a.prototype.getSystem=function(a){for(var b in this._systems){var d=this._systems[b];if(d.type===a)return d}};a.prototype.createEntity=function(a){a=new e(this,a);a.setComponent(new b);return a};a.prototype.getEntities=function(){return this.entityManager.getEntities()};a.prototype.addEntity=function(a){this._addedEntities.push(a)};a.prototype.removeEntity=function(a){this._removedEntities.push(a)};
a.prototype.changedEntity=function(a,b,d){a={entity:a};if(b!==void 0)a.component=b;if(d!==void 0)a.eventType=d;this._changedEntities.push(a)};a.prototype.process=function(){this._check(this._addedEntities,function(a,b){a.added&&a.added(b);if(a.addedComponent)for(var c in b._components)a.addedComponent(b,b._components[c])});this._check(this._changedEntities,function(a,b){a.changed&&a.changed(b.entity);if(b.eventType!==void 0&&a[b.eventType])a[b.eventType](b.entity,b.component)});this._check(this._removedEntities,
function(a,b){a.removed&&a.removed(b);if(a.removedComponent)for(var c in b._components)a.removedComponent(b,b._components[c])});for(var a in this._systems){var b=this._systems[a];b.passive||b._process(this.tpf)}};a.prototype._check=function(a,b){for(var d in a){var e=a[d],i;for(i in this._managers)b(this._managers[i],e);for(var l in this._systems)b(this._systems[l],e)}a.length=0};return a});n("goo/entities/systems/System",[],function(){function e(d,b){this.type=d;this.interests=b;this._activeEntities=
[]}e.prototype.added=function(d){this._check(d)};e.prototype.changed=function(d){this._check(d)};e.prototype.removed=function(d){var b=this._activeEntities.indexOf(d);b!==-1&&(this._activeEntities.splice(b,1),this.deleted&&this.deleted(d))};e.prototype._check=function(d){var b=this.interests===null;if(!b&&this.interests.length<=d._components.length){var b=!0,a;for(a in this.interests){var c=this.interests[a].charAt(0).toLowerCase()+this.interests[a].substr(1);if(!d[c]){b=!1;break}}}a=this._activeEntities.indexOf(d);
b&&a===-1?(this._activeEntities.push(d),this.inserted&&this.inserted(d)):!b&&a!==-1&&(this._activeEntities.splice(a,1),this.deleted&&this.deleted(d))};e.prototype._process=function(d){this.process&&this.process(this._activeEntities,d)};return e});n("goo/entities/systems/TransformSystem",["goo/entities/systems/System"],function(e){function d(){e.call(this,"TransformSystem",["TransformComponent"])}d.prototype=Object.create(e.prototype);d.prototype.process=function(b){var a,c;for(a in b)c=b[a].transformComponent,
c._updated=!1,c._dirty&&c.updateTransform();for(a in b)c=b[a].transformComponent,c._dirty&&this.updateWorldTransform(c)};d.prototype.updateWorldTransform=function(b){b.updateWorldTransform();for(var a in b.children)this.updateWorldTransform(b.children[a])};return d});n("goo/renderer/Loader",[],function(){function e(){this.crossOrigin="anonymous"}e.prototype.loadImage=function(d,b){var a=new Image,b=b!==void 0?b:{};a.addEventListener("load",function(){console.log("Loaded image: "+d);a.dataReady=!0;
if(b.onSuccess)b.onSuccess(a)},!1);a.addEventListener("error",function(){if(b.onError)b.onError("Couldn't load URL ["+d+"]")},!1);if(this.crossOrigin)a.crossOrigin=this.crossOrigin;a.src=d;return a};return e});n("goo/math/Vector2",["goo/math/Vector"],function(e){function d(){e.call(this,2);this.set(arguments.length!==0?arguments:[0,0])}d.prototype=Object.create(e.prototype);d.prototype.setupAliases([["x","u","s"],["y","v","t"]]);d.ZERO=new d(0,0);d.ONE=new d(1,1);d.UNIT_X=new d(1,0);d.UNIT_Y=new d(0,
1);d.add=function(b,a,c){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]+a[0];c.data[1]=b[1]+a[1];return c};d.prototype.add=function(b){return d.add(this,b,this)};d.sub=function(b,a,c){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",
message:"The arguments are of incompatible sizes."};c.data[0]=b[0]-a[0];c.data[1]=b[1]-a[1];return c};d.prototype.sub=function(b){return d.sub(this,b,this)};d.mul=function(b,a,c){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]*a[0];c.data[1]=b[1]*a[1];return c};d.prototype.mul=function(b){return d.mul(this,b,this)};d.div=
function(b,a,c){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==2||a.length!==2)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]/a[0];c.data[1]=b[1]/a[1];return c};d.prototype.div=function(b){return d.div(this,b,this)};d.dot=function(b,a){typeof b==="number"&&(b=[b,b]);typeof a==="number"&&(a=[a,a]);var c=b.data||b,f=a.data||a;if(c.length!==2||f.length!==2)throw{name:"Illegal Arguments",
message:"The arguments are of incompatible sizes."};var d=0;d+=c[0]*f[0];d+=c[1]*f[1];return d};d.prototype.dot=function(b){return d.dot(this,b)};return d});n("goo/renderer/Texture",["goo/renderer/Loader","goo/math/Vector3","goo/math/Vector2"],function(e,d,b){function a(a,f,d,e){this.glTexture=null;f=f||{};a&&this.setImage(a,f,d,e);this.wrapS=f.wrapS||"Repeat";this.wrapT=f.wrapT||"Repeat";this.magFilter=f.magFilter||"Bilinear";this.minFilter=f.minFilter||"Trilinear";this.anisotropy=f.anisotropy||
1;this.format=f.format||"RGBA";this.type=f.type||"UnsignedByte";this.variant="2D";this.offset=new b(0,0);this.repeat=new b(1,1);this.generateMipmaps=f.generateMipmaps||!0;this.premultiplyAlpha=f.premultiplyAlpha||!1;this.flipY=f.flipY||!0;this.needsUpdate=this.hasBorder=!1}a.prototype.setImage=function(a,b,d,e){this.image=a;var i=a instanceof Array?a[0]:a;if(i instanceof Uint8Array||i instanceof Uint16Array)if(d=d||a.width,e=e||a.height,d!==void 0&&e!==void 0)if(this.image={data:a},this.image.width=
d,this.image.height=e,this.image.isData=!0,this.image.dataReady=!0,i instanceof Uint8Array)b.type="UnsignedByte";else{if(i instanceof Uint16Array)b.type="UnsignedShort4444"}else throw"Data textures need width and height";else if(a instanceof Array)this.image={data:a}};a.CUBE_FACES="PositiveX,NegativeX,PositiveY,NegativeY,PositiveZ,NegativeZ".split(",");return a});n("goo/loaders/dds/DdsUtils",[],function(){function e(){}e.getDdsExtension=function(d){for(var b=["","WEBKIT_","MOZ_"],a=0;a<b.length;a++){var c=
d.getExtension(b[a]+"WEBGL_compressed_texture_s3tc");if(c!=null)return c}return null};e.isSupported=function(d){return e.getDdsExtension(d)!==null};e.shiftCount=function(d){if(d===0)return 0;for(var b=0;(d&1)===0;)if(d>>=1,b++,b>32)throw"invalid mask!";return b};e.isSet=function(d,b){return(d&b)===b};e.getIntFromString=function(d){for(var b=[],a=0;a<d.length;a++)b[a]=d.charCodeAt(a);return e.getIntFromBytes(b)};e.getIntFromBytes=function(d){var b=0;b|=(d[0]&255)<<0;d.length>1&&(b|=(d[1]&255)<<8);
d.length>2&&(b|=(d[2]&255)<<16);d.length>3&&(b|=(d[3]&255)<<24);return b};e.getComponents=function(d){switch(d){case "Alpha":return 1;case "RGB":return 3;case "RGBA":return 4;case "Luminance":return 1;case "LuminanceAlpha":return 2;case "PrecompressedDXT1":return 1;case "PrecompressedDXT1A":return 1;case "PrecompressedDXT3":return 2;case "PrecompressedDXT5":return 2}return 0};e.flipDXT=function(d,b,a,c){for(var f=new Uint8Array(d.length),b=b+3>>2,a=a+3>>2,g=e.getComponents(c)*8,j=0;j<a;j++)for(var i=
a-j-1,l=0;l<b;l++){var m=(i*b+l)*g,k=(j*b+l)*g;switch(c){case "PrecompressedDXT1":case "PrecompressedDXT1A":f[m+0]=d[k+0];f[m+1]=d[k+1];f[m+2]=d[k+2];f[m+3]=d[k+3];f[m+4]=d[k+7];f[m+5]=d[k+6];f[m+6]=d[k+5];f[m+7]=d[k+4];break;case "PrecompressedDXT3":f[m+0]=d[k+6];f[m+1]=d[k+7];f[m+2]=d[k+4];f[m+3]=d[k+5];f[m+4]=d[k+2];f[m+5]=d[k+3];f[m+6]=d[k+0];f[m+7]=d[k+1];f[m+8]=d[k+8];f[m+9]=d[k+9];f[m+10]=d[k+10];f[m+11]=d[k+11];f[m+12]=d[k+15];f[m+13]=d[k+14];f[m+14]=d[k+13];f[m+15]=d[k+12];break;case "PrecompressedDXT5":f[m+
0]=d[k+0],f[m+1]=d[k+1],e.getBytesFromUInt24(f,m+5,e.flipUInt24(e.getUInt24(d,k+2))),e.getBytesFromUInt24(f,m+2,e.flipUInt24(e.getUInt24(d,k+5))),f[m+8]=d[k+8],f[m+9]=d[k+9],f[m+10]=d[k+10],f[m+11]=d[k+11],f[m+12]=d[k+15],f[m+13]=d[k+14],f[m+14]=d[k+13],f[m+15]=d[k+12]}}return f};e.getUInt24=function(d,b){var a=0;a|=(d[b+0]&255)<<0;a|=(d[b+1]&255)<<8;a|=(d[b+2]&255)<<16;return a};e.getBytesFromUInt24=function(d,b,a){d[b+0]=a&255;d[b+1]=(a&65280)>>8;d[b+2]=(a&16711680)>>16};e.ThreeBitMask=7;e.flipUInt24=
function(d){for(var b=[],a=0;a<2;a++)b.push([0,0,0,0]);b[0][0]=d&e.ThreeBitMask;d>>=3;b[0][1]=d&e.ThreeBitMask;d>>=3;b[0][2]=d&e.ThreeBitMask;d>>=3;b[0][3]=d&e.ThreeBitMask;d>>=3;b[1][0]=d&e.ThreeBitMask;d>>=3;b[1][1]=d&e.ThreeBitMask;d>>=3;b[1][2]=d&e.ThreeBitMask;d>>=3;b[1][3]=d&e.ThreeBitMask;d=0;d|=b[1][0]<<0;d|=b[1][1]<<3;d|=b[1][2]<<6;d|=b[1][3]<<9;d|=b[0][0]<<12;d|=b[0][1]<<15;d|=b[0][2]<<18;d|=b[0][3]<<21;return d};return e});n("goo/loaders/dds/DdsLoader",["goo/loaders/dds/DdsUtils"],function(e){function d(){this.dwABitMask=
this.dwBBitMask=this.dwGBitMask=this.dwRBitMask=this.dwRGBBitCount=this.dwFourCC=this.dwFlags=this.dwSize=0}function b(){this.dwAlphaBitDepth=this.dwMipMapCount=this.dwDepth=this.dwLinearSize=this.dwWidth=this.dwHeight=this.dwFlags=this.dwSize=0;this.dwReserved1=[];this.ddpf=null;this.dwTextureStage=this.dwCaps4=this.dwCaps3=this.dwCaps2=this.dwCaps=0}function a(){this.flipVertically=!1;this.bpp=0;this.headerDX10=this.header=null;this.mipmapByteSizes=[]}function c(){}d.HEADER_OFFSET=19;d.DDPF_ALPHAPIXELS=
1;d.DDPF_ALPHA=2;d.DDPF_FOURCC=4;d.DDPF_RGB=64;d.DDPF_YUV=512;d.DDPF_LUMINANCE=131072;d.read=function(a){var b=new d;b.dwSize=a[d.HEADER_OFFSET+0];if(b.dwSize!==32)throw"invalid pixel format size: "+b.dwSize;b.dwFlags=a[d.HEADER_OFFSET+1];b.dwFourCC=a[d.HEADER_OFFSET+2];b.dwRGBBitCount=a[d.HEADER_OFFSET+3];b.dwRBitMask=a[d.HEADER_OFFSET+4];b.dwGBitMask=a[d.HEADER_OFFSET+5];b.dwBBitMask=a[d.HEADER_OFFSET+6];b.dwABitMask=a[d.HEADER_OFFSET+7];return b};b.DDSD_CAPS=1;b.DDSD_HEIGHT=2;b.DDSD_WIDTH=4;b.DDSD_PITCH=
8;b.DDSD_PIXELFORMAT=4096;b.DDSD_MIPMAPCOUNT=131072;b.DDSD_LINEARSIZE=524288;b.DDSD_DEPTH=8388608;b.DDSCAPS_COMPLEX=8;b.DDSCAPS_MIPMAP=4194304;b.DDSCAPS_TEXTURE=4096;b.DDSCAPS2_CUBEMAP=512;b.DDSCAPS2_CUBEMAP_POSITIVEX=1024;b.DDSCAPS2_CUBEMAP_NEGATIVEX=2048;b.DDSCAPS2_CUBEMAP_POSITIVEY=4096;b.DDSCAPS2_CUBEMAP_NEGATIVEY=8192;b.DDSCAPS2_CUBEMAP_POSITIVEZ=16384;b.DDSCAPS2_CUBEMAP_NEGATIVEZ=32768;b.DDSCAPS2_VOLUME=2097152;b.read=function(a){var c=new b;c.dwSize=a[1];if(c.dwSize!==124)throw"invalid dds header size: "+
c.dwSize;c.dwFlags=a[2];c.dwHeight=a[3];c.dwWidth=a[4];c.dwLinearSize=a[5];c.dwDepth=a[6];c.dwMipMapCount=a[7];c.dwAlphaBitDepth=a[8];for(var j=0;j<c.dwReserved1.length;j++)c.dwReserved1[j]=a[9+j];c.ddpf=d.read(a);c.dwCaps=a[27];c.dwCaps2=a[28];c.dwCaps3=a[29];c.dwCaps4=a[30];c.dwTextureStage=a[31];a=1+Math.ceil(Math.log(Math.max(c.dwHeight,c.dwWidth))/Math.log(2));e.isSet(c.dwCaps,b.DDSCAPS_MIPMAP)?e.isSet(c.dwFlags,b.DDSD_MIPMAPCOUNT)?c.dwMipMapCount!==a&&console.warn("Got "+c.dwMipMapCount+" mipmaps, expected "+
a):c.dwMipMapCount=a:c.dwMipMapCount=1;return c};a.prototype.calcMipmapSizes=function(a){for(var b=this.header.dwWidth,c=this.header.dwHeight,d=0,e=0;e<this.header.dwMipMapCount;e++)d=a?~~((b+3)/4)*~~((c+3)/4)*this.bpp*2:~~(b*c*this.bpp/8),this.mipmapByteSizes.push(~~((d+3)/4)*4),b=~~(b/2)>1?~~(b/2):1,c=~~(c/2)>1?~~(c/2):1};c.updateDepth=function(a,c){if(e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP)){var d=0;e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_POSITIVEX)&&d++;e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_NEGATIVEX)&&
d++;e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_POSITIVEY)&&d++;e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_NEGATIVEY)&&d++;e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_POSITIVEZ)&&d++;e.isSet(c.header.dwCaps2,b.DDSCAPS2_CUBEMAP_NEGATIVEZ)&&d++;if(d!==6)throw Error("Cubemaps without all faces defined are not currently supported.");a.depth=d}else a.depth=c.header.dwDepth>0?c.header.dwDepth:1};c.readDXT=function(a,b,c,d){d.image.isCompressed=!0;if(!c.flipVertically)return new Uint8Array(a.buffer,a.byteOffset+
0,b);for(var l=c.header.dwWidth,m=c.header.dwHeight,b=new Uint8Array(b),k=0,p=0;p<c.header.dwMipMapCount;p++){for(var t=[],o=0,h=c.mipmapByteSizes[p];o<h;o++)t.push(a[o+k]);t=e.flipDXT(t,l,m,d.format);b.set(t,k);k+=t.length;l=~~(l/2)>1?~~(l/2):1;m=~~(m/2)>1?~~(m/2):1}return b};c.readUncompressed=function(a,b,c,d,l,m,k,p){for(var t=e.shiftCount(k.header.ddpf.dwRBitMask),o=e.shiftCount(k.header.ddpf.dwGBitMask),h=e.shiftCount(k.header.ddpf.dwBBitMask),s=e.shiftCount(k.header.ddpf.dwABitMask),r=~~(k.header.ddpf.dwRGBBitCount/
8),p=e.getComponents(p.format)*1,b=new Uint8Array(b),v=k.header.dwWidth,u=k.header.dwHeight,x=0,q=0,w=0,B=[],w=0;w<r;w++)B.push(0);for(var z=0;z<k.header.dwMipMapCount;z++){for(var A=0;A<u;A++)for(var y=0;y<v;y++){for(w=0;w<r;w++)B[w]=a[q++];var w=e.getIntFromBytes(B),n=(w&k.header.ddpf.dwRBitMask)>>t,E=(w&k.header.ddpf.dwGBitMask)>>o,C=(w&k.header.ddpf.dwBBitMask)>>h,w=(w&k.header.ddpf.dwABitMask)>>s;l?b[x++]=w:d?(b[x++]=n,m&&(b[x++]=w)):c&&(b[x++]=n,b[x++]=E,b[x++]=C,m&&(b[x++]=w))}x+=v*u*p;v=~~(v/
2)>1?~~(v/2):1;u=~~(u/2)>1?~~(u/2):1}return b};c.populate=function(a,b,j){var i=b.header.ddpf.dwFlags,l=e.isSet(i,d.DDPF_FOURCC),m=e.isSet(i,d.DDPF_RGB),k=e.isSet(i,d.DDPF_ALPHAPIXELS),p=e.isSet(i,d.DDPF_LUMINANCE),i=e.isSet(i,d.DDPF_ALPHA);a.type="UnsignedByte";if(l){var t=b.header.ddpf.dwFourCC;if(t===e.getIntFromString("DXT1"))b.bpp=4,console.info("DDS format: DXT1A"),a.format="PrecompressedDXT1A";else if(t===e.getIntFromString("DXT3"))console.info("DDS format: DXT3"),b.bpp=8,a.format="PrecompressedDXT3";
else if(t===e.getIntFromString("DXT5"))console.info("DDS format: DXT5"),b.bpp=8,a.format="PrecompressedDXT5";else if(t===e.getIntFromString("DX10"))throw Error("dxt10 LATC formats not supported currently: "+b.headerDX10.dxgiFormat);else if(t===e.getIntFromString("DXT2"))throw"DXT2 is not supported.";else if(t===e.getIntFromString("DXT4"))throw"DXT4 is not supported.";else throw"unsupported compressed dds format found ("+t+")";}else if(b.bpp=b.header.ddpf.dwRGBBitCount,m)k?(console.info("DDS format: uncompressed rgba"),
a.format="RGBA"):(console.info("DDS format: uncompressed rgb "),a.format="RGB");else if(p||k)if(p&&k)console.info("DDS format: uncompressed LumAlpha"),a.format="LuminanceAlpha";else if(p)console.info("DDS format: uncompressed Lum"),a.format="Luminance";else{if(i)console.info("DDS format: uncompressed Alpha"),a.format="Alpha"}else throw Error("unsupported uncompressed dds format found.");b.calcMipmapSizes(l);a.image.mipmapSizes=b.mipmapByteSizes;for(var o=t=0;o<b.mipmapByteSizes.length;o++)t+=b.mipmapByteSizes[o];
for(var h=[],o=0;o<a.image.depth;o++)l?h.push(c.readDXT(j,t,b,a)):(m||p||i)&&h.push(c.readUncompressed(j,t,m,p,i,k,b,a));a.image.data=a.image.depth===1?h[0]:h;a.image.useArrays=!0};c.prototype.load=function(f,d,j,i,l){var m=new Int32Array(f,i+0,32);if(m[0]!==e.getIntFromString("DDS "))throw"Not a dds file.";console.info("Reading DDS file.");var k=new a;k.flipVertically=j;k.header=b.read(m);k.headerDX10=k.header.ddpf.dwFourCC===e.getIntFromString("DX10")?DdsHeaderDX10.read(Int32Array.create(f,i+128,
5)):null;j=d.image;if(j==null)j={},d.image=j;j.width=k.header.dwWidth;j.height=k.header.dwHeight;c.updateDepth(j,k);m=128+(k.headerDX10?20:0);c.populate(d,k,new Uint8Array(f,i+m,l-m));j.bpp=k.bpp;j.dataReady=!0;d.needsUpdate=!0};c.SUPPORTS_DDS=!1;c.prototype.isSupported=function(){return c.SUPPORTS_DDS};c.prototype.toString=function(){return"DdsLoader"};return c});n("goo/util/SimpleResourceUtil",[],function(){function e(){}e.countdown=function(d,b,a){d[0]--;if(d[0]===0)b.onSuccess(a)};e.loadTextAsset=
function(d,b,a,c,f,g){var j=new XMLHttpRequest;j.open("GET",a[b],!0);j.onreadystatechange=function(){if(j.readyState===4)if(j.status>=200&&j.status<=299)f[c[b]]=j.responseText,e.countdown(d,g,f);else g.onError(j.statusText)};j.send()};e.loadTextAssets=function(d,b,a){for(var c=[d.length],f={},g=0,j=d.length;g<j;g++)e.loadTextAsset(c,g,d,b,f,a)};e.loadBinaryAsArrayBuffer=function(d,b){var a=new XMLHttpRequest;a.open("GET",d);a.responseType="arraybuffer";a.onload=function(){if(a.status!==404)b.onSuccess(a.response);
else a.onerror(null)};a.onerror=function(){b.onError(null)};a.send()};return e});n("goo/renderer/Util",[],function(){function e(){}e.getByteSize=function(d){switch(d){case "Byte":return 1;case "UnsignedByte":return 1;case "Short":return 2;case "UnsignedShort":return 2;case "Int":return 4;case "HalfFloat":return 2;case "Float":return 4;case "Double":return 8}};e.checkGLError=function(d){for(var b=d.getError(),a=!1;b!==d.NO_ERROR;){a=!0;if(b===d.INVALID_ENUM)console.error("An unacceptable value is specified for an enumerated argument. The offending command is ignored and has no other side effect than to set the error flag.");
else if(b===d.INVALID_VALUE)console.error("A numeric argument is out of range. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===d.INVALID_OPERATION)console.error("The specified operation is not allowed in the current state. The offending command is ignored and has no other side effect than to set the error flag.");else if(b===d.FRAMEBUFFER_COMPLETE)console.error("The command is trying to render to or read from the framebuffer while the currently bound framebuffer is not framebuffer complete (i.e. the return value from glCheckFramebufferStatus is not GL_FRAMEBUFFER_COMPLETE). The offending command is ignored and has no other side effect than to set the error flag.");
else if(b===d.OUT_OF_MEMORY)throw"There is not enough memory left to execute the command. The state of the GL is undefined, except for the state of the error flags, after this error is recorded.";b=d.getError()}if(a)throw"Stopping due to error";};e.isPowerOfTwo=function(d){return(d&d-1)===0};e.nearestPowerOfTwo=function(d){return Math.pow(2,Math.ceil(Math.log(d)/Math.log(2)))};e.clone=function(d){if(null===d||"object"!=typeof d)return d;if(d instanceof Uint8Array)return d;if(d instanceof Date){var b=
new Date;b.setTime(d.getTime());return b}if(d instanceof Array){for(var b=[],a=0,c=d.length;a<c;++a)b[a]=e.clone(d[a]);return b}if(d instanceof Object){b={};for(a in d)d.hasOwnProperty(a)&&(b[a]=e.clone(d[a]));return b}throw Error("Unable to copy obj! Its type isn't supported.");};return e});n("goo/renderer/TextureCreator",["goo/renderer/Loader","goo/renderer/Texture","goo/loaders/dds/DdsLoader","goo/util/SimpleResourceUtil","goo/renderer/Util"],function(e,d,b,a,c){function f(a){a=a||{};this.verticalFlip=
a.verticalFlip!==void 0?a.verticalFlip:!0;this.textureLoaders={".dds":new b}}function g(a,b){return a.indexOf(b,a.length-b.length)!==-1}f.cache={};f.UNSUPPORTED_FALLBACK=".png";f.prototype.loadTexture2D=function(b){var j=this,m;for(m in this.textureLoaders)if(g(b.toLowerCase(),m)){var k=this.textureLoaders[m];console.log(m+" - "+k);if(!k||!k.isSupported()){b=b.substring(0,b.length-m.length);b+=f.UNSUPPORTED_FALLBACK;break}if(f.cache[b]!==void 0)return f.cache[b];var p=new d(c.clone(f.DEFAULT_TEXTURE_2D.image));
p.image.dataReady=!1;p.a=b;a.loadBinaryAsArrayBuffer(b,{onSuccess:function(a){k.load(a,p,j.verticalFlip,0,a.byteLength);console.info("Loaded image: "+b)},onError:function(a){console.warn("Error loading texture: "+b+" | "+a)}});return p}if(f.cache[b]!==void 0)return f.cache[b];m=(new e).loadImage(b);m=new d(m);return f.cache[b]=m};f.prototype.loadTextureCube=function(a){var b=6,c=new d;c.variant="CUBE";for(var f=[],g=0;g<a.length;g++)(function(d){(new e).loadImage(a[d],{onSuccess:function(a){f[d]=
a;b--;if(b<=0)c.setImage(f),c.image.dataReady=!0,c.image.isData=!1,c.image.width=a.width,c.image.height=a.height},onError:function(a){console.error(a)}})})(g);return c};var j=new Uint8Array([255,255,255,255]);f.DEFAULT_TEXTURE_2D=new d(j,null,1,1);f.DEFAULT_TEXTURE_CUBE=new d([j,j,j,j,j,j],null,1,1);f.DEFAULT_TEXTURE_CUBE.variant="CUBE";return f});n("goo/entities/EventHandler",[],function(){function e(){}e.listeners=[];e.dispatch=function(){if(arguments.length===0)throw Error("Event needs to specify a callback as first argument");
var d=arguments[0],b=Array.prototype.slice.call(arguments,1),a;for(a in e.listeners){var c=e.listeners[a];c[d]&&c[d].apply(null,b)}};e.addListener=function(d){e.listeners.indexOf(d)===-1&&e.listeners.push(d)};e.removeListener=function(d){d=e.listeners.indexOf(d);d!==-1&&e.listeners.splice(d,1)};return e});n("goo/entities/systems/RenderSystem",["goo/entities/systems/System","goo/renderer/TextureCreator","goo/renderer/Util","goo/entities/EventHandler"],function(e,d,b,a){function c(b){e.call(this,"RenderSystem",
null);this.renderList=b;this.doRender=!0;this.camera=null;this.lights=[];var c=this;a.addListener({setCurrentCamera:function(a){c.camera=a},setLights:function(a){c.lights=a}})}c.prototype=Object.create(e.prototype);c.prototype.render=function(a){a.checkResize(this.camera);this.doRender&&this.camera&&a.render(this.renderList,this.camera,this.lights)};return c});n("goo/math/Vector4",["goo/math/Vector"],function(e){function d(){e.call(this,4);this.set(arguments.length!==0?arguments:[0,0,0,0])}d.prototype=
Object.create(e.prototype);d.prototype.setupAliases([["x","r"],["y","g"],["z","b"],["w","a"]]);d.ZERO=new d(0,0,0,0);d.ONE=new d(1,1,1,1);d.UNIT_X=new d(1,0,0,0);d.UNIT_Y=new d(0,1,0,0);d.UNIT_Z=new d(0,0,1,0);d.UNIT_W=new d(0,0,0,1);d.add=function(b,a,c){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]+a[0];c.data[1]=
b[1]+a[1];c.data[2]=b[2]+a[2];c.data[3]=b[3]+a[3];return c};d.prototype.add=function(b){return d.add(this,b,this)};d.sub=function(b,a,c){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]-a[0];c.data[1]=b[1]-a[1];c.data[2]=b[2]-a[2];c.data[3]=b[3]-a[3];return c};d.prototype.sub=function(b){return d.sub(this,b,this)};
d.mul=function(b,a,c){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);c||(c=new d);b=b.data||b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]*a[0];c.data[1]=b[1]*a[1];c.data[2]=b[2]*a[2];c.data[3]=b[3]*a[3];return c};d.prototype.mul=function(b){return d.mul(this,b,this)};d.div=function(b,a,c){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);c||(c=new d);b=b.data||
b;a=a.data||a;if(b.length!==4||a.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};c.data[0]=b[0]/a[0];c.data[1]=b[1]/a[1];c.data[2]=b[2]/a[2];c.data[3]=b[3]/a[3];return c};d.prototype.div=function(b){return d.div(this,b,this)};d.dot=function(b,a){typeof b==="number"&&(b=[b,b,b,b]);typeof a==="number"&&(a=[a,a,a,a]);var c=b.data||b,f=a.data||a;if(c.length!==4||f.length!==4)throw{name:"Illegal Arguments",message:"The arguments are of incompatible sizes."};
var d=0;d+=c[0]*f[0];d+=c[1]*f[1];d+=c[2]*f[2];d+=c[3]*f[3];return d};d.prototype.dot=function(b){return d.dot(this,b)};d.prototype.lerp=function(b,a){this.x=(1-a)*this.x+a*b.x;this.y=(1-a)*this.y+a*b.y;this.z=(1-a)*this.z+a*b.z;this.w=(1-a)*this.w+a*b.w;return this};return d});n("goo/renderer/Plane",["goo/math/Vector3"],function(e){function d(b,a){this.normal=b||new e(0,1,0);this.constant=a||0}d.prototype.pseudoDistance=function(b){return _normal.dot(b)-_constant};d.prototype.whichSide=function(b){b=
pseudoDistance(b);return b<0?Side.Inside:b>0?Side.Outside:Side.Neither};d.prototype.reflectVector=function(b,a){var c=a;c===null&&(c=new e);var f=_normal.dot(b)*2;c.set(b).subtractLocal(_normal.getX()*f,_normal.getY()*f,_normal.getZ()*f);return c};return d});n("goo/renderer/Camera","goo/util/Handy,goo/math/Vector3,goo/math/Vector4,goo/math/Matrix4x4,goo/renderer/Plane,goo/math/MathUtils".split(","),function(e,d,b,a,c,f){function g(b,f,l,m){this.translation=new d(0,0,0);this._left=new d(-1,0,0);this._up=
new d(0,1,0);this._direction=new d(0,0,-1);e.defineProperty(this,"this._depthRangeNear",0,function(){this._depthRangeDirty=!0});e.defineProperty(this,"this._depthRangeFar",1,function(){this._depthRangeDirty=!0});this._depthRangeDirty=!0;this._frustumNear=1;this._frustumFar=2;this._frustumLeft=-0.5;this._frustumTop=this._frustumRight=0.5;this._frustumBottom=-0.5;this._coeffLeft=[];this._coeffRight=[];this._coeffBottom=[];this._coeffTop=[];this._viewPortLeft=0;this._viewPortTop=this._viewPortRight=
1;this._viewPortBottom=0;this._planeQuantity=6;this._worldPlane=[];for(var k=0;k<g.FRUSTUM_PLANES;k++)this._worldPlane[k]=new c;this._newDirection=new d;this.projectionMode=g.Perspective;this._updateInverseMVPMatrix=this._updateMVPMatrix=this._updatePMatrix=this._updateMVMatrix=!0;this.modelView=new a;this.projection=new a;this.modelViewProjection=new a;this.modelViewProjectionInverse=new a;this._viewPortDirty=this._depthRangeDirty=!0;this._planeState=0;this.setFrustumPerspective(b,f,l,m);this.onFrameChange()}
g.LEFT_PLANE=0;g.RIGHT_PLANE=1;g.BOTTOM_PLANE=2;g.TOP_PLANE=3;g.FAR_PLANE=4;g.NEAR_PLANE=5;g.FRUSTUM_PLANES=6;g.Perspective=0;g.Parallel=1;g.Custom=2;g.Outside=0;g.Inside=1;g.Intersects=2;g.prototype.normalize=function(){this._left.normalize();this._up.normalize();this._direction.normalize();onFrameChange()};g.prototype.setFrustumPerspective=function(a,b,c,d){if(a!==void 0&&a!==null)this.fov=a;if(b!==void 0&&b!==null)this.aspect=b;if(c!==void 0&&c!==null)this.near=c;if(d!==void 0&&d!==null)this.far=
d;a=Math.tan(this.fov*f.DEG_TO_RAD*0.5)*this.near;b=a*this.aspect;this._frustumLeft=-b;this._frustumRight=b;this._frustumBottom=-a;this._frustumTop=a;this._frustumNear=this.near;this._frustumFar=this.far;this.onFrustumChange()};g.prototype.setFrustum=function(a,b,c,f,d,g){this._frustumNear=a;this._frustumFar=b;this._frustumLeft=c;this._frustumRight=f;this._frustumTop=d;this._frustumBottom=g;this.onFrustumChange()};g.prototype.setFrame=function(a,b,c,f){this._left.copy(b);this._up.copy(c);this._direction.copy(f);
this.translation.copy(a);this.onFrameChange()};g.prototype.lookAt=function(a,b){this._newDirection.copy(a).sub(this.translation).normalize();this._newDirection.equals(this._direction)||(this._direction.copy(this._newDirection),this._up.copy(b).normalize(),this._up.equals(d.ZERO)&&this._up.copy(d.UNIT_Y),this._left.copy(this._up).cross(this._direction).normalize(),this._left.equals(d.ZERO)&&(this._direction.x!==0?this._left.set(this._direction.y,-this._direction.x,0):this._left.set(0,this._direction.z,
-this._direction.y)),this._up.copy(this._direction).cross(this._left).normalize(),this.onFrameChange())};g.prototype.makeDirty=function(){this._viewPortDirty=this._depthRangeDirty=!0};g.prototype.update=function(){this._depthRangeDirty=!0;this.onFrustumChange();this.onFrameChange()};g.prototype.setViewPort=function(a,b,c,f){setViewPortLeft(a);setViewPortRight(b);setViewPortBottom(c);setViewPortTop(f)};g.prototype.contains=function(a){if(!a)return g.Inside;for(var b=g.Inside,c=g.FRUSTUM_PLANES-1;c>=
0;c--)switch(a.whichSide(this._worldPlane[c])){case g.Inside:return g.Outside;case g.Neither:b=g.Intersects}return b};g.prototype.onFrustumChange=function(){if(this.projectionMode===g.Perspective){var a=this._frustumNear*this._frustumNear,b=this._frustumRight*this._frustumRight,c=this._frustumBottom*this._frustumBottom,f=this._frustumTop*this._frustumTop,d=1/Math.sqrt(a+this._frustumLeft*this._frustumLeft);this._coeffLeft[0]=this._frustumNear*d;this._coeffLeft[1]=-this._frustumLeft*d;d=1/Math.sqrt(a+
b);this._coeffRight[0]=-this._frustumNear*d;this._coeffRight[1]=this._frustumRight*d;d=1/Math.sqrt(a+c);this._coeffBottom[0]=this._frustumNear*d;this._coeffBottom[1]=-this._frustumBottom*d;d=1/Math.sqrt(a+f);this._coeffTop[0]=-this._frustumNear*d;this._coeffTop[1]=this._frustumTop*d}else this.projectionMode===g.Parallel&&(this._frustumRight>this._frustumLeft?(this._coeffLeft[0]=-1,this._coeffLeft[1]=0,this._coeffRight[0]=1):(this._coeffLeft[0]=1,this._coeffLeft[1]=0,this._coeffRight[0]=-1),this._coeffRight[1]=
0,this._frustumTop>this._frustumBottom?(this._coeffBottom[0]=-1,this._coeffBottom[1]=0,this._coeffTop[0]=1):(this._coeffBottom[0]=1,this._coeffBottom[1]=0,this._coeffTop[0]=-1),this._coeffTop[1]=0);this._updateInverseMVPMatrix=this._updateMVPMatrix=this._updatePMatrix=!0};g.prototype.onFrameChange=function(){var a=this._direction.dot(this.translation),b=new d;b.x=this._left.x*this._coeffLeft[0];b.y=this._left.y*this._coeffLeft[0];b.z=this._left.z*this._coeffLeft[0];b.add([this._direction.x*this._coeffLeft[1],
this._direction.y*this._coeffLeft[1],this._direction.z*this._coeffLeft[1]]);this._worldPlane[g.LEFT_PLANE].normal.copy(b);this._worldPlane[g.LEFT_PLANE].constant=this.translation.dot(b);b.x=this._left.x*this._coeffRight[0];b.y=this._left.y*this._coeffRight[0];b.z=this._left.z*this._coeffRight[0];b.add([this._direction.x*this._coeffRight[1],this._direction.y*this._coeffRight[1],this._direction.z*this._coeffRight[1]]);this._worldPlane[g.RIGHT_PLANE].normal.copy(b);this._worldPlane[g.RIGHT_PLANE].constant=
this.translation.dot(b);b.x=this._up.x*this._coeffBottom[0];b.y=this._up.y*this._coeffBottom[0];b.z=this._up.z*this._coeffBottom[0];b.add([this._direction.x*this._coeffBottom[1],this._direction.y*this._coeffBottom[1],this._direction.z*this._coeffBottom[1]]);this._worldPlane[g.BOTTOM_PLANE].normal.copy(b);this._worldPlane[g.BOTTOM_PLANE].constant=this.translation.dot(b);b.x=this._up.x*this._coeffTop[0];b.y=this._up.y*this._coeffTop[0];b.z=this._up.z*this._coeffTop[0];b.add([this._direction.x*this._coeffTop[1],
this._direction.y*this._coeffTop[1],this._direction.z*this._coeffTop[1]]);this._worldPlane[g.TOP_PLANE].normal.copy(b);this._worldPlane[g.TOP_PLANE].constant=this.translation.dot(b);if(this.projectionMode===g.Parallel)this._frustumRight>this._frustumLeft?(this._worldPlane[g.LEFT_PLANE].constant=this._worldPlane[g.LEFT_PLANE].contant+this._frustumLeft,this._worldPlane[g.RIGHT_PLANE].constant=this._worldPlane[g.RIGHT_PLANE].contant-this._frustumRight):(this._worldPlane[g.LEFT_PLANE].constant=this._worldPlane[g.LEFT_PLANE].contant-
this._frustumLeft,this._worldPlane[g.RIGHT_PLANE].constant=this._worldPlane[g.RIGHT_PLANE].contant+this._frustumRight),this._frustumBottom>this._frustumTop?(this._worldPlane[g.TOP_PLANE].constant=this._worldPlane[g.TOP_PLANE].contant+this._frustumTop,this._worldPlane[g.BOTTOM_PLANE].constant=this._worldPlane[g.BOTTOM_PLANE].contant-this._frustumBottom):(this._worldPlane[g.TOP_PLANE].constant=this._worldPlane[g.TOP_PLANE].contant-this._frustumTop,this._worldPlane[g.BOTTOM_PLANE].constant=this._worldPlane[g.BOTTOM_PLANE].contant+
this._frustumBottom);b.copy(this._direction).invert();this._worldPlane[g.FAR_PLANE].normal.copy(b);this._worldPlane[g.FAR_PLANE].constant=-(a+this._frustumFar);this._worldPlane[g.NEAR_PLANE].normal.copy(this._direction);this._worldPlane[g.NEAR_PLANE].constant=a+this._frustumNear;this._updateInverseMVPMatrix=this._updateMVPMatrix=this._updateMVMatrix=!0};g.prototype.updateProjectionMatrix=function(){if(this.projectionMode===g.Parallel)this.projection.setIdentity(),this.projection.e00=2/(this._frustumRight-
this._frustumLeft),this.projection.e11=2/(this._frustumTop-this._frustumBottom),this.projection.e22=-2/(this._frustumFar-this._frustumNear),this.projection.e03=-(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),this.projection.e13=-(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom),this.projection.e23=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear);else if(this.projectionMode===g.Perspective)this.projection.setIdentity(),
this.projection.e00=2*this._frustumNear/(this._frustumRight-this._frustumLeft),this.projection.e11=2*this._frustumNear/(this._frustumTop-this._frustumBottom),this.projection.e02=(this._frustumRight+this._frustumLeft)/(this._frustumRight-this._frustumLeft),this.projection.e12=(this._frustumTop+this._frustumBottom)/(this._frustumTop-this._frustumBottom),this.projection.e22=-(this._frustumFar+this._frustumNear)/(this._frustumFar-this._frustumNear),this.projection.e32=-1,this.projection.e23=-(2*this._frustumFar*
this._frustumNear)/(this._frustumFar-this._frustumNear),this.projection.e33=0};g.prototype.updateModelViewMatrix=function(){this.modelView.setIdentity();this.modelView.e00=-this._left.x;this.modelView.e01=-this._left.y;this.modelView.e02=-this._left.z;this.modelView.e10=this._up.x;this.modelView.e11=this._up.y;this.modelView.e12=this._up.z;this.modelView.e20=-this._direction.x;this.modelView.e21=-this._direction.y;this.modelView.e22=-this._direction.z;this.modelView.e03=this._left.dot(this.translation);
this.modelView.e13=-this._up.dot(this.translation);this.modelView.e23=this._direction.dot(this.translation)};g.prototype.getPickRay=function(a,b,c,f,g){g||(g=new Ray);var e=new d,t=new d;this.getWorldCoordinates(a,f-b,c,f,0,e);this.getWorldCoordinates(a,f-b,c,f,0.3,t).sub(e).normalize();g.origin.copy(e);g.direction.copy(t);return g};g.prototype.getWorldCoordinates=function(a,c,f,g,e,p){p||(p=new d);this.checkInverseModelViewProjection();var t=new b;t.set((a/f-this._viewPortLeft)/(this._viewPortRight-
this._viewPortLeft)*2-1,(c/g-this._viewPortBottom)/(this._viewPortTop-this._viewPortBottom)*2-1,e*2-1,1);this.modelViewProjectionInverse.applyPost(t);t.mul(1/t.w);p.x=t.x;p.y=t.y;p.z=t.z;return p};g.prototype.getScreenCoordinates=function(a,b,c,f){f=this.getNormalizedDeviceCoordinates(a,f);f.x=(f.x+1)*(this._viewPortRight-this._viewPortLeft)/2*b;f.y=(f.y+1)*(this._viewPortTop-this._viewPortBottom)/2*c;f.z=(f.z+1)/2;return f};g.prototype.getFrustumCoordinates=function(a,b){b=this.getNormalizedDeviceCoordinates(a,
b);b.x=(b.x+1)*(this._frustumRight-this._frustumLeft)/2+this._frustumLeft;b.y=(b.y+1)*(this._frustumTop-this._frustumBottom)/2+this._frustumBottom;b.z=(b.z+1)*(this._frustumFar-this._frustumNear)/2+this._frustumNear;return b};g.prototype.getNormalizedDeviceCoordinates=function(a,c){c||(c=new d);this.checkModelViewProjection();var f=new b;f.set(a.x,a.y,a.z,1);this.modelViewProjection.applyPost(f);f.mul(1/f.w);c.x=f.x;c.y=f.y;c.z=f.z;return c};g.prototype.checkModelView=function(){if(this._updateMVMatrix)this.updateModelViewMatrix(),
this._updateMVMatrix=!1};g.prototype.checkProjection=function(){if(this._updatePMatrix)this.updateProjectionMatrix(),this._updatePMatrix=!1};g.prototype.checkModelViewProjection=function(){if(this._updateMVPMatrix)this.checkModelView(),this.checkProjection(),this.modelViewProjection.copy(this.getProjectionMatrix()).combine(this.getViewMatrix()),this._updateMVPMatrix=!1};g.prototype.checkInverseModelViewProjection=function(){if(this._updateInverseMVPMatrix)this.checkModelViewProjection(),a.invert(this.modelViewProjection,
this.modelViewProjectionInverse),this._updateInverseMVPMatrix=!1};g.prototype.getViewMatrix=function(){this.checkModelView();return this.modelView};g.prototype.getProjectionMatrix=function(){this.checkProjection();return this.projection};g.prototype.getViewProjectionMatrix=function(){this.checkModelViewProjection();return this.modelViewProjection};g.prototype.getViewProjectionInverseMatrix=function(){this.checkInverseModelViewProjection();return this.modelViewProjectionInverse};g.prototype.toString=
function(){return"com.ardor3d.renderer.Camera: loc - "+Arrays.toString(getLocation().toArray(null))+" dir - "+Arrays.toString(getDirection().toArray(null))+" up - "+Arrays.toString(getUp().toArray(null))+" left - "+Arrays.toString(getLeft().toArray(null))};return g});n("goo/renderer/BoundingSphere",["goo/math/Transform","goo/math/Vector3","goo/renderer/Camera"],function(e,d,b){function a(){this.center=new d;this.radius=1;this._checkPlane=0}a.prototype.computeFromPoints=function(a){for(var b=new d,
g=new d(Infinity,Infinity,Infinity),e=new d(-Infinity,-Infinity,-Infinity),i,l,m,k=0;k<a.length;k+=3)i=a[k+0],l=a[k+1],m=a[k+2],g.x=i<g.x?i:g.x,g.y=l<g.y?l:g.y,g.z=m<g.z?m:g.z,e.x=i>e.x?i:e.x,e.y=l>e.y?l:e.y,e.z=m>e.z?m:e.z;g=e.add(g).div(2);for(k=e=0;k<a.length;k+=3)b.set(a[k],a[k+1],a[k+2]),i=b.sub(g).length(),i>e&&(e=i);this.radius=e/1;this.center.copy(g)};a.prototype.transform=function(b,f){f===null&&(f=new a);b.applyForward(this.center,f.center);f.radius=Math.abs(this._maxAxis(b.scale)*this.radius);
return f};a.prototype.whichSide=function(a){a=this._pseudoDistance(a,this.center);return a<-this.radius?b.Inside:a>this.radius?b.Outside:b.Intersects};a.prototype._pseudoDistance=function(a,b){return a.normal.x*b.x+a.normal.y*b.y+a.normal.z*b.z-a.constant};a.prototype._maxAxis=function(a){return Math.max(Math.abs(a.x),Math.max(Math.abs(a.y),Math.abs(a.z)))};a.prototype.toString=function(){var a=Math.round(this.center.x*10)/10,b=Math.round(this.center.y*10)/10,d=Math.round(this.center.z*10)/10,e=Math.round(this.radius*
10)/10;return"["+a+","+b+","+d+"] - "+e};a.prototype.intersectsRay=function(a){if(!this.center)return!1;var b=(new d).copy(a.origin).sub(this.center),e=b.dot(b)-this.radius*this.radius;if(e<=0)return!0;a=a.direction.dot(b);return a>=0?!1:a*a>=e};a.prototype.intersectsRayWhere=function(a){var b=(new d).copy(a.origin).sub(this.center),e=b.dot(b)-this.radius*this.radius;if(e<=0)return b=a.direction.dot(b),e=Math.sqrt(b*b-e),b=[e-b],a=[(new d).copy(a.direction).mul(b[0]).add(a.origin)],{distances:b,points:a};
b=a.direction.dot(b);if(b>=0)return null;e=b*b-e;if(e<0)return null;else if(e>=1.0E-5)return e=Math.sqrt(e),b=[-b-e,-b+e],a=[(new d).copy(a.direction).mul(b[0]).add(a.origin),(new d).copy(a.direction).mul(b[1]).add(a.origin)],{distances:b,points:a};b=[-b];a=[(new d).copy(a.direction).mul(b[0]).add(a.origin)];return{distances:b,points:a}};return a});n("goo/entities/components/MeshDataComponent",["goo/renderer/BoundingSphere","goo/entities/components/Component"],function(e,d){function b(a){this.type=
"MeshDataComponent";this.meshData=a;this.modelBound=new e;this.autoCompute=!0}b.prototype=Object.create(d.prototype);b.prototype.setModelBound=function(a,b){this.modelBound=a;this.autoCompute=b};b.prototype.computeBoundFromPoints=function(){if(this.autoCompute&&this.modelBound!==null){var a=this.meshData.getAttributeBuffer("POSITION");if(a!==void 0)this.modelBound.computeFromPoints(a),this.autoCompute=!1}};return b});n("goo/entities/components/MeshRendererComponent",["goo/entities/components/Component"],
function(e){function d(){this.type="MeshRendererComponent";this.materials=[];this.worldBound=null;this.receiveShadow=this.castShadow=!1}d.prototype=Object.create(e.prototype);d.prototype.updateBounds=function(b,a){this.worldBound=b.transform(a,this.worldBound)};return d});n("goo/entities/systems/PartitioningSystem",["goo/entities/systems/System","goo/entities/EventHandler"],function(e,d){function b(){e.call(this,"PartitioningSystem",["MeshRendererComponent"]);this.partitioner=null;this.renderList=
[];this.camera=null;var a=this;d.addListener({setCurrentCamera:function(b){a.camera=b}})}b.prototype=Object.create(e.prototype);b.prototype.inserted=function(a){this.partitioner&&this.partitioner.added(a)};b.prototype.deleted=function(a){this.partitioner&&this.partitioner.removed(a)};b.prototype.process=function(a){this.renderList.length=0;this.partitioner&&this.camera&&this.partitioner.process(this.camera,a,this.renderList)};return b});n("goo/renderer/BufferData",[],function(){return function(e,
d){this.data=e;this.target=d;this.glBuffer=null;this._dataUsage="StaticDraw";this._dataNeedsRefresh=!1}});n("goo/renderer/BufferUtils",[],function(){function e(){}e.createIndexBuffer=function(d,b){var a;if(b<256)a=new Uint8Array(d);else if(b<65536)a=new Uint16Array(d);else throw Error("Maximum number of vertices is 65535. Got: "+b);return a};return e});n("goo/renderer/MeshData",["goo/renderer/BufferData","goo/renderer/Util","goo/renderer/BufferUtils"],function(e,d,b){function a(b,c,f){this.attributeMap=
b;this.vertexCount=c!==void 0?c:0;this.indexCount=f!==void 0?f:0;this.indexLengths=this.indexData=this.vertexData=null;this.indexModes=["Triangles"];this.type=a.MESH;this.rebuildData(this.vertexCount,this.indexCount)}function c(a){for(var b={},c=0;c<a.length;c++){var f=a[c];if(j[f]!==void 0)b[f]=d.clone(j[f]);else throw"No default attribute named: "+f;}return b}var f=window.Uint8ClampedArray;a.MESH=0;a.SKINMESH=1;a.prototype.rebuildData=function(a,b,c){if(c){var f={},d=null,e;for(e in this.attributeMap){var g=
this.attributeMap[e];if(g.array)f[e]=g.array}if(this.indexData)d=this.indexData.data}this.rebuildVertexData(a);this.rebuildIndexData(b);if(c){for(e in this.attributeMap)if(a=f[e])g=this.attributeMap[e],g.array.set(a);d&&this.indexData.data.set(d)}};a.prototype.rebuildVertexData=function(a){if(a!==void 0)this._vertexCountStore=this.vertexCount=a;var a=0,b;for(b in this.attributeMap){var c=this.attributeMap[b];a+=d.getByteSize(c.type)*c.count}this.vertexData=new e(new ArrayBuffer(a*this.vertexCount),
"ArrayBuffer");this.generateAttributeData()};a.prototype.rebuildIndexData=function(a){if(a!==void 0)this.indexCount=a;if(this.indexCount>0)a=b.createIndexBuffer(this.indexCount,this.vertexCount),this.indexData=new e(a,"ElementArrayBuffer")};var g={Byte:Int8Array,UnsignedByte:Uint8Array,UnsignedByteClamped:f,Short:Int16Array,UnsignedShort:Uint16Array,Int:Int32Array,UnsignedInt:Uint32Array,Float:Float32Array,Double:Float64Array};a.prototype.generateAttributeData=function(){var a=this.vertexData.data,
b,c=0,f;for(f in this.attributeMap){b=this.attributeMap[f];b.offset=c;var e=this.vertexCount*b.count;c+=e*d.getByteSize(b.type);var j=g[b.type];if(j)b=new j(a,b.offset,e);else throw"Unsupported DataType: "+b.type;this.attributeMap[f].array=b}};a.prototype.getAttributeBuffer=function(a){return this.attributeMap[a].array};a.prototype.getIndexData=function(){return this.indexData};a.prototype.getIndexBuffer=function(){return this.indexData!==null?this.indexData.data:null};a.prototype.getIndexLengths=
function(){return this.indexLengths};a.prototype.getIndexModes=function(){return this.indexModes};a.prototype.resetVertexCount=function(){this.vertexCount=this.vertexCountStore};a.POSITION="POSITION";a.NORMAL="NORMAL";a.COLOR="COLOR";a.TANGENT="TANGENT";a.TEXCOORD0="TEXCOORD0";a.TEXCOORD1="TEXCOORD1";a.TEXCOORD2="TEXCOORD2";a.TEXCOORD3="TEXCOORD3";a.WEIGHTS="WEIGHTS";a.JOINTIDS="JOINTIDS";a.createAttribute=function(a,b){return{count:a,type:b}};var j={POSITION:a.createAttribute(3,"Float"),NORMAL:a.createAttribute(3,
"Float"),COLOR:a.createAttribute(4,"Float"),TANGENT:a.createAttribute(4,"Float"),TEXCOORD0:a.createAttribute(2,"Float"),TEXCOORD1:a.createAttribute(2,"Float"),TEXCOORD2:a.createAttribute(2,"Float"),TEXCOORD3:a.createAttribute(2,"Float"),WEIGHTS:a.createAttribute(4,"Float"),JOINTIDS:a.createAttribute(4,"Short")};a.defaultMap=function(a){return a===void 0?c(Object.keys(j)):c(a)};return a});n("goo/renderer/RendererRecord",[],function(){function e(){this.currentBuffer={ArrayBuffer:{buffer:null,valid:!1},
ElementArrayBuffer:{buffer:null,valid:!1}};this.currentFrameBuffer=null;this.clippingTestEnabled=this.clippingTestValid=!1;this.clips=[];this.enabledTextures=0;this.texturesValid=!1;this.currentTextureArraysUnit=0;this.textureRecord=[];this.usedProgram=null;this.boundAttributes=[];this.depthRecord={};this.cullRecord={};this.blendRecord={};this.offsetRecord={}}e.prototype.invalidateBuffer=function(d){this.currentBuffer[d].buffer=null;this.currentBuffer[d].valid=!1};return e});n("goo/renderer/pass/RenderTarget",
["goo/math/Vector2"],function(e){function d(b,a,c){this._glFrameBuffer=this._glRenderBuffer=this.glTexture=null;this.width=b;this.height=a;c=c||{};this.wrapS=c.wrapS!==void 0?c.wrapS:"EdgeClamp";this.wrapT=c.wrapT!==void 0?c.wrapT:"EdgeClamp";this.magFilter=c.magFilter!==void 0?c.magFilter:"Bilinear";this.minFilter=c.minFilter!==void 0?c.minFilter:"Trilinear";this.anisotropy=c.anisotropy!==void 0?c.anisotropy:1;this.offset=new e(0,0);this.repeat=new e(1,1);this.format=c.format!==void 0?c.format:"RGBA";
this.type=c.type!==void 0?c.type:"UnsignedByte";this.variant="2D";this.depthBuffer=c.depthBuffer!==void 0?c.depthBuffer:!0;this.stencilBuffer=c.stencilBuffer!==void 0?c.stencilBuffer:!0;this.generateMipmaps=!1}d.prototype.clone=function(){var b=new d(this.width,this.height);b.wrapS=this.wrapS;b.wrapT=this.wrapT;b.magFilter=this.magFilter;b.anisotropy=this.anisotropy;b.minFilter=this.minFilter;b.offset.copy(this.offset);b.repeat.copy(this.repeat);b.format=this.format;b.type=this.type;b.variant=this.variant;
b.depthBuffer=this.depthBuffer;b.stencilBuffer=this.stencilBuffer;b.generateMipmaps=this.generateMipmaps;return b};return d});n("goo/renderer/ShaderCall",[],function(){function e(a,b,f){this.context=a;this.location=b;if(f)switch(f){case "float":this.typeCall=this.uniform1f;break;case "bool":case "int":case "integer":case "sampler2D":case "sampler3D":case "samplerCube":this.typeCall=this.uniform1i;break;case "floatarray":this.typeCall=this.uniform1fv;break;case "intarray":this.typeCall=this.uniform1iv;
break;case "vec2":this.typeCall=this.uniform2fv;break;case "vec3":this.typeCall=this.uniform3fv;break;case "vec4":this.typeCall=this.uniform4fv;break;case "mat2":this.typeCall=this.uniformMatrix2fv;break;case "mat3":this.typeCall=this.uniformMatrix3fv;break;case "mat4":this.typeCall=this.uniformMatrix4fv;break;default:throw"Uniform type not handled: "+f;}}function d(a,b,f){for(var d=!0,e=0;e<f;e++)if(Math.abs(a[e]-b[e])>1.0E-8){d=!1;break}return d}function b(a,b){var f=a.length;if(f!==b.length)return!1;
for(var d=0;d<f;d++)if(a[d]!==b[d])return!1;return!0}e.prototype.call=function(a){this.typeCall(a)};e.prototype.uniform1f=function(a){if(this.location.value!==a)this.context.uniform1f(this.location,a),this.location.value=a};e.prototype.uniform1fv=function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform1fv(this.location,a),this.location.value=a};e.prototype.uniform1i=function(a){if(this.location.value!==a)this.context.uniform1i(this.location,a),this.location.value=a};e.prototype.uniform1iv=
function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform1iv(this.location,a),this.location.value=a};e.prototype.uniform2f=function(a,b){var f=this.location.value;if(!(f!==void 0&&f.length===2&&f[0]===a&&f[1]===b))this.context.uniform2f(this.location,a,b),this.location.value=[a,b]};e.prototype.uniform2fv=function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform2fv(this.location,a),this.location.value=a};e.prototype.uniform2i=function(a,b){var f=
this.location.value;if(!(f!==void 0&&f.length===2&&f[0]===a&&f[1]===b))this.context.uniform2i(this.location,a,b),this.location.value=[a,b]};e.prototype.uniform2iv=function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform2iv(this.location,a),this.location.value=a};e.prototype.uniform3f=function(a,b,f){var d=this.location.value;if(!(d!==void 0&&d.length===3&&d[0]===a&&d[1]===b&&d[2]===f))this.context.uniform3f(this.location,a,b,f),this.location.value=[a,b,f]};e.prototype.uniform3fv=
function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform3fv(this.location,a),this.location.value=a};e.prototype.uniform3i=function(a,b,d){var e=this.location.value;if(!(e!==void 0&&e.length===3&&e[0]===a&&e[1]===b&&e[2]===d))this.context.uniform3i(this.location,a,b,d),this.location.value=[a,b,d]};e.prototype.uniform3iv=function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform3iv(this.location,a),this.location.value=a};e.prototype.uniform4f=function(a,
b,d,e){var j=this.location.value;if(!(j!==void 0&&j.length===4&&j[0]===a&&j[1]===b&&j[2]===d&&j[3]===e))this.context.uniform4f(this.location,a,b,d,e),this.location.value=[a,b,d,e]};e.prototype.uniform4fv=function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform4fv(this.location,a),this.location.value=a};e.prototype.uniform4i=function(a,b,d,e){var j=this.location.value;if(!(j!==void 0&&j.length===4&&j[0]===a&&j[1]===b&&j[2]===d&&j[3]===e))this.context.uniform4i(this.location,
a,b,d,e),this.location.value=[a,b,d,e]};e.prototype.uniform4iv=function(a){var c=this.location.value;if(!(c!==void 0&&b(a,c)))this.context.uniform4iv(this.location,a),this.location.value=a};e.prototype.uniformMatrix2fv=function(a,b){b=b===!0;if(a.data){var f=this.location.value;if(f!==void 0)if(d(f.data,a.data,4))return;else f.copy(a);else this.location.value=a.clone();this.context.uniformMatrix2fv(this.location,b,a.data)}else this.context.uniformMatrix2fv(this.location,b,a)};e.prototype.uniformMatrix3fv=
function(a,b){b=b===!0;if(a.data){var f=this.location.value;if(f!==void 0)if(d(f.data,a.data,9))return;else f.copy(a);else this.location.value=a.clone();this.context.uniformMatrix3fv(this.location,b,a.data)}else this.context.uniformMatrix3fv(this.location,b,a)};e.prototype.uniformMatrix4fv=function(a,b){b=b===!0;if(a.data){var f=this.location.value;if(f!==void 0)if(d(f.data,a.data,16))return;else f.copy(a);else this.location.value=a.clone();this.context.uniformMatrix4fv(this.location,b,a.data)}else this.context.uniformMatrix4fv(this.location,
b,a)};return e});n("goo/renderer/RenderQueue",["goo/math/Vector3"],function(e){function d(){var b=this,a=new e;this.opaqueSorter=function(c,d){var e=c.meshRendererComponent.materials[0].shader,j=d.meshRendererComponent.materials[0].shader;return e._id===j._id?(j=c.meshRendererComponent.worldBound,e=d.meshRendererComponent.worldBound,j=a.copy(b.camera.translation).sub(j.center).lengthSquared(),e=a.copy(b.camera.translation).sub(e.center).lengthSquared(),j-e):e._id-j._id};this.transparentSorter=function(c,
d){var e=c.meshRendererComponent.worldBound,j=d.meshRendererComponent.worldBound,e=a.copy(b.camera.translation).sub(e.center).lengthSquared();return a.copy(b.camera.translation).sub(j.center).lengthSquared()-e}}d.prototype.sort=function(b,a){var c=0;this.camera=a;for(var f={},e=0;e<b.length;e++){var j=b[e];if(j.meshRendererComponent){var i=j.meshRendererComponent.materials[0].getRenderQueue(),l=f[i];l||(l=[],f[i]=l);l.push(j)}else b[c]=j,c++}for(var m in f){l=f[m];m<=d.TRANSPARENT?l.sort(this.opaqueSorter):
l.sort(this.transparentSorter);for(e=0;e<l.length;e++)b[c]=l[e],c++}};d.BACKGROUND=0;d.OPAQUE=1E3;d.TRANSPARENT=2E3;d.OVERLAY=3E3;return d});n("goo/renderer/Shader","goo/renderer/ShaderCall,goo/renderer/Util,goo/math/Matrix4x4,goo/math/Vector3,goo/entities/World,goo/renderer/RenderQueue".split(","),function(e,d,b,a,c,f){function g(a,b){if(!b.vshader||!b.fshader)throw Error("Missing shader sources for shader: "+a);this.name=a;this.vertexSource=b.vshader;this.fragmentSource=b.fshader;this.shaderProgram=
null;this.attributeMapping={};this.attributeIndexMapping={};this.uniformMapping={};this.uniformCallMapping={};this.textureSlots=[];this.defaultCallbacks={};j(this.defaultCallbacks);this.currentCallbacks={};this.defines=b.defines;this.attributes=b.attributes;this.uniforms=b.uniforms;this.renderQueue=f.OPAQUE;this._id=g.id++}function j(d){var f=new b;d[g.PROJECTION_MATRIX]=function(a,b){var c=b.camera.getProjectionMatrix();a.uniformMatrix4fv(c)};d[g.VIEW_MATRIX]=function(a,b){var c=b.camera.getViewMatrix();
a.uniformMatrix4fv(c)};d[g.WORLD_MATRIX]=function(a,b){a.uniformMatrix4fv(b.transform!==void 0?b.transform.matrix:f)};for(var e=0;e<16;e++)d[g["TEXTURE"+e]]=function(a){return function(b){b.uniform1i(a)}}(e);for(var i=new a(-20,20,20),e=0;e<4;e++)d[g["LIGHT"+e]]=function(a){return function(b,c){var d=c.lights[a];d!==void 0?b.uniform3f(d.translation.x,d.translation.y,d.translation.z):b.uniform3f(i.x,i.y,i.z)}}(e);d[g.CAMERA]=function(a,b){var c=b.camera.translation;a.uniform3f(c.x,c.y,c.z)};d[g.NEAR_PLANE]=
function(a,b){a.uniform1f(b.camera._frustumNear)};d[g.FAR_PLANE]=function(a,b){a.uniform1f(b.camera._frustumFar)};var j={r:0.1,g:0.1,b:0.1,a:1},h={r:0,g:0,b:0,a:0},s={r:1,g:1,b:1,a:1},r={r:0.8,g:0.8,b:0.8,a:1};d[g.AMBIENT]=function(a,b){var c=b.material.materialState!==void 0?b.material.materialState.ambient:j;a.uniform4f(c.r,c.g,c.b,c.a)};d[g.EMISSIVE]=function(a,b){var c=b.material.materialState!==void 0?b.material.materialState.emissive:h;a.uniform4f(c.r,c.g,c.b,c.a)};d[g.DIFFUSE]=function(a,b){var c=
b.material.materialState!==void 0?b.material.materialState.diffuse:s;a.uniform4f(c.r,c.g,c.b,c.a)};d[g.SPECULAR]=function(a,b){var c=b.material.materialState!==void 0?b.material.materialState.specular:r;a.uniform4f(c.r,c.g,c.b,c.a)};d[g.SPECULAR_POWER]=function(a,b){a.uniform1f(b.material.materialState!==void 0?b.material.materialState.shininess:8)};d[g.TIME]=function(a){a.uniform1f(c.time)}}var i=window.WebGLRenderingContext;g.id=0;var l=/\b(attribute|uniform)\s+(float|int|bool|vec2|vec3|vec4|mat3|mat4|sampler2D|sampler3D|samplerCube)\s+(\w+)(\s*\[\s*\w+\s*\])*;/g;
g.prototype.apply=function(a,b){var c=b.context,d=b.rendererRecord;this.shaderProgram===null&&(this._investigateShaders(),this.addDefines(this.defines),this.compile(b));if(d.usedProgram!==this.shaderProgram)c.useProgram(this.shaderProgram),d.usedProgram=this.shaderProgram;if(this.attributes){var c=a.meshData.attributeMap,f;for(f in this.attributes){var e=c[this.attributes[f]];if(e){var g=this.attributeIndexMapping[f];g!==void 0&&b.bindVertexAttribute(g,e.count,e.type,e.normalized,0,e.offset,d)}}}if(this.uniforms)for(var r in this.uniforms)if(d=
this.uniformCallMapping[r]){f=this.uniforms[r];try{if(typeof f==="string"){var i=this.currentCallbacks[r];i&&i(d,a)}else{var j=typeof f==="function"?f(a):f;d.call(j)}}catch(x){}}};g.prototype.rebuild=function(){this.shaderProgram=null;this.attributeMapping={};this.attributeIndexMapping={};this.uniformMapping={};this.uniformCallMapping={};this.currentCallbacks={}};g.prototype._investigateShaders=function(){this.textureSlots=[];this._investigateShader(this.vertexSource);this._investigateShader(this.fragmentSource)};
g.prototype._investigateShader=function(a){l.lastIndex=0;for(var b=l.exec(a);b!==null;){b={type:b[1],format:b[2],variableName:b[3],arrayName:b[4]};if(b.arrayName)if(b.format==="float")b.format="floatarray";else if(b.format==="int")b.format="intarray";"attribute"===b.type?this.attributeMapping[b.variableName]=b:(b.format.indexOf("sampler")===0&&this.textureSlots.push({format:b.format,name:b.variableName}),this.uniformMapping[b.variableName]=b);b=l.exec(a)}};g.prototype.compile=function(a){var a=a.context,
b=this._getShader(a,i.VERTEX_SHADER,this.vertexSource),c=this._getShader(a,i.FRAGMENT_SHADER,this.fragmentSource);(b===null||c===null)&&console.error("Shader error - no shaders");this.shaderProgram=a.createProgram();var d=a.getError();(this.shaderProgram===null||d!==i.NO_ERROR)&&console.error("Shader error: "+d+" [shader: "+this.name+"]");a.attachShader(this.shaderProgram,b);a.attachShader(this.shaderProgram,c);a.linkProgram(this.shaderProgram);a.getProgramParameter(this.shaderProgram,i.LINK_STATUS)||
console.error("Could not initialise shaders: "+a.getProgramInfoLog(this.shaderProgram));for(var f in this.attributeMapping)b=a.getAttribLocation(this.shaderProgram,f),b===-1?console.warn("Attribute ["+this.attributeMapping[f]+"/"+f+"] variable not found in shader. Probably unused and optimized away."):this.attributeIndexMapping[f]=b;for(f in this.uniformMapping)b=a.getUniformLocation(this.shaderProgram,f),b===null?console.warn("Uniform ["+f+"] variable not found in shader. Probably unused and optimized away. "+
f):this.uniformCallMapping[f]=new e(a,b,this.uniformMapping[f].format);if(this.attributes){for(var g in this.attributes)a=this.attributeIndexMapping[g],a===void 0&&console.warn("No attribute found for binding: "+g+" ["+this.name+"]["+this._id+"]");for(g in this.attributeIndexMapping)a=this.attributes[g],a===void 0&&console.warn("No binding found for attribute: "+g+" ["+this.name+"]["+this._id+"]")}if(this.uniforms){if(this.uniforms.$link){a=this.uniforms.$link instanceof Array?this.uniforms.$link:
[this.uniforms.$link];for(b=0;b<a.length;b++)for(f in c=a[b],c)this.uniforms[f]=c[f];delete this.uniforms.$link}for(g in this.uniforms)a=this.uniformCallMapping[g],a===void 0&&console.warn("No uniform found for binding: "+g+" ["+this.name+"]["+this._id+"]"),f=this.uniforms[g],this.defaultCallbacks[f]&&(this.currentCallbacks[g]=this.defaultCallbacks[f]);for(g in this.uniformCallMapping)a=this.uniforms[g],a===void 0&&console.warn("No binding found for uniform: "+g+" ["+this.name+"]["+this._id+"]")}console.log("Shader ["+
this.name+"]["+this._id+"] compiled")};g.prototype._getShader=function(a,b,c){b=a.createShader(b);a.shaderSource(b,c);a.compileShader(b);return!a.getShaderParameter(b,i.COMPILE_STATUS)?(console.error("Shader ["+this.name+"]["+this._id+"] "+a.getShaderInfoLog(b)),null):b};g.prototype.addDefines=function(a){if(a)a=this.generateDefines(a),this.vertexSource=a+"\n"+this.vertexSource,this.fragmentSource=a+"\n"+this.fragmentSource};g.prototype.generateDefines=function(a){var b=[],c;for(c in a){var d=a[c];
d!==!1&&b.push("#define "+c+" "+d)}return b.join("\n")};g.prototype.toString=function(){return this.name};g.PROJECTION_MATRIX="PROJECTION_MATRIX";g.VIEW_MATRIX="VIEW_MATRIX";g.WORLD_MATRIX="WORLD_MATRIX";for(d=0;d<16;d++)g["TEXTURE"+d]="TEXTURE"+d;for(d=0;d<4;d++)g["LIGHT"+d]="LIGHT"+d;g.CAMERA="CAMERA";g.AMBIENT="AMBIENT";g.EMISSIVE="EMISSIVE";g.DIFFUSE="DIFFUSE";g.SPECULAR="SPECULAR";g.SPECULAR_POWER="SPECULAR_POWER";g.NEAR_PLANE="NEAR_PLANE";g.FAR_PLANE="FAR_PLANE";g.TIME="TIME";return g});n("goo/renderer/shaders/ShaderFragments",
[],function(){function e(){}e.features={fog:{attributes:{}}};e.methods={packDepth:"vec4 packDepth( const in float depth ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = fract( depth * bit_shift );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}",unpackDepth:"float unpackDepth( const in vec4 rgba_depth ) {\n\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\tfloat depth = dot( rgba_depth, bit_shift );\n\treturn depth;\n}"};
return e});n("goo/renderer/Material",["goo/renderer/Shader","goo/renderer/TextureCreator","goo/renderer/MeshData","goo/renderer/shaders/ShaderFragments"],function(e,d,b,a){function c(a){this.name=a;this.shader=null;this.textures=[];this.materialState=void 0;this.cullState={enabled:!0,cullFace:"Back",frontFace:"CCW"};this.blendState={blending:"NoBlending"};this.depthState={enabled:!0,write:!0};this.offsetState={enabled:!1,factor:1,units:1};this.wireframe=!1;this.renderQueue=null}c.prototype.getRenderQueue=
function(){return this.renderQueue!==null?this.renderQueue:this.shader.renderQueue};c.prototype.setRenderQueue=function(a){this.renderQueue=a};c.shaders={copy:{includes:[a.features.fog],attributes:{vertexPosition:b.POSITION,vertexUV0:b.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,opacity:1,diffuseMap:e.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform float opacity;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tgl_FragColor = vec4(texture2D(diffuseMap, texCoord0).rgb, opacity);\n}"},copyPure:{includes:[a.features.fog],attributes:{vertexPosition:b.POSITION,vertexUV0:b.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,opacity:1,diffuseMap:e.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\n\ttexCoord0 = vertexUV0;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform float opacity;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec4 col = texture2D(diffuseMap, texCoord0);\n\tgl_FragColor = vec4(col.rgb, col.a * opacity);\n}"},simple:{attributes:{vertexPosition:b.POSITION},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nvoid main(void)\n{\n\tgl_FragColor = vec4(1.0);\n}"},simpleColored:{attributes:{vertexPosition:b.POSITION},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,color:[1,1,1]},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",fshader:"precision mediump float;\nuniform vec3 color;\nvoid main(void)\n{\n\tgl_FragColor = vec4(color, 1.0);\n}"},
simpleLit:{attributes:{vertexPosition:b.POSITION,vertexNormal:b.NORMAL},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraPosition:e.CAMERA,lightPosition:e.LIGHT0,materialAmbient:e.AMBIENT,materialDiffuse:e.DIFFUSE,materialSpecular:e.SPECULAR,materialSpecularPower:e.SPECULAR_POWER},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 normal;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * viewMatrix * worldPos;\n\tnormal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\tlightDir = lightPosition - worldPos.xyz;\n\teyeVec = cameraPosition - worldPos.xyz;\n}",
fshader:"precision mediump float;\nuniform vec4 materialAmbient;\nuniform vec4 materialDiffuse;\nuniform vec4 materialSpecular;\nuniform float materialSpecularPower;\nvarying vec3 normal;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvoid main(void)\n{\n\tvec4 final_color = materialAmbient;\n\tvec3 N = normalize(normal);\n\tvec3 L = normalize(lightDir);\n\tfloat lambertTerm = dot(N,L)*0.75+0.25;\n\tif(lambertTerm > 0.0)\n\t{\n\t\tfinal_color += materialDiffuse * // gl_LightSource[0].diffuse * \n\t\t\tlambertTerm;\n\t\tvec3 E = normalize(eyeVec);\n\t\tvec3 R = reflect(-L, N);\n\t\tfloat specular = pow( max(dot(R, E), 0.0), materialSpecularPower);\n\t\tfinal_color += materialSpecular * // gl_LightSource[0].specular * \n\t\t\tspecular;\n\t\tfinal_color = clamp(final_color, vec4(0.0), vec4(1.0));\n\t}\n\tgl_FragColor = vec4(final_color.rgb, 1.0);\n}"},
textured:{attributes:{vertexPosition:b.POSITION,vertexUV0:b.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,diffuseMap:e.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvoid main(void) {\ntexCoord0 = vertexUV0;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec4 texCol = texture2D(diffuseMap, texCoord0);\n\tgl_FragColor = texCol;\n}"},texturedLit:{attributes:{vertexPosition:b.POSITION,vertexNormal:b.NORMAL,vertexUV0:b.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraPosition:e.CAMERA,lightPosition:e.LIGHT0,diffuseMap:e.TEXTURE0,materialAmbient:e.AMBIENT,materialDiffuse:e.DIFFUSE,
materialSpecular:e.SPECULAR,materialSpecularPower:e.SPECULAR_POWER},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 normal;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * viewMatrix * worldPos;\n\tnormal = (worldMatrix * vec4(vertexNormal, 0.0)).xyz;\n\ttexCoord0 = vertexUV0;\n\tlightDir = lightPosition - worldPos.xyz;\n\teyeVec = cameraPosition - worldPos.xyz;\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform vec4 materialAmbient;\nuniform vec4 materialDiffuse;\nuniform vec4 materialSpecular;\nuniform float materialSpecularPower;\nvarying vec3 normal;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvoid main(void)\n{\n\tvec4 texCol = texture2D(diffuseMap, texCoord0);\n\tvec4 final_color = materialAmbient;\n\tvec3 N = normalize(normal);\n\tvec3 L = normalize(lightDir);\n\tfloat lambertTerm = dot(N,L)*0.75+0.25;\n\tif(lambertTerm > 0.0)\n\t{\n\t\tfinal_color += materialDiffuse * // gl_LightSource[0].diffuse * \n\t\t\tlambertTerm;\n\t\tvec3 E = normalize(eyeVec);\n\t\tvec3 R = reflect(-L, N);\n\t\tfloat specular = pow( max(dot(R, E), 0.0), materialSpecularPower);\n\t\tfinal_color += materialSpecular * // gl_LightSource[0].specular * \n\t\t\tspecular;\n\t\tfinal_color = clamp(final_color, vec4(0.0), vec4(1.0));\n\t}\n\tgl_FragColor = vec4(texCol.rgb * final_color.rgb, texCol.a);\n}"},
texturedNormalAOLit:{attributes:{vertexPosition:b.POSITION,vertexNormal:b.NORMAL,vertexTangent:b.TANGENT,vertexUV0:b.TEXCOORD0,vertexUV1:b.TEXCOORD1,vertexUV2:b.TEXCOORD2},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,cameraPosition:e.CAMERA,lightPosition:e.LIGHT0,diffuseMap:e.TEXTURE0,normalMap:e.TEXTURE1,aoMap:e.TEXTURE2,materialAmbient:e.AMBIENT,materialDiffuse:e.DIFFUSE,materialSpecular:e.SPECULAR,materialSpecularPower:e.SPECULAR_POWER},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nattribute vec4 vertexTangent;\nattribute vec2 vertexUV0;\nattribute vec2 vertexUV1;\nattribute vec2 vertexUV2;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nvarying vec3 normal;\nvarying vec3 binormal;\nvarying vec3 tangent;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec2 texCoord2;\nvoid main(void) {\n\tvec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);\n\tgl_Position = projectionMatrix * viewMatrix * worldPos;\n\tnormal = normalize((worldMatrix * vec4(vertexNormal, 0.0)).xyz);\n\ttangent = normalize((worldMatrix * vec4(vertexTangent.xyz, 0.0)).xyz);\n\tbinormal = cross(normal, tangent)*vec3(vertexTangent.w);\n\ttexCoord0 = vertexUV0;\n\ttexCoord1 = vertexUV1;\n\ttexCoord2 = vertexUV2;\n\tlightDir = lightPosition - worldPos.xyz;\n\teyeVec = cameraPosition - worldPos.xyz;\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nuniform sampler2D normalMap;\nuniform sampler2D aoMap;\nuniform vec4 materialAmbient;\nuniform vec4 materialDiffuse;\nuniform vec4 materialSpecular;\nuniform float materialSpecularPower;\nvarying vec3 normal;\nvarying vec3 binormal;\nvarying vec3 tangent;\nvarying vec3 lightDir;\nvarying vec3 eyeVec;\nvarying vec2 texCoord0;\nvarying vec2 texCoord1;\nvarying vec2 texCoord2;\nvoid main(void)\n{\n\tmat3 tangentToWorld = mat3(tangent,\n\t\t\t\t\t\t\t\tbinormal,\n\t\t\t\t\t\t\t\tnormal);\n\tvec4 texCol = texture2D(diffuseMap, texCoord1);\n\tvec4 final_color = materialAmbient;\n\tvec3 tangentNormal = texture2D(normalMap, texCoord0).xyz - vec3(0.5, 0.5, 0.5);\n\tvec3 worldNormal = (tangentToWorld * tangentNormal);\n\tvec3 N = normalize(worldNormal);\n\tvec4 aoCol = texture2D(aoMap, texCoord2);\n\tvec3 L = normalize(lightDir);\n\tfloat lambertTerm = dot(N,L)*0.75+0.25;\n\tif(lambertTerm > 0.0)\n\t{\n\t\tfinal_color += materialDiffuse * // gl_LightSource[0].diffuse * \n\t\t\tlambertTerm;\n\t\tvec3 E = normalize(eyeVec);\n\t\tvec3 R = reflect(-L, N);\n\t\tfloat specular = pow( max(dot(R, E), 0.0),\n\t\t\t\t\t\tmaterialSpecularPower);\n\t\tfinal_color += materialSpecular * // gl_LightSource[0].specular * \n\t\t\tspecular;\n\t}\n gl_FragColor = vec4(texCol.rgb * aoCol.rgb * final_color.rgb, texCol.a);\n}"},
convolution:{defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},attributes:{position:b.POSITION,uv:b.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tDiffuse:0,uImageIncrement:[0.001953125,0],cKernel:[]},vshader:"attribute vec3 position;\nattribute vec2 uv;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );\n}",
fshader:"precision mediump float;\nuniform float cKernel[ KERNEL_SIZE_INT ];\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nvarying vec2 vUv;\nvoid main() {\n\tvec2 imageCoord = vUv;\n\tvec4 sum = vec4( 0.0 );\n\tfor( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {\n\t\tsum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];\n\t\timageCoord += uImageIncrement;\n\t}\n\tgl_FragColor = sum;\n}",buildKernel:function(a){var b,c,d,e,m=2*Math.ceil(a*3)+1;m>25&&(m=25);e=(m-1)*0.5;c=Array(m);for(b=
d=0;b<m;++b)c[b]=Math.exp(-((b-e)*(b-e))/(2*a*a)),d+=c[b];for(b=0;b<m;++b)c[b]/=d;return c}},showDepth:{attributes:{vertexPosition:b.POSITION},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,near:e.NEAR_PLANE,far:e.FAR_PLANE},vshader:"attribute vec3 vertexPosition;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvoid main(void) {\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform float near;\nuniform float far;\nvoid main(void)\n{\n\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\tfloat d = 1.0 - smoothstep( near, far, depth );\n\tgl_FragColor = vec4(d);\n}"},showNormals:{attributes:{vertexPosition:b.POSITION,vertexNormal:b.NORMAL},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,opacity:1},vshader:"attribute vec3 vertexPosition;\nattribute vec3 vertexNormal;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );\nvNormal = vec3(viewMatrix * worldMatrix * vec4(vertexNormal, 0.0)); //normalMatrix * vertexNormal;\ngl_Position = projectionMatrix * mvPosition;\n}",
fshader:"precision mediump float;\nuniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},bokehShader:{attributes:{position:b.POSITION,uv:b.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,tColor:0,tDepth:1,focus:1,aspect:1,aperture:0.025,maxblur:1},vshader:"attribute vec3 position;\nattribute vec2 uv;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4( position, 1.0 );\n}",
fshader:"precision mediump float;\nvarying vec2 vUv;\nuniform sampler2D tColor;\nuniform sampler2D tDepth;\nuniform float maxblur;\nuniform float aperture;\nuniform float focus;\nuniform float aspect;\nvoid main() {\nvec2 aspectcorrect = vec2( 1.0, aspect );\nvec4 depth1 = texture2D( tDepth, vUv );\nfloat factor = depth1.x - focus;\nvec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );\nvec2 dofblur9 = dofblur * 0.9;\nvec2 dofblur7 = dofblur * 0.7;\nvec2 dofblur4 = dofblur * 0.4;\nvec4 col = vec4( 0.0 );\ncol += texture2D( tColor, vUv.xy );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\ncol += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\ngl_FragColor = col / 41.0;\ngl_FragColor.a = 1.0;\n}"},
particles:{attributes:{vertexPosition:b.POSITION,vertexColor:b.COLOR,vertexUV0:b.TEXCOORD0},uniforms:{viewMatrix:e.VIEW_MATRIX,projectionMatrix:e.PROJECTION_MATRIX,worldMatrix:e.WORLD_MATRIX,diffuseMap:e.TEXTURE0},vshader:"attribute vec3 vertexPosition;\nattribute vec4 vertexColor;\nattribute vec2 vertexUV0;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 worldMatrix;\nvarying vec2 texCoord0;\nvarying vec4 color;\nvoid main(void) {\n    texCoord0 = vertexUV0;\n    color = vertexColor;\n\t gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(vertexPosition, 1.0);\n}",
fshader:"precision mediump float;\nuniform sampler2D diffuseMap;\nvarying vec2 texCoord0;\nvarying vec4 color;\nvoid main(void)\n{\n\tvec4 texCol = texture2D(diffuseMap, texCoord0);\n   if (color.a == 0.0 || texCol.a == 0.0) discard;\n\telse gl_FragColor = texCol * color;\n}"}};c.store=[];c.hash=[];c.createShader=function(a,b){var d=c.store.indexOf(a);if(d!==-1)return c.hash[d];d=new e(b||"DefaultShader",a);c.store.push(a);c.hash.push(d);return d};c.clearShaderCache=function(){c.store.length=0;c.hash.length=
0};c.createMaterial=function(a,b){var d=new c(b||"DefaultMaterial");d.shader=c.createShader(a);return d};return c});n("goo/renderer/Renderer","goo/renderer/RendererRecord,goo/renderer/Camera,goo/renderer/Util,goo/renderer/TextureCreator,goo/renderer/pass/RenderTarget,goo/math/Vector4,goo/entities/Entity,goo/renderer/Texture,goo/loaders/dds/DdsLoader,goo/loaders/dds/DdsUtils,goo/renderer/MeshData,goo/renderer/Material,goo/math/Transform,goo/renderer/RenderQueue".split(","),function(e,d,b,a,c,f,g,j,
i,l,m,k,p,n){function o(a){var a=a||{},b=a.canvas;if(b===void 0)b=document.createElement("canvas"),b.width=500,b.height=500;this.domElement=b;this.rendererRecord=new e;this._alpha=a.alpha!==void 0?a.alpha:!1;this._premultipliedAlpha=a.premultipliedAlpha!==void 0?a.premultipliedAlpha:!0;this._antialias=a.antialias!==void 0?a.antialias:!1;this._stencil=a.stencil!==void 0?a.stencil:!1;this._preserveDrawingBuffer=a.preserveDrawingBuffer!==void 0?a.preserveDrawingBuffer:!1;try{if(!(this.context=b.getContext("experimental-webgl",
{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,stencil:this._stencil,preserveDrawingBuffer:this._preserveDrawingBuffer})))throw console.error("Error creating WebGL context."),"Error creating WebGL context.";this.glExtensionCompressedTextureS3TC=i.SUPPORTS_DDS=l.isSupported(this.context);this.glExtensionTextureFloat=this.context.getExtension("OES_texture_float");this.glExtensionStandardDerivatives=this.context.getExtension("OES_standard_derivatives");this.glExtensionTextureFilterAnisotropic=
this.context.getExtension("EXT_texture_filter_anisotropic")||this.context.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.context.getExtension("WEBKIT_EXT_texture_filter_anisotropic");this.glExtensionDepthTexture=this.context.getExtension("WEBKIT_WEBGL_depth_texture")||this.context.getExtension("MOZ_WEBGL_depth_texture");this.glExtensionTextureFloat||console.log("Float textures not supported.");this.glExtensionStandardDerivatives||console.log("Standard derivatives not supported.");this.glExtensionTextureFilterAnisotropic||
console.log("Anisotropic texture filtering not supported.");this.glExtensionCompressedTextureS3TC||console.log("S3TC compressed textures not supported.");this.glExtensionDepthTexture||console.log("Depth textures not supported.")}catch(c){console.error(c)}this.clearColor=new f;this.setClearColor(0.3,0.3,0.3,1);this.context.clearDepth(1);this.context.clearStencil(0);this.context.stencilMask(0);this.context.enable(h.DEPTH_TEST);this.context.depthFunc(h.LEQUAL);this.currentHeight=this.currentWidth=this.viewportHeight=
this.viewportWidth=this.viewportY=this.viewportX=0;this.overrideMaterial=null;this.renderQueue=new n;this.info={calls:0,vertices:0,indices:0,reset:function(){this.indices=this.vertices=this.calls=0},toString:function(){return"Calls: "+this.calls+" Vertices: "+this.vertices+" Indices: "+this.indices}}}var h=window.WebGLRenderingContext;o.prototype.checkResize=function(a){(this.domElement.offsetWidth!==this.domElement.width||this.domElement.offsetHeight!==this.domElement.height)&&this.setSize(this.domElement.offsetWidth,
this.domElement.offsetHeight);var b=this.domElement.width/this.domElement.height;if(a&&a.aspect!==b)a.aspect=b,a.setFrustumPerspective()};o.prototype.setSize=function(a,b){this.domElement.width=a;this.domElement.height=b;this.setViewport(0,0,a,b)};o.prototype.setViewport=function(a,b,c,d){this.viewportX=a!==void 0?a:0;this.viewportY=b!==void 0?b:0;this.viewportWidth=c!==void 0?c:this.domElement.width;this.viewportHeight=d!==void 0?d:this.domElement.height;this.context.viewport(this.viewportX,this.viewportY,
this.viewportWidth,this.viewportHeight)};o.prototype.setClearColor=function(a,b,c,d){this.clearColor.set(a,b,c,d);this.context.clearColor(a,b,c,d)};o.prototype.bindData=function(a){var b=null;if(a!==null)if(b=a.glBuffer,b!==null){if(a._dataNeedsRefresh)this.setBoundBuffer(a.glBuffer,a.target),this.context.bufferSubData(this.getGLBufferTarget(a.target),0,a.data),a._dataNeedsRefresh=!1}else b=this.context.createBuffer(),a.glBuffer=b,this.rendererRecord.invalidateBuffer(a.target),this.setBoundBuffer(b,
a.target),this.context.bufferData(this.getGLBufferTarget(a.target),a.data,this.getGLBufferUsage(a._dataUsage));b!==null?this.setBoundBuffer(b,a.target):this.setBoundBuffer(null,a.target)};o.prototype.render=function(a,b,c,d,f){if(b)if(this.setRenderTarget(d),f===void 0||f===null||f===!0?this.clear():typeof f==="object"&&this.clear(f.color,f.depth,f.stencil),c={camera:b,lights:c},Array.isArray(a)){this.renderQueue.sort(a,b);for(b=0;b<a.length;b++)this.fillRenderInfo(a[b],c),this.renderMesh(c)}else this.fillRenderInfo(a,
c),this.renderMesh(c)};o.prototype.fillRenderInfo=function(a,b){a instanceof g?(b.meshData=a.meshDataComponent.meshData,b.materials=a.meshRendererComponent.materials,b.transform=a.particleComponent?p.IDENTITY:a.transformComponent.worldTransform):(b.meshData=a.meshData,b.materials=a.materials,b.transform=a.transform)};o.prototype.renderMesh=function(a){var b=a.meshData;if(!(b.vertexData!==null&&b.vertexData.data.byteLength===0||b.indexData!==null&&b.indexData.data.byteLength===0)){this.bindData(b.vertexData);
var c=a.materials;this.overrideMaterial!==null&&(c=[this.overrideMaterial]);for(var d=!1,f=b,e=0;e<c.length;e++){var g=c[e];if(g.shader){if(g.wireframe&&!d){if(!b.wireframeData)b.wireframeData=this.buildWireframeData(b);b=b.wireframeData;this.bindData(b.vertexData);if(!g.wireframeMaterial)g.wireframeMaterial=this.buildWireframeMaterial(g);g=g.wireframeMaterial;d=!0}else!g.wireframe&&d&&(b=f,this.bindData(b.vertexData),iswireframe=!1);a.material=g;g.shader.apply(a,this);this.updateDepthTest(g);this.updateCulling(g);
this.updateBlending(g);this.updateOffset(g);this.updateTextures(g);b.getIndexBuffer()!==null?(this.bindData(b.getIndexData()),b.getIndexLengths()!==null?this.drawElementsVBO(b.getIndexBuffer(),b.getIndexModes(),b.getIndexLengths()):this.drawElementsVBO(b.getIndexBuffer(),b.getIndexModes(),[b.getIndexBuffer().length])):b.getIndexLengths()!==null?this.drawArraysVBO(b.getIndexModes(),b.getIndexLengths()):this.drawArraysVBO(b.getIndexModes(),[b.vertexCount]);this.info.calls++;this.info.vertices+=b.vertexCount;
this.info.indices+=b.indexCount}}}};o.prototype.readPixels=function(a,b,c,d,f){this.context.readPixels(a,b,c,d,h.RGBA,h.UNSIGNED_BYTE,f)};o.prototype.drawElementsVBO=function(a,b,c){for(var d=0,f=0,e=0;e<c.length;e++){var g=c[e],h=this.getGLIndexMode(b[f]),i=this.getGLArrayType(a),j=this.getGLByteSize(a);this.context.drawElements(h,g,i,d*j);d+=g;f<b.length-1&&f++}};o.prototype.drawArraysVBO=function(a,b){for(var c=0,d=0,f=0;f<b.length;f++){var e=b[f];this.context.drawArrays(this.getGLIndexMode(a[d]),
c,e);c+=e;d<a.length-1&&d++}};o.prototype.buildWireframeData=function(a){var c=b.clone(a.attributeMap),d=new m(c,a.vertexCount,a.indexCount*2),f;for(f in c)d.getAttributeBuffer(f).set(a.getAttributeBuffer(f));c=a.getIndexBuffer();f=d.getIndexBuffer();for(var e=0;e<a.indexCount;e++){var g=c[e*3+0],h=c[e*3+1],i=c[e*3+2];f[e*6+0]=g;f[e*6+1]=h;f[e*6+2]=h;f[e*6+3]=i;f[e*6+4]=i;f[e*6+5]=g}d.indexModes[0]="Lines";return d};o.prototype.buildWireframeMaterial=function(a){var c={};c.defines=a.shader.defines;
c.attributes=a.shader.attributes;c.uniforms=a.shader.uniforms;c.uniforms.color=a.wireframeColor||[1,1,1];c.vshader=a.shader.vertexSource;c.fshader=b.clone(k.shaders.simpleColored.fshader);c=k.createMaterial(c,"Wireframe");c.textures=a.textures;return c};o.prototype.updateDepthTest=function(a){var b=this.rendererRecord.depthRecord,a=a.depthState;if(b.enabled!==a.enabled)a.enabled?this.context.enable(h.DEPTH_TEST):this.context.disable(h.DEPTH_TEST),b.enabled=a.enabled;if(b.write!==a.write)a.write?this.context.depthMask(!0):
this.context.depthMask(!1),b.write=a.write};o.prototype.updateCulling=function(a){var b=this.rendererRecord.cullRecord,c=a.cullState.cullFace,d=a.cullState.frontFace,a=a.cullState.enabled;if(b.enabled!==a)a?this.context.enable(h.CULL_FACE):this.context.disable(h.CULL_FACE),b.enabled=a;if(b.cullFace!==c)this.context.cullFace(c==="Front"?h.FRONT:c==="Back"?h.BACK:h.FRONT_AND_BACK),b.cullFace=c;if(b.frontFace!==d){switch(d){case "CCW":this.context.frontFace(h.CCW);break;case "CW":this.context.frontFace(h.CW)}b.frontFace=
d}};o.prototype.updateTextures=function(d){for(var f=this.context,e=0;e<d.shader.textureSlots.length;e++){var g=d.textures[e];if(g===void 0||!g instanceof c&&g.image===void 0||g.image&&g.image.dataReady===void 0)if(d.shader.textureSlots[e].format==="sampler2D")g=a.DEFAULT_TEXTURE_2D;else if(d.shader.textureSlots[e].format==="samplerCube")g=a.DEFAULT_TEXTURE_CUBE;var h=this.rendererRecord.textureRecord[e];h===void 0&&(h=this.rendererRecord.textureRecord[e]={});g.glTexture===null?(g.glTexture=f.createTexture(),
this.updateTexture(f,g,e,h)):g.needsUpdate?(this.updateTexture(f,g,e,h),g.needsUpdate=!1):this.bindTexture(f,g,e,h);h=g.image!==void 0?g.image:g;h=b.isPowerOfTwo(h.width)&&b.isPowerOfTwo(h.height);this.updateTextureParameters(g,h)}};o.prototype.updateTextureParameters=function(a,b){var c=this.context,d=a.textureRecord;if(d===void 0)d={},a.textureRecord=d;var f=this.getGLType(a.variant);if(d.magFilter!==a.magFilter)c.texParameteri(f,h.TEXTURE_MAG_FILTER,this.getGLMagFilter(a.magFilter)),d.magFilter=
a.magFilter;var e=b?a.minFilter:this.getFilterFallback(a.minFilter);if(d.minFilter!==e)c.texParameteri(f,h.TEXTURE_MIN_FILTER,this.getGLMinFilter(e)),d.minFilter=e;e=b?a.wrapS:"EdgeClamp";if(d.wrapS!==e){var g=this.getGLWrap(e,c);c.texParameteri(f,h.TEXTURE_WRAP_S,g);d.wrapS=e}e=b?a.wrapT:"EdgeClamp";if(d.wrapT!==e)g=this.getGLWrap(e,c),c.texParameteri(f,h.TEXTURE_WRAP_T,g),d.wrapT=e};o.prototype.bindTexture=function(a,b,c,d){a.activeTexture(h.TEXTURE0+c);if(d.boundTexture===void 0||b.glTexture!==
void 0&&d.boundTexture!==b.glTexture)a.bindTexture(this.getGLType(b.variant),b.glTexture),d.boundTexture=b.glTexture};o.prototype.getGLType=function(a){switch(a){case "2D":return h.TEXTURE_2D;case "CUBE":return h.TEXTURE_CUBE_MAP}throw"invalid texture type: "+a;};o.prototype.loadCompressedTexture=function(a,b,c,d){var f=c.image.mipmapSizes,e=0,g=0,h=c.image.width,i=c.image.height,j=l.getDdsExtension(a),k=j.COMPRESSED_RGBA_S3TC_DXT5_EXT;if(c.format==="PrecompressedDXT1")k=j.COMPRESSED_RGB_S3TC_DXT1_EXT;
else if(c.format==="PrecompressedDXT1A")k=j.COMPRESSED_RGBA_S3TC_DXT1_EXT;else if(c.format==="PrecompressedDXT3")k=j.COMPRESSED_RGBA_S3TC_DXT3_EXT;else if(c.format==="PrecompressedDXT5")k=j.COMPRESSED_RGBA_S3TC_DXT5_EXT;else throw Error("Unhandled compression format: "+img.getDataFormat().name());if(f==null)d instanceof Uint8Array?a.compressedTexImage2D(b,0,k,h,i,0,d):a.compressedTexImage2D(b,0,k,h,i,0,new Uint8Array(d.buffer,d.byteOffset,d.byteLength));else{c.generateMipmaps=!1;for(j=0;j<f.length;j++)g=
f[j],a.compressedTexImage2D(b,j,k,h,i,0,new Uint8Array(d.buffer,d.byteOffset+e,g)),h=~~(h/2)>1?~~(h/2):1,i=~~(i/2)>1?~~(i/2):1,e+=g;d=1+Math.ceil(Math.log(Math.max(c.image.height,c.image.width))/Math.log(2));e=f[f.length-1];if(f.length<d)for(j=f.length;j<d;j++)e=~~((h+3)/4)*~~((i+3)/4)*c.image.bpp*2,a.compressedTexImage2D(b,j,k,h,i,0,new Uint8Array(e)),h=~~(h/2)>1?~~(h/2):1,i=~~(i/2)>1?~~(i/2):1}};o.prototype.updateTexture=function(a,b,c,d){this.bindTexture(a,b,c,d);a.pixelStorei(h.UNPACK_ALIGNMENT,
1);a.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,b.flipY);if(b.generateMipmaps)if(c=b.image,b.variant==="2D")this.checkRescale(b,c,c.width,c.height);else if(b.variant==="CUBE")for(d=0;d<6;d++)this.checkRescale(b,c.data[d],c.width,c.height);if(b.variant==="2D")b.image?b.image.isData===!0?b.image.isCompressed?this.loadCompressedTexture(a,h.TEXTURE_2D,b,b.image.data):a.texImage2D(h.TEXTURE_2D,0,this.getGLInternalFormat(b.format),b.image.width,b.image.height,b.hasBorder?1:0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),
b.image.data):a.texImage2D(h.TEXTURE_2D,0,this.getGLInternalFormat(b.format),this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),b.image):a.texImage2D(h.TEXTURE_2D,0,this.getGLInternalFormat(b.format),b.width,b.height,0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),null),b.generateMipmaps&&b.image&&!b.image.isCompressed&&a.generateMipmap(h.TEXTURE_2D);else if(b.variant==="CUBE"){for(c=0;c<j.CUBE_FACES.length;c++)d=j.CUBE_FACES[c],b.image?b.image.isData===!0?b.image.isCompressed?
this.loadCompressedTexture(a,this.getGLCubeMapFace(d),b,b.image.data[c]):a.texImage2D(this.getGLCubeMapFace(d),0,this.getGLInternalFormat(b.format),b.image.width,b.image.height,b.hasBorder?1:0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),b.image.data[c]):a.texImage2D(this.getGLCubeMapFace(d),0,this.getGLInternalFormat(b.format),this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),b.image.data[c]):a.texImage2D(this.getGLCubeMapFace(d),0,this.getGLInternalFormat(b.format),
b.width,b.height,0,this.getGLInternalFormat(b.format),this.getGLPixelDataType(b.type),null);b.generateMipmaps&&b.image&&!b.image.isCompressed&&a.generateMipmap(h.TEXTURE_CUBE_MAP)}};o.prototype.checkRescale=function(a,c,d,f){var e=b.nearestPowerOfTwo(d),g=b.nearestPowerOfTwo(f);if(d!==e||f!==g){var h=document.createElement("canvas");h.width=e;h.height=g;h.getContext("2d").drawImage(c,0,0,d,f,0,0,e,g);document.body.appendChild(h);h.dataReady=!0;a.image=h;h.parentNode.removeChild(h)}};o.prototype.getGLWrap=
function(a){switch(a){case "Repeat":return h.REPEAT;case "MirroredRepeat":return h.MIRRORED_REPEAT;case "EdgeClamp":return h.CLAMP_TO_EDGE}throw"invalid WrapMode type: "+a;};o.prototype.getGLInternalFormat=function(a){switch(a){case "RGBA":return h.RGBA;case "RGB":return h.RGB;case "Alpha":return h.ALPHA;case "Luminance":return h.LUMINANCE;case "LuminanceAlpha":return h.LUMINANCE_ALPHA;default:throw"Unsupported format: "+a;}};o.prototype.getGLPixelDataType=function(a){switch(a){case "UnsignedByte":return h.UNSIGNED_BYTE;
case "UnsignedShort565":return h.UNSIGNED_SHORT_5_6_5;case "UnsignedShort4444":return h.UNSIGNED_SHORT_4_4_4_4;case "UnsignedShort5551":return h.UNSIGNED_SHORT_5_5_5_1;case "Float":return h.FLOAT;default:throw"Unsupported type: "+a;}};o.prototype.getFilterFallback=function(a){switch(a){case "NearestNeighborNoMipMaps":case "NearestNeighborNearestMipMap":case "NearestNeighborLinearMipMap":return"NearestNeighborNoMipMaps";case "BilinearNoMipMaps":case "Trilinear":case "BilinearNearestMipMap":return"BilinearNoMipMaps";
default:return"NearestNeighborNoMipMaps"}};o.prototype.getGLMagFilter=function(a){switch(a){case "Bilinear":return h.LINEAR;case "NearestNeighbor":return h.NEAREST;default:return h.NEAREST}};o.prototype.getGLMinFilter=function(a){switch(a){case "BilinearNoMipMaps":return h.LINEAR;case "Trilinear":return h.LINEAR_MIPMAP_LINEAR;case "BilinearNearestMipMap":return h.LINEAR_MIPMAP_NEAREST;case "NearestNeighborNoMipMaps":return h.NEAREST;case "NearestNeighborNearestMipMap":return h.NEAREST_MIPMAP_NEAREST;
case "NearestNeighborLinearMipMap":return h.NEAREST_MIPMAP_LINEAR}throw"invalid MinificationFilter type: "+a;};o.prototype.getGLBufferTarget=function(a){return a==="ElementArrayBuffer"?h.ELEMENT_ARRAY_BUFFER:h.ARRAY_BUFFER};o.prototype.getGLArrayType=function(a){if(a instanceof Uint8Array)return h.UNSIGNED_BYTE;else if(a instanceof Uint16Array)return h.UNSIGNED_SHORT;else if(a instanceof Uint32Array)return h.UNSIGNED_INT;else if(a instanceof Int8Array)return h.UNSIGNED_BYTE;else if(a instanceof Int16Array)return h.UNSIGNED_SHORT;
else if(a instanceof Int32Array)return h.UNSIGNED_INT;return null};o.prototype.getGLByteSize=function(a){if(!(a instanceof Uint8Array))if(a instanceof Uint16Array)return 2;else if(a instanceof Uint32Array)return 4;else if(!(a instanceof Int8Array))if(a instanceof Int16Array)return 2;else if(a instanceof Int32Array)return 4;return 1};o.prototype.getGLCubeMapFace=function(a){switch(a){case "PositiveX":return h.TEXTURE_CUBE_MAP_POSITIVE_X;case "NegativeX":return h.TEXTURE_CUBE_MAP_NEGATIVE_X;case "PositiveY":return h.TEXTURE_CUBE_MAP_POSITIVE_Y;
case "NegativeY":return h.TEXTURE_CUBE_MAP_NEGATIVE_Y;case "PositiveZ":return h.TEXTURE_CUBE_MAP_POSITIVE_Z;case "NegativeZ":return h.TEXTURE_CUBE_MAP_NEGATIVE_Z}throw"Invalid cubemap face: "+a;};o.prototype.getGLBufferUsage=function(a){var b=h.STATIC_DRAW;switch(a){case "StaticDraw":b=h.STATIC_DRAW;break;case "DynamicDraw":b=h.DYNAMIC_DRAW;break;case "StreamDraw":b=h.STREAM_DRAW}return b};o.prototype.getGLIndexMode=function(a){var b=h.TRIANGLES;switch(a){case "Triangles":b=h.TRIANGLES;break;case "TriangleStrip":b=
h.TRIANGLE_STRIP;break;case "TriangleFan":b=h.TRIANGLE_FAN;break;case "Lines":b=h.LINES;break;case "LineStrip":b=h.LINE_STRIP;break;case "LineLoop":b=h.LINE_LOOP;break;case "Points":b=h.POINTS}return b};o.prototype.updateBlending=function(a){var b=this.rendererRecord.blendRecord,c=this.context,d=a.blendState.blending;if(d!==b.blending)d==="NoBlending"?c.disable(h.BLEND):d==="AdditiveBlending"?(c.enable(h.BLEND),c.blendEquation(h.FUNC_ADD),c.blendFunc(h.SRC_ALPHA,h.ONE)):d==="SubtractiveBlending"?
(c.enable(h.BLEND),c.blendEquation(h.FUNC_ADD),c.blendFunc(h.ZERO,h.ONE_MINUS_SRC_COLOR)):d==="MultiplyBlending"?(c.enable(h.BLEND),c.blendEquation(h.FUNC_ADD),c.blendFunc(h.DST_COLOR,h.ONE_MINUS_SRC_ALPHA)):d==="AlphaBlending"?(c.enable(h.BLEND),c.blendEquation(h.FUNC_ADD),c.blendFunc(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA)):d==="CustomBlending"?c.enable(h.BLEND):(c.enable(h.BLEND),c.blendEquationSeparate(h.FUNC_ADD,h.FUNC_ADD),c.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA)),
b.blending=d;if(d==="CustomBlending"){var d=a.blendState.blendEquation,f=a.blendState.blendSrc,a=a.blendState.blendDst;if(d!==b.blendEquation)c.blendEquation(this.getGLBlendParam(d)),b.blendEquation=d;if(f!==b.blendSrc||a!==b.blendDst)c.blendFunc(this.getGLBlendParam(f),this.getGLBlendParam(a)),b.blendSrc=f,b.blendDst=a}else b.blendEquation=null,b.blendSrc=null,b.blendDst=null};o.prototype.updateOffset=function(a){var b=this.rendererRecord.offsetRecord,c=this.context,d=a.offsetState.enabled,f=a.offsetState.factor,
a=a.offsetState.units;if(b.enabled!==d)d?c.enable(h.POLYGON_OFFSET_FILL):c.disable(h.POLYGON_OFFSET_FILL),b.enabled=d;if(d&&(b.factor!==f||b.units!==a))c.polygonOffset(f,a),b.factor=f,b.units=a};o.prototype.setBoundBuffer=function(a,b){if(!this.rendererRecord.currentBuffer[b].valid||this.rendererRecord.currentBuffer[b].buffer!==a)this.context.bindBuffer(this.getGLBufferTarget(b),a),this.rendererRecord.currentBuffer[b]={buffer:a,valid:!0}};o.prototype.bindVertexAttribute=function(a,b,c,d,f,e,g){this.context.vertexAttribPointer(a,
b,this.getGLDataType(c),d,f,e);g.boundAttributes.indexOf(a)===-1&&(this.context.enableVertexAttribArray(a),g.boundAttributes.push(a))};o.prototype.getGLDataType=function(a){switch(a){case "Float":case "HalfFloat":case "Double":return h.FLOAT;case "Byte":return h.BYTE;case "UnsignedByte":return h.UNSIGNED_BYTE;case "Short":return h.SHORT;case "UnsignedShort":return h.UNSIGNED_SHORT;case "Int":return h.INT;case "UnsignedInt":return h.UNSIGNED_INT}};o.prototype.getGLBlendParam=function(a){switch(a){case "AddEquation":return h.FUNC_ADD;
case "SubtractEquation":return h.FUNC_SUBTRACT;case "ReverseSubtractEquation":return h.FUNC_REVERSE_SUBTRACT;case "ZeroFactor":return h.ZERO;case "OneFactor":return h.ONE;case "SrcColorFactor":return h.SRC_COLOR;case "OneMinusSrcColorFactor":return h.ONE_MINUS_SRC_COLOR;case "SrcAlphaFactor":return h.SRC_ALPHA;case "OneMinusSrcAlphaFactor":return h.ONE_MINUS_SRC_ALPHA;case "DstAlphaFactor":return h.DST_ALPHA;case "OneMinusDstAlphaFactor":return h.ONE_MINUS_DST_ALPHA;case "DstColorFactor":return h.DST_COLOR;
case "OneMinusDstColorFactor":return h.ONE_MINUS_DST_COLOR;case "SrcAlphaSaturateFactor":return h.SRC_ALPHA_SATURATE;default:throw"Unknown blend param: "+a;}};o.prototype.clear=function(a,b,c){var d=0;if(a===void 0||a)d|=h.COLOR_BUFFER_BIT;if(b===void 0||b)d|=h.DEPTH_BUFFER_BIT;if(c===void 0||c)d|=h.STENCIL_BUFFER_BIT;this.context.clear(d)};o.prototype.flush=function(){this.context.flush()};o.prototype.finish=function(){this.context.finish()};o.prototype.setupFrameBuffer=function(a,b,c){this.context.bindFramebuffer(h.FRAMEBUFFER,
a);this.context.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,c,b.glTexture,0)};o.prototype.setupRenderBuffer=function(a,b){this.context.bindRenderbuffer(h.RENDERBUFFER,a);b.depthBuffer&&!b.stencilBuffer?(this.context.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_COMPONENT16,b.width,b.height),this.context.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(this.context.renderbufferStorage(h.RENDERBUFFER,h.DEPTH_STENCIL,b.width,b.height),
this.context.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,a)):this.context.renderbufferStorage(h.RENDERBUFFER,h.RGBA4,b.width,b.height)};o.prototype.setRenderTarget=function(a){if(a&&!a._glFrameBuffer){if(a.depthBuffer===void 0)a.depthBuffer=!0;if(a.stencilBuffer===void 0)a.stencilBuffer=!0;a.glTexture=this.context.createTexture();var c=b.isPowerOfTwo(a.width)&&b.isPowerOfTwo(a.height),d=this.getGLInternalFormat(a.format),f=this.getGLDataType(a.type);a._glFrameBuffer=
this.context.createFramebuffer();a._glRenderBuffer=this.context.createRenderbuffer();this.context.bindTexture(h.TEXTURE_2D,a.glTexture);this.updateTextureParameters(a,c);this.context.texImage2D(h.TEXTURE_2D,0,d,a.width,a.height,0,d,f,null);this.setupFrameBuffer(a._glFrameBuffer,a,h.TEXTURE_2D);this.setupRenderBuffer(a._glRenderBuffer,a);c&&this.context.generateMipmap(h.TEXTURE_2D);this.context.bindTexture(h.TEXTURE_2D,null);this.context.bindRenderbuffer(h.RENDERBUFFER,null);this.context.bindFramebuffer(h.FRAMEBUFFER,
null)}var e;a?(c=a._glFrameBuffer,d=a.width,a=a.height,e=f=0):(c=null,d=this.viewportWidth,a=this.viewportHeight,f=this.viewportX,e=this.viewportY);if(c!==this.rendererRecord.currentFrameBuffer)this.context.bindFramebuffer(h.FRAMEBUFFER,c),this.context.viewport(f,e,d,a),this.rendererRecord.currentFrameBuffer=c;this.currentWidth=d;this.currentHeight=a};o.prototype.updateRenderTargetMipmap=function(a){this.context.bindTexture(h.TEXTURE_2D,a.glTexture);this.context.generateMipmap(h.TEXTURE_2D);this.context.bindTexture(h.TEXTURE_2D,
null)};return o});n("goo/entities/systems/BoundingUpdateSystem",["goo/entities/systems/System"],function(e){function d(){e.call(this,"BoundingUpdateSystem",["TransformComponent","MeshRendererComponent","MeshDataComponent"])}d.prototype=Object.create(e.prototype);d.prototype.process=function(b){for(var a in b){var c=b[a],d=c.meshDataComponent,e=c.transformComponent,c=c.meshRendererComponent;d.autoCompute&&d.computeBoundFromPoints();e._updated&&c.updateBounds(d.modelBound,e.worldTransform)}};return d});
n("goo/entities/systems/ScriptSystem",["goo/entities/systems/System"],function(e){function d(){e.call(this,"ScriptSystem",["ScriptComponent"])}d.prototype=Object.create(e.prototype);d.prototype.process=function(b){for(var a in b)b[a].scriptComponent.run(b[a])};return d});n("goo/entities/systems/LightingSystem",["goo/entities/systems/System"],function(e){function d(){e.call(this,"LightingSystem",["LightComponent"])}d.prototype=Object.create(e.prototype);d.prototype.process=function(b){for(var a in b){var c=
b[a],d=c.transformComponent,c=c.lightComponent;d._updated&&c.light.translation.copy(d.transform.translation)}};return d});n("goo/renderer/SimplePartitioner",["goo/renderer/Camera"],function(e){function d(){}d.prototype.added=function(){};d.prototype.removed=function(){};d.prototype.process=function(b,a,c){for(var d in a){var g=a[d];if(!g.skip)b.contains(g.meshRendererComponent.worldBound)!==e.Outside?(c.push(g),g.isVisible=!0):g.isVisible=!1}};return d});n("goo/entities/managers/LightManager",["goo/entities/EventHandler"],
function(e){function d(){this.type="LightManager";this.lights=[]}d.prototype.addedComponent=function(b,a){a.type==="LightComponent"&&this.lights.indexOf(a.light)===-1&&(this.lights.push(a.light),e.dispatch("setLights",this.lights))};d.prototype.removedComponent=function(b,a){if(a.type==="LightComponent"){var c=this.lights.indexOf(a.light);c!==-1&&(this.lights.splice(c,1),e.dispatch("setLights",this.lights))}};return d});n("goo/entities/systems/CameraSystem",["goo/entities/systems/System","goo/entities/EventHandler",
"goo/renderer/Renderer"],function(e,d,b){function a(){e.call(this,"CameraSystem",["TransformComponent","CameraComponent"]);this.mainCamera=null}a.prototype=Object.create(e.prototype);a.prototype.findMainCamera=function(){var a=null,f;for(f in this._activeEntities){var e=this._activeEntities[f].cameraComponent;if(!a||e.isMain)a=e.camera}d.dispatch("setCurrentCamera",a);b.mainCamera=a};a.prototype.inserted=function(){this.findMainCamera()};a.prototype.deleted=function(){this.findMainCamera()};a.prototype.process=
function(a){for(var b in a){var d=a[b],e=d.transformComponent,d=d.cameraComponent;e._updated&&d.updateCamera(e.worldTransform)}};return a});n("goo/entities/components/CameraComponent",["goo/entities/components/Component","goo/math/Vector3"],function(e){function d(b){this.type="CameraComponent";this.camera=b}d.prototype=Object.create(e.prototype);d.prototype.updateCamera=function(b){this.camera._left.set(-1,0,0);b.matrix.applyPostVector(this.camera._left);this.camera._up.set(0,1,0);b.matrix.applyPostVector(this.camera._up);
this.camera._direction.set(0,0,-1);b.matrix.applyPostVector(this.camera._direction);b.matrix.getTranslation(this.camera.translation);this.camera.update()};return d});n("goo/util/Stats",[],function(){return function(){var e=Date.now(),d=e,b=e,a=0,c=Infinity,f=0,g=0,j=Infinity,i=0,l=0,m=0,k=document.createElement("div");k.id="stats";k.addEventListener("mousedown",function(a){a.preventDefault();x(++m%2)},!1);k.style.cssText="width:80px;opacity:0.9;cursor:pointer;z-index:1000";var p=document.createElement("div");
p.id="fps";p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002";k.appendChild(p);var n=document.createElement("div");n.id="fpsText";n.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";n.innerHTML="FPS";p.appendChild(n);var o=document.createElement("div");o.id="fpsGraph";o.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(p.appendChild(o);o.children.length<74;){var h=document.createElement("span");
h.style.cssText="width:1px;height:30px;float:left;background-color:#113";o.appendChild(h)}var s=document.createElement("div");s.id="ms";s.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none";k.appendChild(s);var r=document.createElement("div");r.id="msText";r.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";r.innerHTML="MS";s.appendChild(r);var v=document.createElement("div");v.id="msGraph";v.style.cssText=
"position:relative;width:74px;height:30px;background-color:#0f0";for(s.appendChild(v);v.children.length<74;)h=document.createElement("span"),h.style.cssText="width:1px;height:30px;float:left;background-color:#131",v.appendChild(h);h=document.createElement("div");h.id="info";h.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200";k.appendChild(h);var u=document.createElement("div");u.id="infoText";u.style.cssText="color:#f66;font-family:Helvetica,Arial,sans-serif;font-size:8px;font-weight:bold;line-height:13px";
u.innerHTML="INFO";h.appendChild(u);var x=function(a){m=a;switch(m){case 0:p.style.display="block";s.style.display="none";break;case 1:p.style.display="none",s.style.display="block"}};this.domElement=k;this.setMode=x;this.begin=function(){e=Date.now()};this.end=function(h){var w=Date.now();if(w>b+100){a=w-e;c=Math.min(c,a);f=Math.max(f,a);r.textContent=a+" MS ("+c+"-"+f+")";var B=Math.min(30,30-a/200*30);v.appendChild(v.firstChild).style.height=B+"px";b=w}l++;if(w>d+1E3)g=Math.round(l*1E3/(w-d)),
j=Math.min(j,g),i=Math.max(i,g),n.textContent=g+" FPS ("+j+"-"+i+")",B=Math.min(30,30-g/(Math.min(500,i)+10)*30),o.appendChild(o.firstChild).style.height=B+"px",d=w,l=0;if(h)u.innerHTML="Calls: "+h.calls+"<br>Vertices: "+h.vertices+"<br>Indices: "+h.indices;return w};this.update=function(a){e=this.end(a)}}});n("goo/entities/GooRunner","goo/entities/World,goo/entities/systems/TransformSystem,goo/entities/systems/RenderSystem,goo/entities/systems/PartitioningSystem,goo/renderer/Renderer,goo/entities/systems/BoundingUpdateSystem,goo/entities/systems/ScriptSystem,goo/entities/systems/LightingSystem,goo/renderer/SimplePartitioner,goo/entities/managers/LightManager,goo/entities/systems/CameraSystem,goo/renderer/Camera,goo/entities/components/CameraComponent,goo/util/Stats".split(","),
function(e,d,b,a,c,f,g,j,i,l,m,k,p,n){function o(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];if(window.requestAnimationFrame===void 0)window.requestAnimationFrame=function(b){var c=Date.now(),d=Math.max(0,16-(c-a)),f=window.setTimeout(function(){b(c+d)},d);a=c+d;return f};if(window.cancelAnimationFrame===
void 0)window.cancelAnimationFrame=function(a){clearTimeout(a)}}return function(h){function k(a){try{u.world.tpf=(a-x)/1E3;u.world.time+=u.world.tpf;e.time=u.world.time;x=a;if(u.world.tpf<0)u.world.time=0,u.world.tpf=0,e.time=0;else{u.world.process();u.renderer.info.reset();v.render(u.renderer);for(var b in u.callbacks)u.callbacks[b](u.world.tpf);u.stats&&u.stats.update(u.renderer.info)}window.requestAnimationFrame(k)}catch(c){c instanceof Error?console.error(c.stack):console.error(c)}}h=h||{};this.world=
new e;this.renderer=new c(h);this.world.setManager(new l);this.world.setSystem(new g);this.world.setSystem(new d);this.world.setSystem(new m);this.world.setSystem(new f);this.world.setSystem(new j);var p=new a;p.partitioner=new i;this.world.setSystem(p);var v=new b(p.renderList);this.world.setSystem(v);o();window.requestAnimationFrame(k);if(h.showStats)this.stats=new n,this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="10px",this.stats.domElement.style.top="10px",document.body.appendChild(this.stats.domElement);
this.callbacks=[];var u=this,x=Date.now()}});n("goo/animation/blendtree/ClipSource",["goo/math/MathUtils"],function(e){function d(b,a){this._clip=b;a.getClipInstance(b)}d.prototype.setTime=function(b,a){var c=a.getClipInstance(this._clip);if(c._active){var d=c._timeScale*(b-c._startTime),g=this._clip._maxTime;if(g<=0)return!1;c._loopCount===-1||c._loopCount>1&&g*c._loopCount>=Math.abs(d)?d<0?d=g+d%g:d%=g:d<0&&(d=g+d);if(d>g||d<0)d=e.clamp(d,0,g),c.fireAnimationFinished(),c._active=!1;this._clip.update(d,
c)}return c._active};d.prototype.resetClips=function(b,a){b.resetClipInstance(this._clip,a)};d.prototype.isActive=function(b){return b.getClipInstance(this._clip)._active&&this._clip._maxTime>0};d.prototype.getSourceData=function(b){return b.getClipInstance(this._clip)._clipStateObjects};return d});n("goo/animation/state/AbstractFiniteState",[],function(){function e(){this._globalStartTime=0;this._lastOwner=null}e.prototype.resetClips=function(d,b){this._globalStartTime=isNaN(b)?d.getCurrentGlobalTime():
b};return e});n("goo/animation/state/SteadyState",["goo/animation/state/AbstractFiniteState"],function(e){function d(b){e.call(this);this._name=b;this._transitions={};this._sourceTree=this._endTransition=null}d.prototype=Object.create(e.prototype);d.prototype.doTransition=function(b,a){var c=this._transitions[b];return c?c.doTransition(this,a):null};d.prototype.update=function(b,a){if(!this._sourceTree.setTime(b,a._manager)){var c=this._lastOwner;if(this._endTransition!==null){var d=this._endTransition.doTransition(this,
a);d&&(d.resetClips(a.getManager()),d.update(b,a));this!==d&&c.replaceState(this,d)}}};d.prototype.postUpdate=function(b){if(!this._sourceTree.isActive(b._manager))b=this._lastOwner,this._endTransition===null&&b.replaceState(this,null)};d.prototype.getCurrentSourceData=function(b){return this._sourceTree.getSourceData(b)};d.prototype.resetClips=function(b,a){e.prototype.resetClips.call(this,b,a);this._sourceTree.resetClips(b,this._globalStartTime)};return d});n("goo/animation/layer/AnimationLayer",
["goo/animation/state/SteadyState"],function(e){function d(b){this._name=b;this._steadyStates={};this._layerBlender=this._manager=this._currentState=null;this._transitions={}}d.BASE_LAYER_NAME="-BASE_LAYER-";d.prototype.doTransition=function(b){var a=this._currentState;if(a instanceof e){var c=a.doTransition(b,this);c||((b=this._transitions[b])||(b=this._transitions["*"]),b&&(c=b.doTransition(a,this)));if(c&&c!==a)return this.setCurrentState(c,!1),!0}else if(!a&&((b=this._transitions[b])||(b=this._transitions["*"]),
b))return this.setCurrentState(b.doTransition(a,this),!0),!0;return!1};d.prototype.setCurrentState=function(b,a){if(this._currentState=b)b._lastOwner=this,a&&b.resetClips(this._manager)};d.prototype.setCurrentStateByName=function(b,a){if(b){var c=this._steadyStates[b];if(c)return this.setCurrentState(c,a),!0;else console.warn("unable to find SteadyState named: "+b)}return!1};d.prototype.getCurrentSourceData=function(){return this._layerBlender!==null?this._layerBlender.getBlendedSourceData(this._manager):
this._currentState!==null?this._currentState.getCurrentSourceData(this._manager):null};d.prototype.updateLayerBlending=function(b){if(this._layerBlender)this._layerBlender._layerA=b,this._layerBlender._layerB=this};d.prototype.clearCurrentState=function(){this.setCurrentState(null,!1)};d.prototype.replaceState=function(b,a){this._currentState===b&&this.setCurrentState(a,!1)};return d});n("goo/animation/state/AbstractTransitionState",["goo/animation/state/AbstractFiniteState"],function(e){function d(b){e.call(this);
this._targetState=b;this._endWindow=this._startWindow=-1}d.prototype=Object.create(e.prototype);d.prototype.doTransition=function(b,a){return!a._currentState?null:this.isInTimeWindow(a._manager.getCurrentGlobalTime()-a._currentState._globalStartTime)?this.getTransitionState(b,a):null};d.prototype.isInTimeWindow=function(b){return this._startWindow<=0?this._endWindow<=0?!0:b<=this._endWindow:this._endWindow<=0?b>=this._startWindow:this._startWindow<=this._endWindow?this._startWindow<=b&&b<=this._endWindow:
b>=this._startWindow||b<=this._endWindow};d.prototype.getTransitionState=function(){return null};return d});n("goo/util/Enum",[],function(){function e(a,b){Object.getOwnPropertyNames(b).forEach(function(d){Object.defineProperty(a,d,Object.getOwnPropertyDescriptor(b,d))});return a}function d(a,b){this.name=a;b&&e(this,b);Object.freeze(this)}function b(a){arguments.length===1&&a!==null&&typeof a==="object"?Object.keys(a).forEach(function(b){this[b]=new d(b,a[b])},this):Array.prototype.forEach.call(arguments,
function(a){this[a]=new d(a)},this);Object.freeze(this)}d.prototype=Object.create(null);d.prototype.constructor=d;d.prototype.toString=function(){return"|"+this.name+"|"};Object.freeze(d.prototype);b.prototype.symbols=function(){return Object.keys(this).map(function(a){return this[a]},this)};b.prototype.contains=function(a){return!a instanceof d?!1:this[a.name]===a};return b});n("goo/animation/state/StateBlendType",["goo/util/Enum"],function(e){return new e("Linear","SCurve3","SCurve5")});n("goo/math/Quaternion",
["goo/math/Vector","goo/math/Matrix3x3"],function(e,d){function b(){e.call(this,4);this.set(arguments.length!==0?arguments:[0,0,0,1])}b.prototype=Object.create(e.prototype);b.prototype.setupAliases([["x"],["y"],["z"],["w"]]);b.IDENTITY=new b(0,0,0,1);b.ALLOWED_DEVIANCE=1.0E-8;b.add=function(a,c,d){d||(d=new b);d.data[0]=a.data[0]+c.data[0];d.data[1]=a.data[1]+c.data[1];d.data[2]=a.data[2]+c.data[2];d.data[3]=a.data[3]+c.data[3];return d};b.sub=function(a,c,d){d||(d=new b);d.data[0]=a.data[0]-c.data[0];
d.data[1]=a.data[1]-c.data[1];d.data[2]=a.data[2]-c.data[2];d.data[3]=a.data[3]-c.data[3];return d};b.mul=function(a,c,d){d||(d=new b);d.data[0]=a.data[0]*c.data[0];d.data[1]=a.data[1]*c.data[1];d.data[2]=a.data[2]*c.data[2];d.data[3]=a.data[3]*c.data[3];return d};b.div=function(a,c,d){d||(d=new b);var e=!0;d.data[0]=(e&=c.data[0]<0||c.data[0]>0)?a.data[0]/c.data[0]:0;d.data[1]=(e&=c.data[1]<0||c.data[1]>0)?a.data[1]/c.data[1]:0;d.data[2]=(e&=c.data[2]<0||c.data[2]>0)?a.data[2]/c.data[2]:0;d.data[3]=
(e&=c.data[3]<0||c.data[3]>0)?a.data[3]/c.data[3]:0;e===!1&&console.warn("[Quaternion.div] Attempted to divide by zero!");return d};b.scalarAdd=function(a,c,d){d||(d=new b);d.data[0]=a.data[0]+c;d.data[1]=a.data[1]+c;d.data[2]=a.data[2]+c;d.data[3]=a.data[3]+c;return d};b.scalarSub=function(a,c,d){d||(d=new b);d.data[0]=a.data[0]-c;d.data[1]=a.data[1]-c;d.data[2]=a.data[2]-c;d.data[3]=a.data[3]-c;return d};b.scalarMul=function(a,c,d){d||(d=new b);d.data[0]=a.data[0]*c;d.data[1]=a.data[1]*c;d.data[2]=
a.data[2]*c;d.data[3]=a.data[3]*c;return d};b.scalarDiv=function(a,c,d){d||(d=new b);var e=!0,c=(e&=c<0||c>0)?1/c:0;d.data[0]=a.data[0]*c;d.data[1]=a.data[1]*c;d.data[2]=a.data[2]*c;d.data[3]=a.data[3]*c;e===!1&&console.warn("[Quaternion.scalarDiv] Attempted to divide by zero!");return d};b.slerp=function(a,b,d,e){if(d===0)return e.set(a);else if(d===1)return e.set(b);if(a.equals(b))return copy(a);var j=a.dot(b);e.copy(b);j<0&&(e.negate(),j=-j);var b=1-d,i=d;1-j>0.1&&(j=Math.acos(j),i=1/Math.sin(j),
b=Math.sin((1-d)*j)*i,i*=Math.sin(d*j));e.set(b*a.x+i*e.x,b*a.y+i*e.y,b*a.z+i*e.z,b*a.w+i*e.w);return e};b.prototype.negate=function(){this.x*=-1;this.y*=-1;this.z*=-1;this.w*=-1;return this};b.prototype.add=function(a){return b.add(this,a,this)};b.prototype.sub=function(a){return b.sub(this,a,this)};b.prototype.mul=function(a){return b.mul(this,a,this)};b.prototype.div=function(a){return b.div(this,a,this)};b.prototype.scalarAdd=function(a){return b.scalarAdd(this,a,this)};b.prototype.scalarSub=
function(a){return b.scalarSub(this,a,this)};b.prototype.scalarMul=function(a){return b.scalarMul(this,a,this)};b.prototype.scalarDiv=function(a){return b.scalarDiv(this,a,this)};b.prototype.slerp=function(a,c){var d=(new b).copy(a);b.slerp(this,a,c,d);this.copy(d);return this};b.prototype.fromRotationMatrix=function(a){var b=a.e00+a.e11+a.e22,d,e,j;if(b>=0){var i=Math.sqrt(b+1);j=0.5*i;i=0.5/i;b=(a.e21-a.e12)*i;d=(a.e02-a.e20)*i;e=(a.e10-a.e01)*i}else a.e00>a.e11&&a.e00>a.e22?(i=Math.sqrt(1+a.e00-
a.e11-a.e22),b=i*0.5,i=0.5/i,d=(a.e10+a.e01)*i,e=(a.e02+a.e20)*i,j=(a.e21-a.e12)*i):a.e11>a.e22?(i=Math.sqrt(1+a.e11-a.e00-a.e22),d=i*0.5,i=0.5/i,b=(a.e10+a.e01)*i,e=(a.e21+a.e12)*i,j=(a.e02-a.e20)*i):(i=Math.sqrt(1+a.e22-a.e00-a.e11),e=i*0.5,i=0.5/i,b=(a.e02+a.e20)*i,d=(a.e21+a.e12)*i,j=(a.e10-a.e01)*i);return this.set(b,d,e,j)};b.prototype.toRotationMatrix=function(a){var b=a;b||(b=new d);var f=this.magnitudeSquared(),f=f>0?2/f:0,e=this.x*f,j=this.y*f,i=this.z*f,f=this.x*e,l=this.x*j,m=this.x*i;
e*=this.w;var k=this.y*j,p=this.y*i;j*=this.w;var n=this.z*i;i*=this.w;a.e00=1-(k+n);a.e01=l-i;a.e02=m+j;a.e10=l+i;a.e11=1-(f+n);a.e12=p-e;a.e20=m-j;a.e21=p+e;a.e22=1-(f+k);return b};b.prototype.normalize=function(){var a=1/this.magnitude();return this.set(this.x*a,this.y*a,this.z*a,this.w*a)};b.prototype.magnitude=function(){var a=this.magnitudeSquared();return a===1?1:Math.sqrt(a)};b.prototype.magnitudeSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w};b.prototype.equals=
function(a){return this===a?!0:!(a instanceof b)?!1:Math.abs(this.x-a.x)<b.ALLOWED_DEVIANCE&&Math.abs(this.y-a.y)<b.ALLOWED_DEVIANCE&&Math.abs(this.z-a.z)<b.ALLOWED_DEVIANCE&&Math.abs(this.w-a.w)<b.ALLOWED_DEVIANCE};return b});n("goo/animation/clip/TransformData",["goo/math/Quaternion","goo/math/Vector3"],function(e,d){function b(a){this._rotation=(new e).copy(a?a._rotation:e.IDENTITY);this._scale=(new d).copy(a?a._scale:d.ONE);this._translation=(new d).copy(a?a._translation:d.ZERO)}b.prototype.applyTo=
function(a){a.setIdentity();a.rotation.copyQuaternion(this._rotation);a.scale.copy(this._scale);a.translation.copy(this._translation);a.update()};b.prototype.set=function(a){this._rotation.copy(a._rotation);this._scale.copy(a._scale);this._translation.copy(a._translation)};b.prototype.blend=function(a,c,d){var d=d?d:new b,g=0,j=0,i=0,l=0,m=0,k=0,p,n;n=1-c;p=this._translation;l+=p.x*n;m+=p.y*n;k+=p.z*n;p=this._scale;g+=p.x*n;j+=p.y*n;i+=p.z*n;n=c;p=a._translation;l+=p.x*n;m+=p.y*n;k+=p.z*n;p=a._scale;
g+=p.x*n;j+=p.y*n;i+=p.z*n;d._scale.set(g,j,i);d._translation.set(l,m,k);e.slerp(this._rotation,a._rotation,n,d._rotation);return d};return b});n("goo/animation/blendtree/AbstractTwoPartSource",[],function(){return function(e,d,b){this._sourceA=e?e:null;this._sourceB=d?d:null;this._blendKey=b?b:null}});n("goo/animation/blendtree/BinaryLERPSource",["goo/math/MathUtils","goo/animation/clip/TransformData","goo/animation/blendtree/AbstractTwoPartSource"],function(e,d,b){function a(a,d,e){b.call(this,
a,d,e)}a.prototype=Object.create(b.prototype);a.prototype.getSourceData=function(b){var d=this._sourceA?this._sourceA.getSourceData(b):null,e=this._sourceB?this._sourceB.getSourceData(b):null;return a.combineSourceData(d,e,b._valuesStore[this._blendKey])};a.prototype.setTime=function(a,b){var d=!1;this._sourceA&&(d=d||this._sourceA.setTime(a,b));this._sourceB&&(d=d||this._sourceB.setTime(a,b));return d};a.prototype.resetClips=function(a,b){this._sourceA&&this._sourceA.resetClips(a,b);this._sourceB&&
this._sourceB.resetClips(a,b)};a.prototype.isActive=function(a){var b=!1;this._sourceA&&(b=b||this._sourceA.isActive(a));this._sourceB&&(b=b||this._sourceB.isActive(a));return b};a.combineSourceData=function(b,f,e,j){if(f){if(!b)return f}else return b;var j=j?j:{},i;for(i in b){var l=b[i],m=f[i];isNaN(l)?j[i]=l instanceof d?m?l.blend(m,e,j[i]):l:l:a.blendFloatValues(j,i,e,l,m)}for(i in f)j[i]||(j[i]=entryBData[i]);return j};a.blendFloatValues=function(a,b,d,j,i){a[b]=isNaN(i)?j:e.lerp(d,j[0],i[0])};
return a});n("goo/animation/state/AbstractTwoStateLerpTransition",["goo/animation/state/AbstractTransitionState","goo/animation/state/StateBlendType","goo/animation/blendtree/BinaryLERPSource"],function(e,d,b){function a(a,b,d){e.call(this,a);this._fadeTime=b;this._type=d;this._start=this._percent=0;this._sourceData=this._stateB=this._stateA=null}a.prototype=Object.create(e.prototype);a.prototype.setStateA=function(a){if(a===this)throw Error("Can not set state A to self.");this._stateA=a;if(this._stateA!==
null)this._stateA._lastOwner=this;if(this._sourceData)this._sourceData={}};a.prototype.setStateB=function(a){if(a===this)throw Error("Can not set state B to self.");this._stateB=a;if(this._stateB!==null)this._stateB._lastOwner=this;if(this._sourceData)this._sourceData={}};a.prototype.update=function(a){a-=this._start;if(a>this._fadeTime)this._lastOwner.replaceState(this,this._stateB);else switch(a/=this._fadeTime,this._blendType){case d.SCurve3:this._percent=MathUtils.scurve3(a);break;case d.SCurve5:this._percent=
MathUtils.scurve5(a);break;case d.Linear:this._percent=a;break;default:this._percent=a}};a.prototype.getCurrentSourceData=function(a){var d=this._stateA?this._stateA.getCurrentSourceData(a):null,a=this._stateB?this._stateB.getCurrentSourceData(a):null;this._sourceData||(_sourceData={});return b.combineSourceData(d,a,this._percent,this._sourceData)};a.prototype.getCurrentSourceData=function(a){var d=this._stateA?this._stateA.getCurrentSourceData(a):null,a=this._stateB?this._stateB.getCurrentSourceData(a):
null;if(!this._sourceData)this._sourceData={};return b.combineSourceData(d,a,this._percent,this._sourceData)};a.prototype.replaceState=function(a,b){if(b!=null)if(this._stateA==a)this._stateA=b;else if(this._stateB==a)this._stateB=b};return a});n("goo/animation/state/FadeTransitionState",["goo/animation/state/AbstractTwoStateLerpTransition"],function(e){function d(b,a,c){e.call(this,b,a,c)}d.prototype=Object.create(e.prototype);d.prototype.update=function(b,a){e.prototype.update.call(this,b,a);this._stateA!=
null&&this._stateA.update(b,a);this._stateB!=null&&this._stateB.update(b,a)};d.prototype.getTransitionState=function(b,a){this._start=a._manager.getCurrentGlobalTime();this.setStateA(b);this.setStateB(a._steadyStates[this._targetState]);if(!this._stateB)return null;this._stateB.resetClips(a._manager,this._start);return this};d.prototype.postUpdate=function(b){this._stateA!=null&&this._stateA.postUpdate(b);this._stateB!=null&&this._stateB.postUpdate(b)};return d});n("goo/animation/state/FrozenTransitionState",
["goo/animation/state/AbstractTwoStateLerpTransition"],function(e){function d(b,a,c){e.call(this,b,a,c)}d.prototype=Object.create(e.prototype);d.prototype.update=function(b,a){e.prototype.update.call(this,b,a);this._stateB!=null&&this._stateB.update(b,a)};d.prototype.getTransitionState=function(b,a){this._start=a._manager.getCurrentGlobalTime();this.setStateA(b);this.setStateB(a._steadyStates[this._targetState]);if(!this._stateB)return null;this._stateB.resetClips(a._manager,this._start);return this};
d.prototype.postUpdate=function(b){this._stateB!=null&&this._stateB.postUpdate(b)};return d});n("goo/animation/state/IgnoreTransitionState",["goo/animation/state/AbstractTransitionState"],function(e){function d(){e.call(this,null)}d.prototype=Object.create(e.prototype);d.prototype.update=function(){};d.prototype.getTransitionState=function(b){return b};d.prototype.getCurrentSourceData=function(){return null};d.prototype.postUpdate=function(){};return d});n("goo/animation/state/ImmediateTransitionState",
["goo/animation/state/AbstractTransitionState"],function(e){function d(b){e.call(this,b)}d.prototype=Object.create(e.prototype);d.prototype.getTransitionState=function(b,a){var c=a._steadyStates[this._targetState];if(!c)return null;c.resetClips(a._manager);return c};d.prototype.update=function(){};d.prototype.getCurrentSourceData=function(){return{}};d.prototype.postUpdate=function(){};return d});n("goo/animation/state/SyncFadeTransitionState",["goo/animation/state/FadeTransitionState"],function(e){function d(b,
a,c){e.call(this,b,a,c)}d.prototype=Object.create(e.prototype);d.prototype.getTransitionState=function(b,a){this._start=a._manager.getCurrentGlobalTime();this.setStateA(b);this.setStateB(a._steadyStates[this._targetState]);if(!this._stateB)return null;this._stateB.resetClips(a._manager,this._stateA._globalStartTime);return this};return d});n("goo/animation/clip/AbstractAnimationChannel",[],function(){function e(d,b){this._channelName=d;this._times=b instanceof Array&&b.length?b.slice(0):[]}e.prototype.getSampleCount=
function(){return this._times.length};e.prototype.getMaxTime=function(){return this._times.length?this._times[this._times.length-1]:0};e.prototype.updateSample=function(d,b){if(this._times.length){var a=this._times.length-1;if(d<0||this._times.length===1)this.setCurrentSample(0,0,b);else if(d>=this._times[a])this.setCurrentSample(a,0,b);else{for(var c=a=0;c<this._times.length-1;c++)this._times[c]<d&&(a=c);this.setCurrentSample(a,(d-this._times[a])/(this._times[a+1]-this._times[a]),b)}}};return e});
n("goo/animation/clip/TransformChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TransformData","goo/math/Quaternion","goo/math/Vector3"],function(e,d,b,a){function c(a,b,c,d,l){e.call(this,a,b);if(c.length/4!==b.length||d.length/3!==b.length||l.length/3!==b.length)throw Error("All provided arrays must be the same length (accounting for type)! Channel: "+a);this._rotations=c.slice(0);this._translations=d.slice(0);this._scales=l.slice(0)}c.prototype=Object.create(e.prototype);
c.prototype.createStateDataObject=function(){return new d};c.prototype.setCurrentSample=function(c,d,e){var i=c*4,l=c*3,m=(c+1)*4,c=(c+1)*3;d===0?(e._rotation.set([this._rotations[i+0],this._rotations[i+1],this._rotations[i+2],this._rotations[i+3]]),e._translation.set([this._translations[l+0],this._translations[l+1],this._translations[l+2]]),e._scale.set([this._scales[l+0],this._scales[l+1],this._scales[l+2]])):d===1?(e._rotation.set([this._rotations[m+0],this._rotations[m+1],this._rotations[m+2],
this._rotations[m+3]]),e._translation.set([this._translations[c+0],this._translations[c+1],this._translations[c+2]]),e._scale.set([this._scales[c+0],this._scales[c+1],this._scales[c+2]])):(i=e._rotation.set([this._rotations[i+0],this._rotations[i+1],this._rotations[i+2],this._rotations[i+3]]),m=(new b).set([this._rotations[m+0],this._rotations[m+1],this._rotations[m+2],this._rotations[m+3]]),i.equals(m)||i.slerp(m,d),m=e._translation.set([this._translations[l+0],this._translations[l+1],this._translations[l+
2]]),i=(new a).set([this._translations[c+0],this._translations[c+1],this._translations[c+2]]),m.equals(i)||m.lerp(i,d),e=e._scale.set([this._scales[l+0],this._scales[l+1],this._scales[l+2]]),l=(new a).set([this._scales[c+0],this._scales[c+1],this._scales[c+2]]),e.equals(l)||e.lerp(l,d))};c.prototype.getTransformData=function(a,b){var c=b?b:new d;c.setRotation(this._rotations[a]);c.setScale(this._scales[a]);c.setTranslation(this._translations[a]);return c};return c});n("goo/animation/clip/JointData",
["goo/animation/clip/TransformData"],function(e){function d(b){e.call(this,b);this._jointIndex=b?b._jointIndex:0}d.prototype=Object.create(e.prototype);d.prototype.set=function(b){e.prototype.set.call(this,b);this._jointIndex=source._jointIndex};d.prototype.blend=function(b,a,c){if(c){if(c instanceof d)c._jointIndex=this._jointIndex}else c=new d,c._jointIndex=this._jointIndex;return e.prototype.blend.call(this,b,a,c)};return d});n("goo/animation/clip/JointChannel",["goo/animation/clip/TransformChannel",
"goo/animation/clip/JointData"],function(e,d){function b(a,c,d,g,j,i){e.call(this,b.JOINT_CHANNEL_NAME+c,d,g,j,i);this._jointName=a;this._jointIndex=c}b.prototype=Object.create(e.prototype);b.JOINT_CHANNEL_NAME="_jnt";b.prototype.createStateDataObject=function(){return new d};b.prototype.setCurrentSample=function(a,b,d){e.prototype.setCurrentSample.call(this,a,b,d);d._jointIndex=this._jointIndex};b.prototype.getJointData=function(a,b){var f=b?b:new d;e.prototype.getTransformData.call(this,a,f);f._jointIndex=
this._jointIndex;return f};return b});n("goo/animation/blendtree/ExclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],function(e,d){function b(a,b){d.call(this,a,b);this._disabledChannels={}}b.prototype=Object.create(d.prototype);b.prototype.clearDisabled=function(){this._disabledChannels={}};b.prototype.addDisabledChannels=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++)this._disabledChannels[arguments[0][a]]=
!0;else for(a=0;a<arguments.length;a++)this._disabledChannels[arguments[a]]=!0};b.prototype.addDisabledJoints=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++){var b=e.JOINT_CHANNEL_NAME+arguments[0][a];this._disabledChannels[b]=!0}else for(a=0;a<arguments.length;a++)b=e.JOINT_CHANNEL_NAME+arguments[a],this._disabledChannels[b]=!0};b.prototype.getSourceData=function(a){var a=d.prototype.getSourceData.call(this,a),b={},f;for(f in a)this._disabledChannels[f]||
(b[f]=a[f]);return b};return b});n("goo/animation/blendtree/FrozenClipSource",[],function(){function e(d,b){this._source=d;this._time=b}e.prototype.getSourceData=function(d){return this._source.getSourceData(d)};e.prototype.resetClips=function(d){this._source.resetClips(d,0)};e.prototype.setTime=function(d,b){this._source.setTime(this._time,b);return!0};e.prototype.isActive=function(){return!0};return e});n("goo/animation/blendtree/InclusiveClipSource",["goo/animation/clip/JointChannel","goo/animation/blendtree/ClipSource"],
function(e,d){function b(a,b){d.call(this,a,b);this._enabledChannels={}}b.prototype=Object.create(d.prototype);b.prototype.clearEnabled=function(){this._enabledChannels={}};b.prototype.addEnabledChannels=function(){if(arguments.length===1&&typeof arguments[0]==="object")for(var a=0;a<arguments[0].length;a++)this._enabledChannels[arguments[0][a]]=!0;else for(a=0;a<arguments.length;a++)this._enabledChannels[arguments[a]]=!0};b.prototype.addEnabledJoints=function(){if(arguments.length===1&&typeof arguments[0]===
"object")for(var a=0;a<arguments[0].length;a++){var b=e.JOINT_CHANNEL_NAME+arguments[0][a];this._enabledChannels[b]=!0}else for(a=0;a<arguments.length;a++)b=e.JOINT_CHANNEL_NAME+arguments[a],this._enabledChannels[b]=!0};b.prototype.getSourceData=function(a){var a=d.prototype.getSourceData.call(this,a),b={},f;for(f in this._enabledChannels)this._enabledChannels[f]&&(b[f]=a[f]);return b};return b});n("goo/animation/blendtree/ManagedTransformSource",["goo/animation/clip/JointChannel","goo/animation/clip/JointData",
"goo/math/Vector3","goo/math/Quaternion"],function(e,d){function b(a){this._sourceName=a?a:null;this._data={}}b.prototype.resetClips=function(){};b.prototype.setTime=function(){return!0};b.prototype.isActive=function(){return!0};b.prototype.setJointTransformData=function(a,b){var f=e.JOINT_CHANNEL_NAME+a;this._data[f]?this._data[f].set(b):this._data[f]=new d(b)};b.prototype.setJointTranslation=function(a,b){var f=e.JOINT_CHANNEL_NAME+a;if(this._data[f])this._data[f]._translation.set(b);else{var g=
new d;g._jointIndex=a;g._translation.set(b);this._data[f]=g}};b.prototype.setJointScale=function(a,b){var f=e.JOINT_CHANNEL_NAME+a;if(this._data[f])this._data[f]._scale.set(b);else{var g=new d;g._jointIndex=a;g._scale.set(b);this._data[f]=g}};b.prototype.setJointRotation=function(a,b){var f=e.JOINT_CHANNEL_NAME+a;if(this._data[f])this._data[f]._rotation.set(b);else{var g=new d;g._jointIndex=a;g._rotation.set(b);this._data[f]=g}};b.prototype.initJointsByName=function(a,b,f){for(var g=0,j=f.length;g<
j;g++){var i=a._skeleton.findJointByName(f[g]),l=new d;l._jointIndex=i;this.setJointTransformData(i,b.findChannelByName(e.JOINT_CHANNEL_NAME+i).getJointData(0,l))}};b.prototype.initJointsById=function(a,b){for(var f=0,g=b.length;f<g;f++){var j=b[f],i=new d;i._jointIndex=j;this.setJointTransformData(j,a.findChannelByName(e.JOINT_CHANNEL_NAME+j).getJointData(0,i))}};return b});n("goo/animation/layer/LayerLERPBlender",["goo/animation/blendtree/BinaryLERPSource"],function(e){function d(){this._layerB=
this._layerA=this._blendKey=null}d.prototype.getBlendedSourceData=function(b){var a=this._layerA.getCurrentSourceData(),c=this._layerB._currentState?this._layerB._currentState.getCurrentSourceData(b):null;return e.combineSourceData(a,c,b._valuesStore[this._blendKey])};return d});n("goo/loaders/JsonUtils","goo/renderer/Util,goo/renderer/MeshData,goo/renderer/BufferUtils,goo/math/Transform,goo/math/Matrix3x3,goo/math/Vector3,goo/animation/blendtree/ClipSource,goo/animation/layer/AnimationLayer,goo/animation/state/SteadyState,goo/animation/state/FadeTransitionState,goo/animation/state/FrozenTransitionState,goo/animation/state/IgnoreTransitionState,goo/animation/state/ImmediateTransitionState,goo/animation/state/SyncFadeTransitionState,goo/animation/state/StateBlendType,goo/animation/blendtree/BinaryLERPSource,goo/animation/blendtree/ExclusiveClipSource,goo/animation/blendtree/FrozenClipSource,goo/animation/blendtree/InclusiveClipSource,goo/animation/blendtree/ManagedTransformSource,goo/animation/layer/LayerLERPBlender".split(","),
function(e,d,b,a,c,f,g,j,i,l,m,k,p,n,o,h,s,r,v,u,x){function q(){}q.fillAttributeBufferFromCompressedString=function(a,b,c,d,f){var b=b.getAttributeBuffer(c),c=d.length,e=a.length/d.length,g,h,i,j,k;for(k=0;k<c;k++)for(j=g=0;j<e;j++)h=a.charCodeAt(j+k*e),i=j*c+k,g+=q.unzip(h),b[i]=(g+f[k])*d[k]};q.fillAttributeBuffer=function(a,b,c){b=b.getAttributeBuffer(c);for(c=0;c<a.length;c++)b[c]=a[c]};q.getIntBuffer=function(a,c){var d=b.createIndexBuffer(a.length,c);d.set(a);return d};q.getIntBufferFromCompressedString=
function(a,c){for(var d=0,f=b.createIndexBuffer(a.length,c),e=0;e<a.length;++e){var g=a.charCodeAt(e);d+=q.unzip(g);f[e]=d}return f};q.unzip=function(a){a>=57344&&(a-=2048);a-=35;return a>>1^-(a&1)};q.parseTransform=function(b){var c=new a;c.translation=q.parseVector3(b.Translation);c.scale=q.parseVector3(b.Scale);c.rotation=q.parseMatrix3(b.Rotation);return c};q.parseMatrix3=function(a){var b=new c;b.e00=a[0];b.e01=a[1];b.e02=a[2];b.e10=a[3];b.e11=a[4];b.e12=a[5];b.e20=a[6];b.e21=a[7];b.e22=a[8];
return b};q.parseVector3=function(a){return new f(a[0],a[1],a[2])};q.parseAnimationLayers=function(a,b,c,d,f){var f=f.Layers,e;for(e in f){var g;"DEFAULT"===e?g=a.getBaseAnimationLayer():(g=new j(e),a.addAnimationLayer(g));var h=f[e];q.parseLayerProperties(a,g,h);if(h.States)for(var i=h.States,k=0,l=i.length;k<l;k++)q.parseSteadyState(i[k],c,d,a,g);if(h.Transitions){var h=h.Transitions,m;for(m in h)g._transitions[m]=q.parseTransitionState(h[m],c,d,a)}}if(b!==null)b.onSuccess(d)};q.parseSteadyState=
function(a,b,c,d,f){var e=new i(a.Name?a.Name:"unknown");if(a.Clip){var h=a.Clip,j=b[h.Name],k=new g(j,d);e._sourceTree=k;c._usedClipSources[k._clip._name]=k;q.populateClipSource(k,j,h,d)}else if(a.Tree)e._sourceTree=q.parseTreeSource(a.Tree,b,c,d);if(a.EndTransition)e._endTransition=q.parseTransitionState(a.EndTransition,b,c,d);if(a.Transitions){var h=a.Transitions,l;for(l in h)e._transitions[l]=q.parseTransitionState(h[l],b,c,d)}a.Default&&f.setCurrentState(e,!0);f._steadyStates[e._name]=e};q.parseTransitionState=
function(a){var b=a[2];if("fade"===b)b=new l(a[3],a[4],o[a[5]]);else if("syncfade"===b)b=new n(a[3],a[4],o[a[5]]);else if("frozen"===b)b=new m(a[3],a[4],o[a[5]]);else if("immediate"===b)b=new p(a[3]);else if("ignore"===b)b=new k;else return null;isNaN(a[0])||b.setStartWindow(a[0]);isNaN(a[1])||b.setEndWindow(a[1]);return b};q.parseTreeSource=function(a,b,c,d){if(a.Clip){var a=a.Clip,b=b[a.Name],f=new g(b,d);c._usedClipSources[f._clip._name]=f;q.populateClipSource(f,b,a,d);return f}else if(a.InclusiveClip){a=
a.InclusiveClip;b=b[a.Name];f=new v(b,d);c._usedClipSources[f._clip._name]=f;q.populateClipSource(f,b,a,d);a.Channels&&f.addEnabledChannels(a.Channels);if(a.JointNames){var d=d.getSkeletonPose(0).getSkeleton(),b=a.JointNames,e;for(e in b)f.addEnabledJoints(d.findJointByName(e))}a.Joints&&f.addEnabledJoints(a.Joints);return f}else if(a.ExclusiveClip)return a=a.ExclusiveClip,b=b[a.Name],f=new s(b,d),c._usedClipSources[f._clip._name]=f,q.populateClipSource(f,b,a,d),a.Channels&&f.addDisabledChannels(a.Channels),
a.Joints&&f.addDisabledJoints(a.Joints),f;else if(a.Lerp){a=a.Lerp;f=q.parseTreeSource(a.ChildA,b,c,d);e=q.parseTreeSource(a.ChildB,b,c,d);f=new h(f,e);if(a.BlendKey)f._blendKey=a.BlendKey,d._valuesStore[f._blendKey]=isNaN(a.BlendWeight)?0:a.BlendWeight;return f}else if(a.Managed){a=a.Managed;f=new u;if(a.InitFromClip)a=a.InitFromClip,f._sourceName=a.Clip,b=b[f._sourceName],a.JointNames&&f.initJointsByName(d._applyToPoses[0],b,a.JointNames),a.JointIds&&f.initJointsById(b,a.JointIds);return f}else if(a.Frozen)return a=
a.Frozen,d=q.parseTreeSource(a.Child,b,c,d),new r(d,isNaN(a.Time)?0:a.Time);console.warn("no known source type found.");return null};q.populateClipSource=function(a,b,c,d){if(c.TimeScale!==void 0)d.getClipInstance(b)._timeScale=isNaN(c.TimeScale)?1:c.TimeScale;if(c.LoopCount!==void 0)d.getClipInstance(b)._loopCount=isNaN(c.LoopCount)?1:c.LoopCount;if(c.Active!==void 0)d.getClipInstance(b)._active=c.Active===!0};q.parseLayerProperties=function(a,b,c){if(c.BlendType){var d=null;if("lerp"===c.BlendType)d=
new x,b._layerBlender=d;if(d!==null&&c.BlendKey)d._blendKey=c.BlendKey,a._valuesStore[d._blendKey]=isNaN(c.BlendWeight)?0:c.BlendWeight}};q.parseChannelTimes=function(a,b){var c=a.Times;if(c)if(b){var d=a.TimeOffsetScale;return q.parseFloatArrayFromCompressedString(c,[d[1]],[d[0]])}else return c;return null};q.parseFloatLERPValues=function(a,b){var c=a.IFCValues;if(c)if(b){var d=a.IFCOffsetScale;return q.parseFloatArrayFromCompressedString(c,[d[1]],[d[0]])}else return c;return null};q.parseRotationSamples=
function(a,b,c){return(a=a.RotationSamples)?c?(b=1-(b+1>>1),c=1/-b,q.parseFloatArrayFromCompressedString(a,[c,c,c,c],[b,b,b,b])):q.parseQuaternionSamples(a):null};q.parseTranslationSamples=function(a,b,c){var d=a.UniformTranslation;if(d){d===void 0&&console.log("asdf");for(var a=d[0],c=d[1],d=d[2],f=[],e=0;e<b;e++)f[e*3+0]=a,f[e*3+1]=c,f[e*3+2]=d;return f}return(b=a.TranslationSamples)?c?(a=a.TranslationOffsetScale,c=a[3],q.parseFloatArrayFromCompressedString(b,[c,c,c],[a[0],a[1],a[2]])):q.parseVector3Samples(b):
null};q.parseScaleSamples=function(a,b,c){var d=a.UniformScale;if(d){for(var a=d,c=a[0],d=a[1],a=a[2],f=[],e=0;e<b;e++)f[e*3+0]=c,f[e*3+1]=d,f[e*3+2]=a;return f}return(b=a.ScaleSamples)?c?(a=a.ScaleOffsetScale,c=a[0],d=a[1],f=a[2],a=a[3],q.parseFloatArrayFromCompressedString(b,[a,a,a],[c,d,f])):q.parseVector3Samples(b):null};q.parseQuaternionSamples=function(a){if(!a)return null;for(var b=[],c=new Quaternion,d=0,f=a.length;d<f;d++){var e=a[d];if(e){if("*"===e)b[d*4+0]=c.x,b[d*4+1]=c.y,b[d*4+2]=c.z,
b[d*4+3]=c.w}else if(e&&e.length===4)c.set(e[0],e[1],e[2],e[3]),b[d*4+0]=c.x,b[d*4+1]=c.y,b[d*4+2]=c.z,b[d*4+3]=c.w}return b};q.parseVector3Samples=function(a){if(!a)return null;for(var b=[],c=new f,d=0,e=a.length;d<e;d++){var g=a[d];if(g){if("*"===g)b[d*3+0]=c.x,b[d*3+1]=c.y,b[d*3+2]=c.z}else if((g=g.isArray())&&g.length===3)c.set(g[0],g[1],g[2]),b[d*3+0]=c.x,b[d*3+1]=c.y,b[d*3+2]=c.z}return b};q.parseFloatArrayFromCompressedString=function(a,b,c){var d=[],f=b.length,e=a.length/b.length,g,h,i,j,
k;for(k=0;k<f;k++)for(j=g=0;j<e;j++)h=a.charCodeAt(j+k*e),i=j*f+k,g+=q.unzip(h),d[i]=(g+c[k])*b[k];return d};return q});n("goo/animation/Joint",["goo/math/Transform"],function(e){function d(b){this._name=b;this._parentIndex=this._index=0;this._inverseBindPose=new e}d.NO_PARENT=-32768;return d});n("goo/animation/Skeleton",[],function(){return function(e,d){this._name=e;this._joints=d}});n("goo/animation/SkeletonPose",["goo/math/Transform","goo/animation/Joint","goo/math/Matrix4x4"],function(e,d,b){function a(a){this._skeleton=
a;this._localTransforms=[];this._globalTransforms=[];this._matrixPalette=[];this._poseListeners=[];for(var a=this._skeleton._joints.length,d=0;d<a;d++)this._localTransforms[d]=new e;for(d=0;d<a;d++)this._globalTransforms[d]=new e;for(d=0;d<a;d++)this._matrixPalette[d]=new b;this.setToBindPose()}a.prototype.setToBindPose=function(){for(var a=new e,b=0;b<this._localTransforms.length;b++){this._localTransforms[b].copy(this._skeleton._joints[b]._inverseBindPose);this._localTransforms[b].invert(this._localTransforms[b]);
var g=this._skeleton._joints[b]._parentIndex;g!==d.NO_PARENT&&(a.multiply(this._skeleton._joints[g]._inverseBindPose,this._localTransforms[b]),this._localTransforms[b].copy(a))}this.updateTransforms()};a.prototype.updateTransforms=function(){for(var a=this._skeleton._joints.length,f=0;f<a;f++){var e=f,j=this._skeleton._joints[e]._parentIndex;j!==d.NO_PARENT?this._globalTransforms[e].multiply(this._globalTransforms[j],this._localTransforms[e]):this._globalTransforms[e].copy(this._localTransforms[e]);
b.combine(this._globalTransforms[e].matrix,this._skeleton._joints[e]._inverseBindPose.matrix,this._matrixPalette[e]);this._matrixPalette[e].transpose()}this.firePoseUpdated()};a.prototype.firePoseUpdated=function(){for(var a=this._poseListeners.length;--a>=0;)this._poseListeners[a].poseUpdated(this)};return a});n("goo/animation/clip/AnimationClip",[],function(){function e(d,b){this._name=d;this._channels=b||[];this._maxTime=0;this.updateMaxTimeIndex()}e.prototype.update=function(d,b){for(var a=0,
c=this._channels.length;a<c;++a){var f=this._channels[a],e=b.getApplyTo(f);f.updateSample(d,e)}};e.prototype.addChannel=function(d){this._channels.push(d);this.updateMaxTimeIndex()};e.prototype.removeChannel=function(d){d=this._channels.indexOf(d);return d>=0?(this._channels.splice(d,1),this.updateMaxTimeIndex(),!0):!1};e.prototype.findChannelByName=function(d){for(var b=0,a=this._channels.length;b<a;++b){var c=this._channels[b];if(d===c._channelName)return c}return null};e.prototype.updateMaxTimeIndex=
function(){this._maxTime=0;for(var d,b=0;b<this._channels.length;b++)if(d=this._channels[b].getMaxTime(),d>this._maxTime)this._maxTime=d};e.prototype.toString=function(){return this._name+this._channels.length};return e});n("goo/animation/clip/TriggerData",[],function(){function e(){this._currentTriggers=[];this._currentIndex=-1;this._armed=!1}e.prototype.getCurrentTrigger=function(){return this._currentTriggers.length==0?null:this._currentTriggers[this._currentTriggers.size()-1]};e.prototype.arm=
function(d,b){if(b==null||b.length===0)this._currentTriggers.length=0,this._armed=!1;else if(d!==_currentIndex){for(var a=this._currentTriggers.length=0,c=b.length;a<c;a++)this._currentTriggers.push(b[a]);this._armed=!0}this._currentIndex=d};return e});n("goo/animation/clip/InterpolatedFloatChannel",["goo/animation/clip/AbstractAnimationChannel","goo/animation/clip/TriggerData","goo/math/MathUtils"],function(e,d,b){function a(a,b,d){e.call(this,a,b);this._values=d?d.slice(0):null}a.prototype=Object.create(e.prototype);
a.prototype.createStateDataObject=function(){return[0]};a.prototype.setCurrentSample=function(a,d){store[0]=b.lerp(d,this._values[a],this._values[a+1])};return a});n("goo/animation/state/loader/OutputStore",[],function(){function e(){this._attachments=[];this._usedClipSources={}}e.prototype.findAttachmentPoint=function(d){for(var b=0,a=this._attachments.length;b<a;b++){var c=this._attachments[b];if(d===c.getName())return c}return null};return e});n("goo/util/URLTools",[],function(){function e(){}
e.getDirectory=function(d){var b=/.*\//.exec(d);return!b?d+"/":b[0]};return e});n("goo/loaders/JSONImporter","goo/entities/components/TransformComponent,goo/renderer/MeshData,goo/loaders/JsonUtils,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/renderer/Material,goo/renderer/TextureCreator,goo/renderer/Shader,goo/animation/Joint,goo/animation/Skeleton,goo/animation/SkeletonPose,goo/animation/clip/AnimationClip,goo/animation/clip/JointChannel,goo/animation/clip/TransformChannel,goo/animation/clip/InterpolatedFloatChannel,goo/animation/state/loader/OutputStore,goo/util/URLTools,goo/util/SimpleResourceUtil".split(","),
function(e,d,b,a,c,f,g,j,i,l,m,k,p,n,o,h,s,r){function v(a){this.world=a;this.materials={};this.skeletonMap={};this.poseMap={};this.slotUnitMap={diffuse:0,normal:1,ao:2,occlusion:3,specular:3};this.loadedEntities=[];this.baseTextureDir=""}function u(){this.materialName="not set";this.technique=this.profile=null;this.textureReferences={};this.textureFileNames={};this.textureMinificationFilters={};this.textureFlipSettings={};this.usesTransparency=!1;this.materialState={};this.connectedMeshes=[]}v.prototype.load=
function(a,b,c,d){var f=new XMLHttpRequest;b==null&&(b=s.getDirectory(a));f.open("GET",a,!0);var e=this;f.onreadystatechange=function(){if(f.readyState===4)if(f.status>=200&&f.status<=299){var a=e.parse(f.responseText,b,d);c.onSuccess(a)}else c.onError(f.statusText)};f.send()};v.prototype.parse=function(a,b,c){this.baseTextureDir=b||"";this.loadedEntities=[];this.shaderExtractor=c;a=JSON.parse(a);if(this.useCompression=a.UseCompression||!1)this.compressedVertsRange=a.CompressedVertsRange||16383,this.compressedColorsRange=
a.CompressedColorsRange||255,this.compressedUnitVectorRange=a.CompressedUnitVectorRange||1023;this._parseMaterials(a.Materials);a.Skeletons&&this.parseSkeletons(a.Skeletons);a.SkeletonPoses&&this.parseSkeletonPoses(a.SkeletonPoses);this._parseSpatial(a.Scene);delete this.shaderExtractor;return this.loadedEntities};v.prototype._parseSpatial=function(f){var e=f.Type,g=f.Name===null?"null":f.Name,h=this.world.createEntity();h.name=g;this.loadedEntities.push(h);if(e==="Node"){if(f.Children)for(var i in f.Children)e=
this._parseSpatial(f.Children[i]),e!==null&&h.transformComponent.attachChild(e.transformComponent)}else if(e==="Mesh"){i=this._parseMeshData(f.MeshData,0,h,e);if(i===null)return null;i.type=d.MESH;h.setComponent(new a(i));e=new c;h.setComponent(e);this._parseMaterial(f,h)}else if(e==="SkinnedMesh"){i=this._parseMeshData(f.MeshData,4,h,e);if(i===null)return null;i.type=d.SKINMESH;h.setComponent(new a(i));e=new c;h.setComponent(e);this._parseMaterial(f,h);if(f.Pose)i.currentPose=this.poseMap[f.Pose]}else return;
f=b.parseTransform(f.Transform);h.transformComponent.transform=f;return h};v.prototype.parseSkeletons=function(a){for(var c=0,d=a.length;c<d;c++){for(var f=a[c],e=f.ref,g=f.Name,f=f.Joints,h=[],j=0,k=f.length;j<k;j++){var m=f[j],p=new i(m.Name);p._index=Math.round(m.Index);p._parentIndex=Math.round(m.ParentIndex);p._inverseBindPose.copy(b.parseTransform(m.InverseBindPose));p._inverseBindPose.update();h[j]=p}g=new l(g,h);this.skeletonMap[e]=g}};v.prototype.parseSkeletonPoses=function(a){for(var b=
0,c=a.length;b<c;b++){var d=a[b],f=d.ref,d=new m(this.skeletonMap[d.Skeleton]);d.setToBindPose();this.poseMap[f]=d}};v.prototype._parseMeshData=function(a,c,f,e){f=a.VertexCount;if(f===0)return null;var g=a.IndexLengths?a.IndexLengths[0]:0,h={};if(a.Vertices)h.POSITION=d.createAttribute(3,"Float");if(a.Normals)h.NORMAL=d.createAttribute(3,"Float");if(a.Tangents)h.TANGENT=d.createAttribute(4,"Float");if(a.Colors)h.COLOR=d.createAttribute(4,"Float");if(c>0&&a.Weights)h.WEIGHTS=d.createAttribute(4,"Float");
if(c>0&&a.Joints)h.JOINTIDS=d.createAttribute(4,"Short");if(a.TextureCoords)for(var i in a.TextureCoords)h["TEXCOORD"+i]=d.createAttribute(2,"Float");c=new d(h,f,g);if(a.Vertices)this.useCompression?(i=a.VertexOffsets,b.fillAttributeBufferFromCompressedString(a.Vertices,c,d.POSITION,[a.VertexScale,a.VertexScale,a.VertexScale],[i.xOffset,i.yOffset,i.zOffset])):b.fillAttributeBuffer(a.Vertices,c,d.POSITION);a.Weights&&(this.useCompression?(g=1/this.compressedVertsRange,b.fillAttributeBufferFromCompressedString(a.Weights,
c,d.WEIGHTS,[g],[0])):b.fillAttributeBuffer(a.Weights,c,d.WEIGHTS));a.Normals&&(this.useCompression?(i=1-(this.compressedUnitVectorRange+1>>1),g=1/-i,b.fillAttributeBufferFromCompressedString(a.Normals,c,d.NORMAL,[g,g,g],[i,i,i])):b.fillAttributeBuffer(a.Normals,c,d.NORMAL));a.Tangents&&(this.useCompression?(i=1-(this.compressedUnitVectorRange+1>>1),g=1/-i,b.fillAttributeBufferFromCompressedString(a.Tangents,c,d.TANGENT,[g,g,g,g],[i,i,i,i])):b.fillAttributeBuffer(a.Tangents,c,d.TANGENT));a.Colors&&
(this.useCompression?(i=0,g=255/(this.compressedColorsRange+1),b.fillAttributeBufferFromCompressedString(a.Colors,c,d.COLOR,[g,g,g,g],[i,i,i,i])):b.fillAttributeBuffer(a.Colors,c,d.COLOR));if(a.TextureCoords)if(g=a.TextureCoords,this.useCompression)for(i=0;i<g.length;i++)h=g[i],b.fillAttributeBufferFromCompressedString(h.UVs,c,"TEXCOORD"+i,h.UVScales,h.UVOffsets);else for(i=0;i<g.length;i++)b.fillAttributeBuffer(g[i],c,"TEXCOORD"+i);if(a.Joints)if(g=c.getAttributeBuffer(d.JOINTIDS),h=this.useCompression?
b.getIntBufferFromCompressedString(a.Joints,32767):b.getIntBuffer(a.Joints,32767),e==="SkinnedMesh"){var e=[],j=0;i=0;for(var k=h.length;i<k;i++){var l=h[i];e[l]===void 0&&(e[l]=j++);g.set([e[l]],i)}i=[];for(l=0;l<e.length;l++)j=e[l],j!==void 0&&(i[j]=l);c.paletteMap=i}else{i=0;for(k=h.capacity();i<k;i++)g.putCast(i,h.get(i))}a.Indices&&(this.useCompression?c.getIndexBuffer().set(b.getIntBufferFromCompressedString(a.Indices,f)):c.getIndexBuffer().set(b.getIntBuffer(a.Indices,f)));if(a.IndexModes)if(f=
a.IndexModes,f.length===1)c.indexModes[0]=f[0];else{e=[];for(i=0;i<f.length;i++)e[i]=f[i];c.indexModes=e}if(a.IndexLengths){a=a.IndexLengths;f=[];for(i=0;i<a.length;i++)f[i]=a[i];c.indexLengths=f}return c};v.prototype._parseMaterials=function(a){if(a)for(var b=0,c=a.length;b<c;b++){var d=a[b];if(d!==null){var f=new u;f.materialName=d.MaterialName;f.profile=d.Profile;f.technique=d.Technique;f.usesTransparency=d.UsesTransparency;f.materialState=this._parseMaterialstate(d);if(d.TextureEntries)for(var d=
d.TextureEntries,e=0,g=d.length;e<g;e++){var h=d[e],i=h.Slot,j=h.TextureReference||null,k=h.TextureSource||null,l=h.MinificationFilter||null,m="Trilinear";if(l!==null)try{m="minificationFilterStr"}catch(p){console.warn("Bad texture minification filter: "+l)}h=h.Flip!==void 0?h.Flip:!0;f.textureReferences[i]=j;f.textureFileNames[i]=k;f.textureMinificationFilters[i]=m;f.textureFlipSettings[i]=h}this.materials[f.materialName]=f}}};v.prototype._parseMaterial=function(a,b){if(a.Material){var c=this.materials[a.Material];
if(c!==void 0){var d=b.meshRendererComponent,e=b.meshDataComponent.meshData.attributeMap,h=new f(c.materialName),e=this.shaderExtractor?this.shaderExtractor(e,c):f.createShader(e.NORMAL&&e.TANGENT&&e.TEXCOORD0&&e.TEXCOORD1&&e.TEXCOORD2&&c.textureFileNames.diffuse&&c.textureFileNames.normal&&c.textureFileNames.ao?f.shaders.texturedNormalAOLit:e.NORMAL&&e.TEXCOORD0&&c.textureFileNames.diffuse?f.shaders.texturedLit:e.TEXCOORD0&&c.textureFileNames.diffuse?f.shaders.textured:f.shaders.simple,c.materialName+
"_Shader");h.shader=e;d.materials[0]=h;h.materialState=c.materialState;for(var i in this.slotUnitMap)if(c.textureFileNames[i]!==void 0){var d=c.textureFileNames[i],e=c.textureMinificationFilters[i],j=c.textureFlipSettings[i],d=this.nameResolver!==void 0?(new g).withMinificationFilter(e).withVerticalFlip(j).withGooResourceCache(_useCache).makeTexture2D(nameResolver.resolveName(d)):(new g).loadTexture2D(this.baseTextureDir+d);h.textures[this.slotUnitMap[i]]=d}}}};v.prototype._parseMaterialstate=function(a){var b=
{};b.ambient=this._parseColor(a.AmbientColor);b.diffuse=this._parseColor(a.DiffuseColor);b.emissive=this._parseColor(a.EmissiveColor);b.specular=this._parseColor(a.SpecularColor);b.shininess=a.Shininess;return b};v.prototype._parseColor=function(a){return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})*$/i.exec(a))?{r:parseInt(a[1],16)/255,g:parseInt(a[2],16)/255,b:parseInt(a[3],16)/255,a:a[4]!==void 0?parseInt(a[4],16)/255:1}:null};v.prototype.importAnimationTree=function(a,c,d){var f=new h,
e=JSON.parse(c);if(!e.Clips||!e.Layers){if(d)d.onSuccess(f)}else{for(var c=e.Clips,g=[],i=[],j=0,k=c.length;j<k;j++){var l=c[j];g.push(l.Name);i.push(l.URL)}r.loadTextAssets(i,g,{onSuccess:function(c){for(var h={},i=0,j=g.length;i<j;i++){var k=(new v).importAnimation(c[g[i]],g[i]);h[k._name]=k}b.parseAnimationLayers(a,d,h,f,e)},onError:function(a){console.warn("failed loading tree clips: "+a);if(d)d.onError(a)}})}};v.prototype.importAnimation=function(a,c){var d=new k(c),f=JSON.parse(a);if(this.useCompression=
f.UseCompression||!1)this.compressedAnimRange=f.CompressedRange||32767;if(f.Channels)for(var f=f.Channels,e=0,g=f.length;e<g;e++){var h=f[e],i=h.Type,j=h.Name,l=b.parseChannelTimes(h,this.useCompression);if("Joint"===i)var j=h.JointName,m=h.JointIndex,i=b.parseRotationSamples(h,this.compressedAnimRange,this.useCompression),F=b.parseTranslationSamples(h,l.length,this.useCompression),h=b.parseScaleSamples(h,l.length,this.useCompression),l=new p(j,m,l,i,F,h);else if("Transform"===i)i=b.parseRotationSamples(h,
this.compressedAnimRange,this.useCompression),F=b.parseTranslationSamples(h,l.length,this.useCompression),h=b.parseScaleSamples(h,l.length,this.useCompression),l=new n(j,l,i,F,h);else if("FloatLERP"===i)l=new o(j,l,b.parseFloatLERPValues(h,this.useCompression));else{console.warn("Unhandled channel type: "+i);continue}d.addChannel(l)}return d};return v});n("goo/entities/components/ScriptComponent",["goo/entities/components/Component"],function(e){function d(b){this.type="ScriptComponent";this.script=
b}d.prototype=Object.create(e.prototype);d.prototype.run=function(b){this.script&&this.script.run&&this.script.run(b)};return d});n("goo/util/DebugUI",[],function(){function e(d){var b=this;d.callbacks.push(function(){var a=d.world.entityManager.getEntities(),b;for(b in a)d.world.changedEntity(a[b])});jQuery(function(a){function c(){this.type="UIManager"}var f=a("<div/>",{id:"debug",click:function(){a(this).toggle()}});f.css({position:"absolute","z-index":"2",padding:"5px","background-color":"gray",
left:"10px",top:"10px",border:"1px solid black"});f.appendTo(document.body);var e=a("<ul>").appendTo(f);b.root=f;c.prototype={constructor:c,added:function(){this.updateList(d.world.entityManager.getTopEntities())},removed:function(){this.updateList(d.world.entityManager.getTopEntities())},changed:function(){this.updateList(d.world.entityManager.getTopEntities())},updateList:function(b){e.empty();for(var c in b){var d=b[c];a("<li>").appendTo(e).append(d.toString()).append(" - "+(d.meshRendererComponent!==
void 0?d.meshRendererComponent.worldBound:"none")+", "+d.isVisible).append(" - "+(d.transformComponent!==void 0?d.transformComponent.transform:""));d.transformComponent&&this.updateTransformList(d.transformComponent.children,1,e)}},updateTransformList:function(b,c,d){if(!(b.length<=0)){var d=a("<ul>").appendTo(d),f;for(f in b){var e=b[f],g=e.entity.meshRendererComponent,n=g!==void 0?g.worldBound:"none",g=g!==void 0?g.materials[0]:void 0,g=g!==void 0?g.shader:"nope";a("<li>").appendTo(d).append(e.entity.toString()).append(" - "+
n+", "+e.entity.isVisible).append(" - "+g).append(" - "+e.transform);this.updateTransformList(e.children,c+1,d)}}}};d.world.setManager(new c)})}e.prototype.init=function(){};return e});n("goo/shapes/Box",["goo/renderer/MeshData"],function(e){function d(b,a,c,d,g){this.xExtent=b!==void 0?b*0.5:0.5;this.yExtent=a!==void 0?a*0.5:0.5;this.zExtent=c!==void 0?c*0.5:0.5;this.tileX=d||1;this.tileY=g||1;b=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,b,24,36);this.rebuild()}d.prototype=Object.create(e.prototype);
d.prototype.rebuild=function(){var b=this.xExtent,a=this.yExtent,c=this.zExtent,d=this.tileX,g=this.tileY,j=[-b,-a,-c,b,-a,-c,b,a,-c,-b,a,-c,b,-a,c,-b,-a,c,b,a,c,-b,a,c],i=[];(function(a){for(var b=0;b<a.length;b++){var c=a[b]*3;i.push(j[c]);i.push(j[c+1]);i.push(j[c+2])}})([0,1,2,3,1,4,6,2,4,5,7,6,5,0,3,7,2,6,7,3,0,5,4,1]);this.getAttributeBuffer(e.POSITION).set(i);var l=[0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,0,-1,0],m=[];(function(){for(var a=0;a<l.length/3;a++)for(var b=0;b<4;b++){var c=a*3;m.push(l[c]);
m.push(l[c+1]);m.push(l[c+2])}})();this.getAttributeBuffer(e.NORMAL).set(m);b=[];for(a=0;a<6;a++)b.push(d),b.push(0),b.push(0),b.push(0),b.push(0),b.push(g),b.push(d),b.push(g);this.getAttributeBuffer(e.TEXCOORD0).set(b);this.getIndexBuffer().set([2,1,0,3,2,0,6,5,4,7,6,4,10,9,8,11,10,8,14,13,12,15,14,12,18,17,16,19,18,16,22,21,20,23,22,20]);return this};return d});n("goo/shapes/Quad",["goo/renderer/MeshData"],function(e){function d(b,a,c,d){this.xExtent=b!==void 0?b*0.5:0.5;this.yExtent=a!==void 0?
a*0.5:0.5;this.tileX=c||1;this.tileY=d||1;b=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,b,4,6);this.rebuild()}d.prototype=Object.create(e.prototype);d.prototype.rebuild=function(){var b=this.xExtent,a=this.yExtent,c=this.tileX,d=this.tileY;this.getAttributeBuffer(e.POSITION).set([-b,-a,0,-b,a,0,b,a,0,b,-a,0]);this.getAttributeBuffer(e.NORMAL).set([0,0,1,0,0,1,0,0,1,0,0,1]);this.getAttributeBuffer(e.TEXCOORD0).set([0,0,0,d,c,d,c,0]);this.getIndexBuffer().set([0,3,1,1,3,2]);return this};
return d});n("goo/shapes/Sphere",["goo/renderer/MeshData","goo/util/Enum","goo/math/Vector3","goo/math/MathUtils"],function(e,d,b,a){function c(a,b,d,f){this.zSamples=a!==void 0?a:8;this.radialSamples=b!==void 0?b:8;this.radius=d!==void 0?d:0.5;this.textureMode=f!==void 0?f:c.TextureModes.Polar;this.viewInside=!1;a=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,a,(this.zSamples-2)*(this.radialSamples+1)+2,6*(this.zSamples-2)*this.radialSamples);this.rebuild()}function f(a,b,c){a[c*3+
0]=a[b*3+0];a[c*3+1]=a[b*3+1];a[c*3+2]=a[b*3+2]}c.prototype=Object.create(e.prototype);c.prototype.rebuild=function(){for(var d=this.getAttributeBuffer(e.POSITION),j=this.getAttributeBuffer(e.NORMAL),i=this.getAttributeBuffer(e.TEXCOORD0),l=this.getIndexBuffer(),m=1/this.radialSamples,k=2/(this.zSamples-1),n=[],t=[],o=0;o<this.radialSamples;o++){var h=a.TWO_PI*m*o;t[o]=Math.cos(h);n[o]=Math.sin(h)}n[this.radialSamples]=n[0];t[this.radialSamples]=t[0];for(var h=0,s=new b,r=new b,v=new b,u=1;u<this.zSamples-
1;u++){var x=a.HALF_PI*(-1+k*u),q=Math.sin(x),o=this.radius*q,w=r.set(0,0,0);w.z+=o;for(var B=Math.sqrt(Math.abs(this.radius*this.radius-o*o)),z,A=h,o=0;o<this.radialSamples;o++){var y=o*m;z=v.set(t[o],n[o],0);b.mul(z,B,s);d[h*3+0]=w.x+s.x;d[h*3+1]=w.y+s.y;d[h*3+2]=w.z+s.z;z=s.set(d[h*3+0],d[h*3+1],d[h*3+2]);z.normalize();this.viewInside?(j[h*3+0]=-z.x,j[h*3+1]=-z.y,j[h*3+2]=-z.z):(j[h*3+0]=z.x,j[h*3+1]=z.y,j[h*3+2]=z.z);this.textureMode===c.TextureModes.Linear?(i[h*2+0]=y,i[h*2+1]=0.5*(q+1)):this.textureMode===
c.TextureModes.Projected?(i[h*2+0]=y,i[h*2+1]=a.HALF_PI+Math.asin(q)/Math.PI):this.textureMode===c.TextureModes.Polar&&(y=(a.HALF_PI-Math.abs(x))/Math.PI,z=y*n[o]+0.5,i[h*2+0]=y*t[o]+0.5,i[h*2+1]=z);h++}f(d,A,h);f(j,A,h);this.textureMode===c.TextureModes.Linear?(i[h*2+0]=1,i[h*2+1]=0.5*(q+1)):this.textureMode===c.TextureModes.Projected?(i[h*2+0]=1,i[h*2+1]=a.INV_PI*(a.HALF_PI+Math.asin(q))):this.textureMode===c.TextureModes.Polar&&(y=(a.HALF_PI-Math.abs(x))/Math.PI,i[h*2+0]=y+0.5,i[h*2+1]=0.5);h++}d[h*
3+0]=0;d[h*3+1]=0;d[h*3+2]=-this.radius;this.viewInside?(j[h*3+0]=0,j[h*3+1]=0,j[h*3+2]=1):(j[h*3+0]=0,j[h*3+1]=0,j[h*3+2]=-1);this.textureMode===c.TextureModes.Polar?(i[h*2+0]=0.5,i[h*2+1]=0.5):(i[h*2+0]=0.5,i[h*2+1]=0);h++;d[h*3+0]=0;d[h*3+1]=0;d[h*3+2]=this.radius;this.viewInside?(j[h*3+0]=0,j[h*3+1]=0,j[h*3+2]=-1):(j[h*3+0]=0,j[h*3+1]=0,j[h*3+2]=1);this.textureMode===c.TextureModes.Polar?(i[h*2+0]=0.5,i[h*2+1]=0.5):(i[h*2+0]=0.5,i[h*2+1]=1);for(j=u=d=0;u<this.zSamples-3;u++){i=j;m=i+1;j+=this.radialSamples+
1;k=j;n=k+1;for(h=0;h<this.radialSamples;h++)this.viewInside?(l[d++]=i++,l[d++]=k,l[d++]=m,l[d++]=m++,l[d++]=k++,l[d++]=n++):(l[d++]=i++,l[d++]=m,l[d++]=k,l[d++]=m++,l[d++]=n++,l[d++]=k++)}for(h=0;h<this.radialSamples;h++)this.viewInside?(l[d++]=h,l[d++]=h+1,l[d++]=this.vertexCount-2):(l[d++]=h,l[d++]=this.vertexCount-2,l[d++]=h+1);u=(this.zSamples-3)*(this.radialSamples+1);for(h=0;h<this.radialSamples;h++)this.viewInside?(l[d++]=h+u,l[d++]=this.vertexCount-1,l[d++]=h+1+u):(l[d++]=h+u,l[d++]=h+1+
u,l[d++]=this.vertexCount-1);return this};c.TextureModes=new d("Linear","Projected","Polar");return c});n("goo/shapes/Torus",["goo/renderer/MeshData","goo/math/Vector3","goo/math/MathUtils"],function(e,d,b){function a(a,b,c,d){this._circleSamples=a!==void 0?a:8;this._radialSamples=b!==void 0?b:8;this._tubeRadius=c!==void 0?c:2;this._centerRadius=d!==void 0?d:1;this.viewInside=!1;a=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,a,(this._circleSamples+1)*(this._radialSamples+1),6*this._circleSamples*
this._radialSamples);this.rebuild()}function c(a,b,c){a[c*3+0]=a[b*3+0];a[c*3+1]=a[b*3+1];a[c*3+2]=a[b*3+2]}a.prototype=Object.create(e.prototype);a.prototype.rebuild=function(){for(var a=this.getAttributeBuffer(e.POSITION),g=this.getAttributeBuffer(e.NORMAL),j=this.getAttributeBuffer(e.TEXCOORD0),i=this.getIndexBuffer(),l=1/this._circleSamples,m=1/this._radialSamples,k=0,n=new d,t=new d,o=new d,h=0;h<this._circleSamples;h++){var s=h*l,r=b.TWO_PI*s,v=Math.cos(r),r=Math.sin(r);n.set(v,r,0);d.mul(n,
this._centerRadius,t);v=k;for(r=0;r<this._radialSamples;r++){var u=r*m,x=b.TWO_PI*u,q=Math.cos(x),x=Math.sin(x);o.copy(n).mul(q);o.z+=x;o.normalize();this.viewInside?(g[k*3+0]=-o.x,g[k*3+1]=-o.y,g[k*3+2]=-o.z):(g[k*3+0]=o.x,g[k*3+1]=o.y,g[k*3+2]=o.z);o.mul(this._tubeRadius).add(t);a[k*3+0]=o.x;a[k*3+1]=o.y;a[k*3+2]=o.z;j[k*2+0]=u;j[k*2+1]=s;k++}c(a,v,k);c(g,v,k);j[k*2+0]=1;j[k*2+1]=s;k++}for(h=0;h<=this._radialSamples;h++,k++)c(a,h,k),c(g,h,k),l=j,m=h,n=k,l[n*2+0]=l[m*2+0],l[n*2+1]=l[m*2+1],j[k*2+
1]=1;for(h=g=a=0;h<this._circleSamples;h++){j=g;l=j+1;g+=this._radialSamples+1;m=g;n=m+1;for(k=0;k<this._radialSamples;k++)this.viewInside?(i[a++]=j++,i[a++]=l,i[a++]=m,i[a++]=l++,i[a++]=n++,i[a++]=m++):(i[a++]=j++,i[a++]=m,i[a++]=l,i[a++]=l++,i[a++]=m++,i[a++]=n++)}return this};return a});n("goo/entities/EntityUtils",["goo/entities/components/TransformComponent","goo/entities/components/MeshDataComponent","goo/entities/components/MeshRendererComponent"],function(e,d,b){function a(){}a.createTypicalEntity=
function(a,e){var g=a.createEntity(),j=new d(e);g.setComponent(j);j=new b;g.setComponent(j);return g};return a});n("goo/shapes/ShapeCreator","goo/renderer/MeshData,goo/shapes/Box,goo/shapes/Quad,goo/shapes/Sphere,goo/shapes/Torus,goo/entities/EntityUtils".split(","),function(e,d,b,a,c){function f(){}f.createQuad=function(a,c,d,e){return new b(a,c,d,e)};f.createBox=function(a,b,c,e,f){return new d(a,b,c,e,f)};f.createSphere=function(b,c,d,e){return new a(b,c,d,e)};f.createTorus=function(a,b,d,e){return new c(a,
b,d,e)};return f});D.config({baseUrl:"./",paths:{goo:"../src/goo"}});D("goo/entities/World,goo/entities/Entity,goo/entities/systems/System,goo/entities/systems/TransformSystem,goo/entities/systems/RenderSystem,goo/entities/components/TransformComponent,goo/entities/components/MeshDataComponent,goo/entities/components/MeshRendererComponent,goo/entities/systems/PartitioningSystem,goo/renderer/MeshData,goo/renderer/Renderer,goo/renderer/Material,goo/renderer/Shader,goo/entities/GooRunner,goo/renderer/TextureCreator,goo/renderer/Loader,goo/loaders/JSONImporter,goo/entities/components/ScriptComponent,goo/util/DebugUI,goo/shapes/ShapeCreator,goo/entities/EntityUtils,goo/renderer/Texture,goo/renderer/Camera,goo/entities/components/CameraComponent,goo/math/Vector3".split(","),
function(e,d,b,a,c,f,g,j,i,l,m,k,n,t,o,h,s,r,v,u,x,q,w,B,z){function A(a){a=new s(a.world);a.load(C+"/girl.model",C+"/",{onSuccess:function(a){for(var b in a)a[b].addToWorld();a[0].transformComponent.transform.scale.set(0.15,0.15,0.15);a[0].setComponent(new r({run:function(a){var b=a._world.time,a=a.transformComponent;a.transform.translation.x=Math.sin(b)*30;a.transform.translation.z=Math.cos(b)*30;a.transform.rotation.y=Math.sin(b*1.5)*3;a.setUpdated()}}))},onError:function(a){console.error(a)}});
a.load(C+"/head.model",C+"/",{onSuccess:function(a){for(var b in a)a[b].addToWorld();a[0].transformComponent.transform.scale.set(50,50,50);a[0].setComponent(new r({run:function(a){var b=a._world.time,a=a.transformComponent;a.transform.translation.x=Math.sin(b+3)*30;a.transform.translation.z=Math.cos(b+3)*30;a.transform.rotation.x=Math.sin(b)*2;a.transform.rotation.y=Math.sin(b*1.5)*3;a.setUpdated()}}))},onError:function(a){console.error(a)}});a.load(C+"/shoes/shoes_compressed.json",C+"/shoes/textures/",
{onSuccess:function(a){var b,c;for(c in a){var d=a[c];if(d.name==="polySurfaceShape10[lambert2SG]"){b=d;break}}if(b){c={run:function(a){var b=a._world.time;a.meshRendererComponent.materials[0].materialState.diffuse.r=Math.sin(b*3)*0.5+0.5;a.meshRendererComponent.materials[0].materialState.diffuse.g=Math.sin(b*2)*0.5+0.5;a.meshRendererComponent.materials[0].materialState.diffuse.b=Math.sin(b*4)*0.5+0.5}};b.setComponent(new r(c));for(var e in a)a[e].addToWorld();a[0].transformComponent.transform.translation.y=
-5;c={run:function(a){var b=a.transformComponent;b.transform.rotation.y=a._world.time*0.5;b.setUpdated()}};a[0].setComponent(new r(c))}else console.error("Could not find entity: polySurfaceShape10[lambert2SG]")},onError:function(a){console.error(a)}})}function y(a){var a=a.world,b=l.defaultMap([l.POSITION,l.COLOR,l.TEXCOORD0]);b.Stuff={count:1,type:"Byte"};b=new l(b,4,6);b.getAttributeBuffer(l.POSITION).set([-5,-5,0,-5,5,0,5,5,0,5,-5,0]);b.getAttributeBuffer(l.COLOR).set([1,0.5,0.5,1,0.5,1,0.5,1,
0.5,0.5,1,1,1,1,1,1]);b.getAttributeBuffer(l.TEXCOORD0).set([0,0,0,1,1,1,1,0]);b.getAttributeBuffer("Stuff").set([0,1,2,3]);b.getIndexBuffer().set([0,1,3,1,2,3]);a=a.createEntity();b=new g(b);a.setComponent(b);var b=new j,c=new k("QuadMaterial"),d=E("vshader"),e=E("fshader");c.shader=new n("QuadShader",{vshader:d,fshader:e,attributes:{vertexPosition:l.POSITION,vertexColors:l.COLOR,vertexUV0:l.TEXCOORD0,fish:"Stuff"},uniforms:{viewMatrix:n.VIEW_MATRIX,projectionMatrix:n.PROJECTION_MATRIX,worldMatrix:n.WORLD_MATRIX,
diffuseMap:n.TEXTURE0}});c.cullState.enabled=!1;d=(new o).loadTexture2D(C+"/pitcher.jpg");c.textures.push(d);b.materials.push(c);a.setComponent(b);a.setComponent(new r({run:function(a){var b=a._world.time,a=a.transformComponent;a.transform.translation.x=Math.sin(b+4)*30;a.transform.translation.z=Math.cos(b+4)*30;a.transform.rotation.x=Math.sin(b)*3;a.setUpdated()}}));return a}function D(a){var b=u.createBox(250,5,250),a=x.createTypicalEntity(a.world,b);a.transformComponent.transform.translation.y=
-15;a.name="Box";b=new k("TestMaterial");b.shader=k.createShader(k.shaders.texturedLit,"BoxShader");var c=(new o).loadTexture2D(C+"/pitcher.jpg");b.textures.push(c);a.meshRendererComponent.materials.push(b);return a}function E(a){var b=document.getElementById(a);if(!b)return null;a="";for(b=b.firstChild;b;)b.nodeType===3&&(a+=b.textContent),b=b.nextSibling;return a}var C="../resources";(function(){var a=new t({showStats:!0});a.renderer.domElement.id="goo";document.body.appendChild(a.renderer.domElement);
A(a);y(a).addToWorld();D(a).addToWorld();var b=new w(45,1,1,1E3),a=a.world.createEntity("CameraEntity");a.setComponent(new B(b));a.addToWorld();b={zero:new z,run:function(a){var b=a._world.time,a=a.transformComponent;a.transform.translation.x=Math.sin(b*1)*30+50;a.transform.translation.y=20;a.transform.translation.z=Math.sin(b*1)*30+50;a.transform.lookAt(this.zero,z.UNIT_Y);a.setUpdated()}};a.setComponent(new r(b))})()});n("start",function(){});D(["start"])})();
